<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Quiz Builder</title>

    <link rel="stylesheet" href="/quiz/static/css/builder.css" />
</head>

<body class="builder">


    <!-- App bar -->
    <header class="appbar">
        <div class="brand">Quiz Builder</div>
        <div class="row">
            <button id="newQuizBtn" class="btn ghost">+ New Quiz</button>
            <button id="loadJsonBtn" class="btn ghost">Load JSON</button>
            <input id="loadJsonInput" type="file" accept="application/json" hidden />

            <button id="importExcelBtn" class="btn ghost">Import Excel/CSV</button>
            <input id="importExcelInput" type="file" accept=".xlsx,.xls,.csv" hidden />
            <button id="downloadTemplateBtn" class="btn ghost">Template</button>

            <button id="saveBtn" class="btn">Save Quiz</button>
            <button id="playBtn" class="btn">Start Playback</button>
            <button id="copyQuizCmdBtn" class="btn ghost">Copy Quiz Command</button>

        </div>
    </header>

    <div class="layout">
        <!-- LEFT: Metadata & Question List -->
        <aside class="left panel">
            <h3>Quiz Settings</h3>
            <label style="visibility: hidden; height: 1px;">Title
                <input id="quizTitle" placeholder="Quiz Title" />
            </label>

            <div class="row2">
                <label>Language
                    <select id="quizLang">
                        <option value="en">English</option>
                        <option value="hi">Hindi</option>
                    </select>
                </label>
                <label>Question TTS
                    <select id="qsTTS">
                        <option value="y">Yes</option>
                        <option value="n">No</option>
                    </select>
                </label>                
                <label>Default Timer
                    <input id="defaultTimer" type="number" min="3" value="12" />
                </label>
            </div>

            <!-- Auto-Advance (quiz-level) -->
            <h4 style="margin-top: .6rem;">Auto-Advance</h4>
            <div class="row2">
            <label>Enabled
                <select id="aaEnabled">
                <option value="true">Yes</option>
                <option value="false">No</option>
                </select>
            </label>
            <label>Delay (sec)
                <input id="aaDelay" type="number" min="0" step="0.5" value="3" />
            </label>
            </div>
            <label class="row">
            <input id="aaAfterExplanation" type="checkbox" checked style="width: 20px;" />
            Wait until explanation is shown
            </label>


            <div class = "themeContainer" >
                <h4>Theme</h4>
                <label style="visibility: hidden; height: 1px;">Preset
                    <select id="themePreset">
                        <option>Neon Quiz</option>
                        <option>Minimal White</option>
                        <option>Retro Arcade</option>
                        <option>Kids Fun</option>
                        <option>Sci-Fi</option>
                    </select>
                </label>

                <div class="row3">
                    <label>Theme Presets
                        <select id="presetSelect">
                            <option value="">(choose)</option>
                            <option value="BhaktiSagar1">BhaktiSagar1</option>
                            <option value="BhaktiSagar2">BhaktiSagar2</option>
                            <option value="BhaktiSagar3">BhaktiSagar3</option>
                            <option value="Neon">Neon</option>
                            <option value="Minimal">Minimal</option>
                            <option value="Retro">Retro</option>
                            <option value="Paper">Paper</option>
                        </select>
                    </label>
                    <button id="applyPresetBtn" class="btn small" type="button">Apply</button>
                    <button id="savePresetBtn" class="btn ghost" type="button">Save Current…</button>
                </div>
                <div class="row2">
                    <label>Overlay Color
                        <input id="overlayColor" type="color" value="#000000" />
                    </label>
                    <label>Overlay Opacity
                        <input id="overlayOpacity" type="range" min="0" max="0.9" step="0.05" value="0.45" />
                    </label>
                </div>

                <div class="row2">
                    <label>Question Animation
                        <select id="qAnim">
                            <option value="fade">Fade In</option>
                            <option value="slide">Slide Up</option>
                            <option value="zoom">Zoom In</option>
                            <option value="none">None</option>
                        </select>
                    </label>

                    <label>Option Animation
                        <select id="optAnim">
                            <option value="fade">Fade In</option>
                            <option value="slide">Slide Up</option>
                            <option value="zoom">Zoom In</option>
                            <option value="none">None</option>
                        </select>
                    </label>
                </div>

                <div class="row2">
                    <label>Idle Motion
                        <select id="idleMotion">
                            <option value="none">None</option>
                            <option value="breath">Breathing</option>
                            <option value="shake">Subtle Shake</option>
                            <option value="float">Floating</option>
                        </select>
                    </label>

                    <label>Motion Intensity
                        <input id="idleIntensity" type="range" min="1" max="10" value="3" step="1" />
                    </label>
                </div>

                <label class="row" style="margin-top:.3rem">
                    <input style="width: 50px;" id="optStagger" type="checkbox" checked />
                    Stagger option animations
                </label>


                <label class="row">Stagger Step (seconds)
                    <input style="width: 150px;" id="optStaggerStep" type="number" min="0" step="0.05" value="0.10" />
                </label>
                <div class="row2">
                    <label>Primary Color <input id="colorPrimary" type="color" value="#00E5FF" /></label>
                    <label>Accent Color <input id="colorAccent" type="color" value="#FF3D7F" /></label>
                </div>

                <label>Font Family
                    <select id="fontFamily">
                        <option>Poppins, sans-serif</option>
                        <option>Inter, sans-serif</option>
                        <option>Nunito, sans-serif</option>
                        <option>Rubik, sans-serif</option>
                        <option>Comic Neue, cursive</option>
                        <option>Roboto Mono, monospace</option>

                    </select>
                </label>
                <div id="fontPreview" class="font-preview">Aa Bb Cc</div>

                <div class="row2">
                    <label>Timer Style
                        <select id="timerStyle">
                            <option value="ring">Ring</option>
                            <option value="bar">Bar</option>
                        </select>
                    </label>
                    <label>Music Volume
                        <input id="musicVol" type="number" step="0.05" min="0" max="1" value="0.35" />
                    </label>
                </div>
                <!-- Background Image Upload -->
                <div class="row2" style="margin-top:.5rem;">
                <div>
                    <label class="muted">Background Image (replaces server file)</label>
                    <input id="bgUploadInput" type="file" accept="image/*" hidden />
                    <div class="row" style="gap:.5rem;">
                    <button id="bgUploadBtn" class="btn small" type="button">Upload BG Image</button>
                    <button id="bgUseUploadedBtn" class="btn ghost small" type="button">Use Uploaded</button>
                    </div>
                    <div class="muted" style="font-size:.85rem;margin-top:.35rem;">
                    Tip: Upload once, then click <b>Use Uploaded</b> to apply it to the current quiz theme.
                    </div>
                </div>

                <div>
                    <label class="muted">Current theme background</label>
                    <input id="bgSrc" placeholder="/quiz/static/backgrounds/A.mp4 or uploaded image..." />
                </div>
                </div>

                <label>Background Video
                    <select id="bgSelect">
                        <option value="">(Select Video)</option>
                    </select>
                    <input id="bgSrc" type="hidden" placeholder="/quiz/static/backgrounds/A.mp4" />
                </label>

                <label>Background Music (URL)

                    <select id="musicSelect">
                        <option value="">(Select Music)</option>
                    </select>
                    <input id="musicSrc" type="hidden" placeholder="/quiz/uploads/music/ambient_loop.mp3" />
                </label>

                <label class="row"><input style="width: 50px;" id="duckOnReveal" type="checkbox" checked /> Duck Music
                    on Reveal</label>
            </div>
            <hr class="sep" />

            <section class="row" style="justify-content:space-between; align-items:center;">
                <div>
                    <h3 style="margin:.2rem 0">Questions</h3>
                    <div id="qCount" class="muted">0 items</div>
                </div>
                <div class="row">
                    <button id="addMcq" class="btn small">+ MCQ</button>
                    <button id="addSingle" class="btn small">+ Single</button>
                </div>
            </section>

            <ul id="qList" class="qlist"></ul>
        </aside>

        <!-- CENTER: Question Editor -->
        <main class="center panel">
            <h3>Question Editor</h3>

            <div id="noSel" class="muted">Select a question from the list or add a new one.</div>

            <section id="qEditor" class="hidden">
                <div class="row2">
                    <label>Type
                        <select id="qType">
                            <option value="mcq">Multiple Choice</option>
                            <option value="single">Single Answer</option>
                        </select>
                    </label>
                    <label>Difficulty
                        <select id="qDiff">
                            <option value="easy">easy</option>
                            <option value="medium">medium</option>
                            <option value="hard">hard</option>
                        </select>
                    </label>
                    <label>Override Timer (sec)
                        <input id="qTimer" type="number" min="3" />
                    </label>
                </div>

                <label>Question Text
                    <textarea id="qText" rows="3" placeholder="Type the question…"></textarea>
                </label>

                <div class="row2">
                    <label>Question Font x
                        <input id="qFontScale" type="range" min="0.2" max="4" step="0.2" value="1">
                    </label>
                    <label>Options Font x
                        <input id="optFontScale" type="range" min="0.2" max="4" step="0.2" value="1">
                    </label>
                </div>

                <!-- Question images -->
                <div class="imgs">
                    <div class="row" style="justify-content:space-between; align-items:center;">
                        <h4 style="margin:0">Question Images</h4>
                        <div>
                            <input id="qImgInput" type="file" accept="image/*" hidden />
                            <button id="qImgBtn" class="btn small">+ Add Image</button>
                        </div>
                    </div>
                    <div id="qImgGrid" class="imggrid" tabindex="0" data-paste-scope="q"></div>
                    <div class="paste-hint">Tip: Click here, then press Ctrl/Cmd+V to paste an image from your clipboard.</div>

                </div>

                <div class="row2">
                    <label>Question Image Fit
                        <select id="qImgFit">
                            <option value="cover">Cover</option>
                            <option value="contain">Contain</option>
                            <option value="fill">Fill</option>
                        </select>
                    </label>
                    <label>Align
                        <select id="qImgPos">
                            <option value="center">Center</option>
                            <option value="top">Top</option>
                            <option value="bottom">Bottom</option>
                            <option value="left">Left</option>
                            <option value="right">Right</option>
                        </select>
                    </label>
                </div>

                <!-- Options (1-4) -->
                <div id="mcqBlock">
                    <div class="row" style="justify-content:space-between; align-items:center; margin-top:.6rem;">
                        <h4 style="margin:0">Options</h4>
                        <div class="row">
                            <button id="addOptBtn" class="btn small">+ Add</button>
                            <button id="remOptBtn" class="btn small ghost">– Remove</button>
                        </div>
                    </div>

                    <div id="optWrap" class="optwrap"></div>

                    <label>Correct Option
                        <select id="correctIdx">
                            <option value="">(choose)</option>
                            <option value="0">Option 1</option>
                            <option value="1">Option 2</option>
                            <option value="2">Option 3</option>
                            <option value="3">Option 4</option>
                        </select>
                    </label>
                </div>

                <div id="singleBlock" class="hidden">
                    <label>Answer
                        <input id="singleAnswer" placeholder="Exact answer to reveal" />
                    </label>
                </div>

                <label>Explanation (optional)
                    <textarea id="qExplain" rows="2" placeholder="Shown after reveal"></textarea>
                </label>

                <div class="row" style="justify-content:flex-end; gap:.6rem; margin-top:.6rem;">
                    <button id="dupBtn" class="btn ghost">Duplicate</button>
                    <button id="delBtn" class="btn ghost danger">Delete</button>
                    <button id="applyBtn" class="btn">Apply Changes</button>
                </div>
            </section>
        </main>

        <!-- RIGHT: Live Preview -->
        <aside class="right panel">
            <div class="row" style="justify-content:space-between; align-items:center;">
                <h3 style="margin:.2rem 0">Live Preview</h3>
                <div class="row">
                    <button id="landBtn" class="btn tiny">16:9</button>
                    <button id="portBtn" class="btn tiny ghost">9:16</button>
                </div>
            </div>

            <div class="pv-toolbar row">
                <label class="row" style="width: 230px;"><input style="width: 20px;" id="animToggle" type="checkbox"
                        checked /> Animate Preview</label>
                <label style="width: 190px;">Theme
                    <select id="themeMode" style="width: 90px;">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                    </select>
                </label>
                <label class="row" style="width: 150px;"><input style="width: 30px;" id="showQNum" type="checkbox"
                         /> Show Q#</label>
                <label class="row" style="width: 200px;"><input style="width: 30px;" id="showDiff" type="checkbox"
                         /> Show Difficulty</label>
            </div>
            <div class="pv-toolbar row">
                <div class="row">
                    <button id="bgPlayPause" class="btn ghost" type="button">Pause BG</button>
                    <button id="bgMute" class="btn ghost" type="button">Mute BG</button>
                    <button id="musicPlayPause" class="btn ghost" type="button">Play Music</button>
                </div>

                <label class="row"><input style="width: 30px;" id="loopIdleOnly" type="checkbox" /> Loop Idle Only (no
                    entrance)</label>
                <button id="replayTransitions" class="btn ghost" type="button">Replay</button>


            </div>

            <div id="preview" class="preview landscape">
                <!-- Background layers for Player-like preview area -->
                <div class="pv-bg">
                    <video id="pvBgVideo" class="pv-bg-layer" autoplay muted loop playsinline></video>
                    <img id="pvBgImage" class="pv-bg-layer" alt="" />
                    <div id="pvBgTint" class="pv-bg-tint"></div>
                </div>
                <audio id="pvMusic" loop></audio>

                <header class="hud">
                    <!-- <div id="pvTitle" class="title">Title</div> -->
                    <div id="pvQuestionHd" class="title">Question</div>
                    <div class="right">
                        <span id="pvCount" class="counter">Q 0/0</span>
                        <span id="pvDiff" class="pill">EASY</span>
                    </div>
                    <div id="pvTimer" style="display: none;" class="timer-ring" title="Timer"></div>

                </header>

                <div id="pvCard" class="card">
                    <div id="pvQ" class="question">Add a question to preview…</div>
                    <div id="pvImgs" class="images"></div>
                    <div id="pvOpts" class="options"></div>
                    <div id="pvExpl" class="explanation hidden"></div>
                </div>
            </div>
        </aside>
    </div>

    <script type="module" src="/quiz/static/js/builder.js"></script>
    <script>
  (function () {
    const QUIZ_CMD = `Please create a multiple-choice question quiz on [TOPIC]
Format it in Excel with the following columns:
question, opt1, opt2, opt3, opt4, correct option number, difficulty(easy/medium/hard), explanation (any interesting info to show to viewers after answer is displayed), opt1_img(command to generate image for option1), opt2_img(command to generate image for option2), opt3_img(command to generate image for option3), opt4_img(command to generate image for option4).

✅ Requirements:
- Include about [NUMBER] questions.
- Sort the questions by difficulty (easy → medium → hard).
- Make explanations fun and educational.
- Use realistic, detailed image prompts (AI generation style).
- Export the final output as an Excel file ready for download.`;

    const btn = document.getElementById('copyQuizCmdBtn');
    if (!btn) return;

    btn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(QUIZ_CMD);
        const old = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => (btn.textContent = old), 1200);
      } catch (err) {
        // Fallback if clipboard API not available
        const ta = document.createElement('textarea');
        ta.value = QUIZ_CMD;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        const old = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => (btn.textContent = old), 1200);
      }
    });
  })();
</script>

</body>

</html>