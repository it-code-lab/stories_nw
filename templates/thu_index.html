<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thumbnail & Pinterest Post Maker (BG Crop)</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles_thumb.css') }}">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Bebas+Neue&family=Inter:wght@400;600;800&family=Montserrat:wght@500;700;900&family=Oswald:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">üñºÔ∏è</div>
      <div>
        <div class="title">Thumbnail + Pinterest Post Maker</div>
        <div class="subtitle">Background Crop ‚Ä¢ Layers ‚Ä¢ Drag/Resize ‚Ä¢ Export</div>
      </div>
    </div>

    <div class="top-actions">
      <button id="btnNew" class="btn">New</button>
      <button id="btnDuplicateLayer" class="btn">Duplicate Layer</button>
      <button id="btnDeleteLayer" class="btn danger">Delete Layer</button>
    </div>
  </header>

  <main class="layout">
    <!-- LEFT -->
    <aside class="panel">
      <section class="card">
        <h2>Project</h2>

        <div class="row">
          <label>Format</label>
          <select id="formatSelect">
            <option value="youtube_16_9">YouTube Thumbnail (1280√ó720)</option>
            <option value="pinterest_2_3">Pinterest Post (1000√ó1500)</option>
            <option value="story_9_16">Story/Reels (1080√ó1920)</option>
          </select>
        </div>

        <div class="row">
          <label>Background Mode</label>
          <select id="bgModeSelect">
            <option value="crop" selected>Crop (choose area)</option>
            <option value="cover">Cover (center crop)</option>
            <option value="contain">Contain (letterbox)</option>
            <option value="contain_blur">Contain + Blur Fill</option>
          </select>
          <div class="hint">Tip: Use <b>Crop</b> to frame a landscape image perfectly for thumbnails.</div>
        </div>

        <div class="row">
          <label>Dim Background</label>
          <div class="inline">
            <input id="bgDim" type="range" min="0" max="0.85" step="0.01" value="0.15">
            <span id="bgDimVal" class="mono">0.15</span>
          </div>
        </div>

        <div class="row">
          <label>Upload Background Image</label>
          <input id="bgFileInput" type="file" accept="image/*,video/*" />

          <div class="hint">Tip: you can also paste an image (Ctrl+V).</div>
        </div>

        <div class="row">
          <label>Background Crop Controls</label>
          <div class="grid2">
            <button class="btn" id="btnCenterCrop">Center Crop</button>
            <button class="btn" id="btnResetCrop">Reset Crop</button>
          </div>
          <button class="btn" id="btnToggleCropOverlay">
            Show Crop Overlay
          </button>          
          <div class="hint">
            In Crop mode: drag the crop box on canvas. Handles resize. Aspect is locked to selected format.
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-head">
          <h2>Layers</h2>
          <div class="card-actions">
            <button id="btnAddTextLayer" class="btn primary">+ Text</button>
            <button id="btnAddImageLayer" class="btn">+ Image/Logo</button>
            <button id="btnBringForward" class="btn">Up</button>
            <button id="btnSendBackward" class="btn">Down</button>
          </div>
        </div>
        <div id="layersList" class="layers"></div>
      </section>
    </aside>

    <!-- CENTER -->
    <section class="stage">
      <div class="stage-inner">
        <canvas id="canvas"></canvas>
        <div class="stage-help">
          <span class="kbd">Crop mode:</span> drag crop box ‚Ä¢ handles resize ‚Ä¢
          <span class="kbd">Layers:</span> drag/resize text/logo
        </div>
      </div>
      <video id="bgVideo" class="hidden" playsinline muted></video>

      <div class="export-bar">
        <div class="export-left">
          <label class="small">Export</label>
          <select id="exportType">
            <option value="png">PNG (best quality)</option>
            <option value="jpg">JPG (smaller size)</option>
          </select>

          <div class="inline export-quality">
            <label class="small">JPG Quality</label>
            <input id="jpgQuality" type="range" min="0.4" max="1" step="0.01" value="0.92">
            <span id="jpgQualityVal" class="mono">0.92</span>
          </div>

          <button id="btnExport" class="btn primary">Download</button>
          <button id="btnExport" class="btn primary">Download</button>
          <button id="btnExportOverlay" class="btn">Overlay PNG</button>
          <button id="btnExportProject" class="btn">Project JSON</button>

        </div>

        <div class="export-right">
          <div class="pill" id="statusPill">Ready</div>
        </div>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="panel">
      <section class="card" id="layerPropsCard">
        <h2>Selected Layer</h2>
        <div id="noSelection" class="hint">Select a layer to edit its properties.</div>

        <!-- TEXT PROPS -->
        <div id="layerPropsText" class="props hidden">
          <div class="row">
            <label>Layer Name</label>
            <input id="propName" type="text" />
          </div>

          <div class="row">
            <label>Text</label>
            <textarea id="propText" rows="4"></textarea>
            <div class="hint">New lines create line breaks. Auto-fit fits the box.</div>
          </div>

          <div class="grid2">
            <div class="row">
              <label>Font</label>
              <select id="propFont">
                <option value="Inter">Inter</option>
                <option value="Montserrat">Montserrat</option>
                <option value="Oswald">Oswald</option>
                <option value="Bebas Neue">Bebas Neue</option>
                <option value="Anton">Anton</option>
                <option value="Arial">Arial</option>
                <option value="Impact">Impact</option>
                <option value="Hind-Bold">Hind-Bold</option>
              </select>
            </div>

            <div class="row">
              <label>Weight</label>
              <select id="propWeight">
                <option value="400">400</option>
                <option value="500">500</option>
                <option value="600">600</option>
                <option value="700">700</option>
                <option value="800" selected>800</option>
                <option value="900">900</option>
              </select>
            </div>
          </div>

          <div class="grid2">
            <div class="row">
              <label>Auto-fit</label>
              <select id="propAutoFit">
                <option value="no" selected>No</option>
                <option value="yes">Yes</option>

              </select>
            </div>
            <div class="row">
              <label>Font Size</label>
              <input id="propFontSize" type="number" min="8" max="260" value="96" />
            </div>
          </div>

          <div class="grid2">
            <div class="row">
              <label>Text Color</label>
              <input id="propFill" type="color" value="#ffffff" />
            </div>

            <div class="row">
              <label>Alignment</label>
              <select id="propAlign">
                <option value="left">Left</option>
                <option value="center" selected>Center</option>
                <option value="right">Right</option>
              </select>
            </div>
          </div>

          <div class="grid2">
            <div class="row">
              <label>Uppercase</label>
              <select id="propUppercase">
                <option value="yes" selected>Yes</option>
                <option value="no">No</option>
              </select>
            </div>

            <div class="row">
              <label>Line Height</label>
              <input id="propLineHeight" type="number" min="0.8" max="1.8" step="0.05" value="1.05" />
            </div>
          </div>

          <hr class="sep" />

          <h3>Outline (Stroke)</h3>
          <div class="grid2">
            <div class="row">
              <label>Stroke On</label>
              <select id="propStrokeOn">
                <option value="yes" selected>Yes</option>
                <option value="no">No</option>
              </select>
            </div>
            <div class="row">
              <label>Stroke Width</label>
              <input id="propStrokeWidth" type="number" min="0" max="60" value="14" />
            </div>
          </div>
          <div class="row">
            <label>Stroke Color</label>
            <input id="propStrokeColor" type="color" value="#000000" />
          </div>

          <hr class="sep" />

          <h3>Shadow</h3>
          <div class="grid2">
            <div class="row">
              <label>Shadow On</label>
              <select id="propShadowOn">
                <option value="yes" selected>Yes</option>
                <option value="no">No</option>
              </select>
            </div>
            <div class="row">
              <label>Blur</label>
              <input id="propShadowBlur" type="number" min="0" max="80" value="18" />
            </div>
          </div>

          <div class="grid2">
            <div class="row">
              <label>Offset X</label>
              <input id="propShadowDx" type="number" min="-80" max="80" value="6" />
            </div>
            <div class="row">
              <label>Offset Y</label>
              <input id="propShadowDy" type="number" min="-80" max="80" value="6" />
            </div>
          </div>

          <div class="row">
            <label>Shadow Color</label>
            <input id="propShadowColor" type="color" value="#000000" />
          </div>

          <hr class="sep" />

          <h3>Background Box</h3>
          <div class="grid2">
            <div class="row">
              <label>Box On</label>
              <select id="propBoxOn">
                <option value="no" selected>No</option>
                <option value="yes">Yes</option>
              </select>
            </div>
            <div class="row">
              <label>Padding</label>
              <input id="propBoxPad" type="number" min="0" max="80" value="18" />
            </div>
          </div>

          <div class="grid2">
            <div class="row">
              <label>Radius</label>
              <input id="propBoxRadius" type="number" min="0" max="120" value="24" />
            </div>
            <div class="row">
              <label>Box Color</label>
              <input id="propBoxColor" type="color" value="#000000" />
            </div>
          </div>

          <div class="row">
            <label>Box Opacity</label>
            <div class="inline">
              <input id="propBoxOpacity" type="range" min="0" max="1" step="0.01" value="0.35" />
              <span id="propBoxOpacityVal" class="mono">0.35</span>
            </div>
          </div>
        </div>

        <!-- IMAGE PROPS -->
        <div id="layerPropsImage" class="props hidden">
          <div class="row">
            <label>Layer Name</label>
            <input id="imgPropName" type="text" />
          </div>

          <div class="row">
            <label>Upload Logo/Image</label>
            <input id="imgPropFile" type="file" accept="image/*" />
          </div>

          <div class="grid2">
            <div class="row">
              <label>Opacity</label>
              <div class="inline">
                <input id="imgPropOpacity" type="range" min="0" max="1" step="0.01" value="1" />
                <span id="imgPropOpacityVal" class="mono">1.00</span>
              </div>
            </div>

            <div class="row">
              <label>Fit Mode</label>
              <select id="imgPropFit">
                <option value="contain" selected>Contain</option>
                <option value="cover">Cover</option>
              </select>
            </div>
          </div>

          <div class="row">
            <label>Soft Shadow</label>
            <select id="imgPropShadow">
              <option value="no" selected>No</option>
              <option value="yes">Yes</option>
            </select>
          </div>
        </div>
      </section>
    </aside>
  </main>

  <script src="{{ url_for('static', filename='script_thumb.js') }}"></script>
<!-- =========================
     HOW TO GUIDE (Toggle)
     Paste near bottom of index.html, before </body>
========================== -->
<section class="howtoWrap">
  <details class="howtoDetails">
    <summary class="howtoSummary">
      üìò How to Use This Editor (click to show/hide)
    </summary>

    <div class="howtoBody">
      <h2>Thumbnail & Video Overlay Editor ‚Äî Quick User Guide</h2>
      <p>
        This tool helps you design professional <b>thumbnails</b>, <b>Pinterest posts</b>, and <b>video overlays</b>
        using text + logo layers, smart cropping, and clean exports.
      </p>

      <hr class="howtoHr" />

      <h3>1) Choose Output Format (Very Important)</h3>
      <p>Select the target format <b>before</b> designing. The canvas size defines what gets exported.</p>
      <ul>
        <li><b>YouTube Thumbnail</b> ‚Äî 1280√ó720 (16:9)</li>
        <li><b>Shorts / Reels / Stories</b> ‚Äî 1080√ó1920 (9:16)</li>
        <li><b>Pinterest Post</b> ‚Äî 1000√ó1500 (2:3)</li>
      </ul>

      <h3>2) Upload Background (Image or Video)</h3>
      <ul>
        <li>Upload a <b>background image</b> (JPG/PNG) or <b>video</b> (MP4).</li>
        <li>The background will render inside the canvas at the selected output size.</li>
      </ul>

      <h3>3) Background Modes (How the background fits)</h3>
      <ul>
        <li><b>Crop</b> (Recommended): Choose exactly which part of the image/video is used.</li>
        <li><b>Cover</b>: Fills the canvas; crops from center automatically.</li>
        <li><b>Contain</b>: Shows full image/video; may add bars.</li>
        <li><b>Contain + Blur</b>: Keeps full content and fills bars with a blurred background.</li>
      </ul>

      <h3>4) Crop the Background (Crop Mode Only)</h3>
      <ul>
        <li>Drag the crop box to reposition the selected area.</li>
        <li>Resize using handles to reframe (aspect ratio stays correct).</li>
        <li><b>What you see inside the crop box</b> is what gets exported.</li>
      </ul>

      <h3>5) Hide Crop Overlay (After you‚Äôre satisfied)</h3>
      <ul>
        <li>Click <b>Hide Crop Overlay</b> to remove the crop box from the canvas while editing.</li>
        <li>The crop selection stays active‚Äîonly the UI overlay hides.</li>
        <li>Crop UI is never included in exports.</li>
      </ul>

      <h3>6) Dim the Background (Optional)</h3>
      <ul>
        <li>Use the <b>Dim Background</b> slider to darken image/video for better text readability.</li>
        <li>Text and logos remain crisp on top.</li>
      </ul>

      <h3>7) Add Overlays (Text & Logos)</h3>
      <h4>Text Layers</h4>
      <ul>
        <li>Add multiple text blocks (Hook / Subtext / CTA).</li>
        <li>Each text block can have its own font, size, color, outline (stroke), shadow, and background pill.</li>
        <li>Drag to move; resize using handles.</li>
      </ul>

      <h4>Logo / Image Layers</h4>
      <ul>
        <li>Upload a small PNG logo and place it anywhere.</li>
        <li>Resize and reposition like any other layer.</li>
        <li>Transparent PNG logos work best.</li>
      </ul>

      <h3>8) Selection & Editing Tips</h3>
      <ul>
        <li>Click a layer to select it (you‚Äôll see a dashed selection box).</li>
        <li>Selection boxes are only for editing and <b>do not appear in exports</b>.</li>
      </ul>

      <h3>9) Export Options</h3>
      <h4>Download (Image)</h4>
      <ul>
        <li>Exports the final image: background + overlays in the chosen output size.</li>
        <li>No crop box / no selection outlines included.</li>
        <li>Choose <b>PNG</b> for best quality, <b>JPG</b> for smaller size.</li>
      </ul>

      <h4>Overlay PNG (For Video)</h4>
      <ul>
        <li>Exports a <b>transparent PNG</b> with only text + logos.</li>
        <li>Used for applying overlays on videos with FFmpeg (baked into MP4).</li>
      </ul>

      <h4>Project JSON</h4>
      <ul>
        <li>Exports your project settings: format, crop, dim, and layer positions.</li>
        <li>Used together with Overlay PNG for video automation.</li>
      </ul>

      <h3>10) Apply Overlays on Video (Python + FFmpeg)</h3>
      <p>After exporting <b>Overlay PNG</b> + <b>Project JSON</b>, run:</p>
      <pre class="howtoCode"><code>python overlay_on_video.py \
  --input-video input.mp4 \
  --overlay-png overlay.png \
  --project-json project.json \
  --output final_video.mp4 \
  --keep-audio</code></pre>

      <p>The final MP4 will be cropped/scaled to your chosen format and will include all overlays.</p>

      <h3>Best Practices (Pro Tips)</h3>
      <ul>
        <li>Use <b>Crop mode</b> for thumbnails (best framing control).</li>
        <li>Keep hook text short: <b>3‚Äì6 words</b>.</li>
        <li>Use outline or pill background to ensure readability.</li>
        <li>Avoid placing important text too close to edges.</li>
        <li>Use <b>Dim Background</b> instead of excessive shadows.</li>
      </ul>

      <div class="howtoCallout">
        <b>Remember:</b> The <b>Canvas = Final Output</b>.  
        Only the canvas content exports (UI overlays like selection boxes/crop guides never export).
      </div>
    </div>
  </details>
</section>

<style>
  /* Optional: keep this here or move into styles.css */
  .howtoWrap{ margin: 28px 0 12px; padding: 0 10px; }
  .howtoDetails{
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    overflow: hidden;
  }
  .howtoSummary{
    cursor: pointer;
    padding: 14px 16px;
    font-weight: 700;
    user-select: none;
  }
  .howtoBody{
    padding: 0 16px 16px;
    line-height: 1.5;
  }
  .howtoBody h2{ margin: 8px 0 10px; font-size: 20px; }
  .howtoBody h3{ margin: 18px 0 8px; font-size: 16px; }
  .howtoBody h4{ margin: 12px 0 6px; font-size: 14px; opacity: 0.95; }
  .howtoBody ul{ margin: 8px 0 0 18px; }
  .howtoHr{ border: none; border-top: 1px solid rgba(255,255,255,0.08); margin: 14px 0; }
  .howtoCode{
    background: rgba(0,0,0,0.35);
    padding: 12px;
    border-radius: 10px;
    overflow-x: auto;
    margin: 8px 0 10px;
  }
  .howtoCallout{
    margin-top: 14px;
    padding: 12px;
    border-radius: 12px;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.08);
  }
</style>

</body>
</html>
