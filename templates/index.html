<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Content Processor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            padding: 30px;
        }

        form {
            background: #fff;
            padding: 25px 40px;
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
            margin: auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        form h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
        }

        textarea,
        select,
        input[type="number"],
        input[type="text"] {
            width: 100%;
            max-width: 400px;
            padding: 10px;
            font-size: 14px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            display: block;
        }

        button {
            padding: 12px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            max-width: 200px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        button:hover {
            background: #0056b3;
        }

        .tooltip-container {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #555;
            font-weight: bold;
            margin-left: 5px;
        }

        .tooltip-text {
            visibility: hidden;
            width: 260px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            /* Position above the icon */
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 13px;
            line-height: 1.3;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* --- Top nav bar --- */
        .topnav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
            background: #ffffffcc;
            /* a bit translucent */
            backdrop-filter: blur(6px);
            border-bottom: 1px solid #e9e9e9;
            box-shadow: 0 2px 10px rgba(0, 0, 0, .06);
            padding: 8px 12px;
        }

        .topnav .scroller {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: thin;
        }

        .topnav a {
            display: inline-block;
            font: 600 13px/1.4 Arial, sans-serif;
            color: #333;
            text-decoration: none;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 999px;
            padding: 8px 12px;
        }

        .topnav a:hover {
            background: #e8eefc;
            border-color: #cfe0ff;
        }

        .topnav a.active {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }

        /* Give the page top padding so content isn‚Äôt hidden under the fixed nav */
        body {
            padding-top: 64px;
        }

        /* Smooth scroll + make headings stop below the fixed nav */
        html {
            scroll-behavior: smooth;
        }

        form {
            scroll-margin-top: 72px;
        }

        /* keeps form title visible under nav */
        /* Toggle button */
        .nav-toggle {
            margin-left: 8px;
            padding: 8px 10px;
            font: 600 13px/1 Arial, sans-serif;
            background: #eef2ff;
            border: 1px solid #c7d2fe;
            border-radius: 999px;
            cursor: pointer;
        }

        .nav-toggle:hover {
            background: #e0e7ff
        }

        /* Backdrop + panel */
        .nav-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .25);
            z-index: 9998;
        }

        .nav-expand {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            top: 56px;
            width: min(1100px, 96vw);
            max-height: 70vh;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, .15);
            z-index: 9999;
            overflow: auto;
        }

        .nav-expand-inner {
            padding: 14px;
        }

        .nav-expand-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        #navSearch {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }

        .nav-close {
            border: 1px solid #e5e7eb;
            background: #f9fafb;
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
        }

        .nav-close:hover {
            background: #f3f4f6
        }

        /* Grid of section links */
        .nav-grid {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        }

        .nav-grid a {
            display: block;
            padding: 10px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            background: #f8fafc;
            text-decoration: none;
            color: #111827;
            font: 600 14px/1.2 Arial, sans-serif;
        }

        .nav-grid a:hover {
            background: #eef2ff;
            border-color: #c7d2fe;
        }

        #previewContainer {
            margin-top: 30px;
            text-align: center;
        }

        #previewCanvas {
            width: 640px;
            height: 360px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #eee;
        }

        .color-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #aaa;
            display: inline-block;
        }

        .grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }

        .item {
            border: 2px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: .2s;
        }

        .item.selected {
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0, 123, 255, .5);
        }

        .item img,
        .item video {
            width: 160px;
            height: 100px;
            object-fit: cover;
            display: block;
        }

        .infoBox {
            background-color: #cfe0ff;
            padding: 5px;
            margin: 10px;
            border-radius: 5px;
        }
    </style>

</head>

<body>
    <nav class="topnav">
        <div class="scroller" id="topNavLinks"></div>

        <!-- Toggle button (right side) -->
        <button class="nav-toggle" id="navToggle" aria-expanded="false" aria-controls="navExpand"
            title="Show all sections">
            ‚ñ§ All
        </button>
    </nav>

    <!-- Expandable panel + backdrop -->
    <div class="nav-backdrop" id="navBackdrop" hidden></div>
    <div class="nav-expand" id="navExpand" hidden>
        <div class="nav-expand-inner">
            <div class="nav-expand-header">
                <strong>All Sections</strong>
                <input id="navSearch" type="text" placeholder="Filter‚Ä¶" aria-label="Filter sections">
                <button id="navClose" class="nav-close" title="Close">‚úï</button>
            </div>
            <div class="nav-grid" id="navGrid"></div>
        </div>
    </div>

    <form id="bgVideoForm">
        <h2>1.Select Background Video</h2>

        <label>Video Folder:</label>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <select id="videoFolder"></select>
            <div id="videoBreadcrumbs" style="font-size:13px; color:#666;"></div>
        </div>
        <div id="videoContainer" class="grid" style="min-height:110px;"></div>
        <button type="submit">Set Background Video</button>
        <div class="infoBox">Places video as bg_video.mp4 in edit_vid_input.</div>
    </form>

    <br>
    <form id="generateTTSAudio">
        <h2 style="background-color:aqua;">2.Generate TTS</h2>

        <label>Enter Text:</label>
        <textarea name="ttstext" rows="20"></textarea>

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <label>Select TTS Engine:</label>
        <select name="tts">
            {% for key in tts_options.keys() %}
            <option value="{{ key }}">{{ key }}</option>
            {% endfor %}
        </select>

        <label>Select Voice Gender:</label>
        <select name="gender" id="gender" onchange="updateVoices()">
            {% for g in voice_genders %}
            <option value="{{ g }}">{{ g }}</option>
            {% endfor %}
        </select>

        <button type="submit">Generate Audio File</button>
        <br>
        <div class="infoBox">Created file will be saved as audio.wav in the root folder and edit_vid_audio.
        </div>
    </form>
    <br>
    <form id="asseleClipsToMakeVideoSong">
        <h2>3.Assemble small video clips to make large video with audio</h2>
        <div> To be used to make make song videos/large video using video clips.
            <br><br>Place the video clips in edit_vid_input folder. Place the audio file in edit_vid_audio. Output
            will be created in edit_vid_output and will also be copied on root as composed_video.mp4.
        </div>

        <button type="submit">Make Large Video</button>
    </form>
    <br>
    <form id="splitTextForm">
        <h2 style="background-color:lightgreen;">4.Split Content into Sentences</h2>
        <div class="infoBox" >Used for splitting Hindi paragraph into sentenses to be used in Hindi Caption Builder</div>
        <label>Enter Text (sentences separated by "|" or "?"):</label>
        <textarea id="splitInput" rows="8" placeholder="Enter your text here..."></textarea>

        <label>Result:</label>
        <textarea id="splitOutput" rows="8" readonly placeholder="Result will appear here..."></textarea>

        <button type="button" id="splitButton">Split Text</button>
        <button type="button" id="copyButton" style="margin-top:10px;">Copy Result</button>
    </form>
    <br>

    <form id="runCaptionGenerator">
        <h2 style="background-color:khaki;">5. Generate Captions</h2>
        <h3>Prestep for Audio->WordTimeStamps-Video</h3>
        <div>Run caption_generator.py: Prestep for Audio->WordTimeStamps-Video above
            <ol>
                <li>Place audio.wav (from notebooklm) and then press below button.</li>
                <li>This would create WordTimeStamps file and captions (access from index.html).</li>
                <li>Use captions text on readernook.com and add images.
                    There must be an image at the end of the text</li>
                <li>Then execute above program with Audio->WordTimeStamps-Video</li>
            </ol>

        </div>
        <label>Audio has music (Vocals would be seperated before creating captions):</label>
        <select name="music">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>
        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <div style="background-color: #cfe0ff; padding: 5px;">Create Hindi captions using <a
                href="hindi_caption_builder" target="_blank">hindi_caption_builder</a>
            Export the captions to word_timestamps.json.</div>

        <button type="submit">Create WordTimeStamps and Caption Text</button>
    </form>

    <br>
    <form id="thumbForm">
        <h2>6.Create Thumbnail</h2>
        <h3>Select Thumbnail Image</h3>

        <label>Image Folder:</label>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <select id="imageFolder"></select>
            <div id="imageBreadcrumbs" style="font-size:13px; color:#666;"></div>
        </div>
        <div id="imageContainer" class="grid" style="min-height:110px;"></div>




        <h3>Thumbnail Text and Styles</h3>

        <label>Background Color (Left Side):</label>
        <select id="bgColorSelect" name="bg_color">
            <option value="#000" data-color="#000">Story</option>
            <option value="#9f0b1f" data-color="#9f0b1f">Song</option>
            <option value="#008080" data-color="#008080">Quiz</option>

            <!-- <option value="#101010" data-color="#101010">Dark Gray</option>
            <option value="#1E1E2F" data-color="#1E1E2F">Midnight Blue</option>
            <option value="#0D7377" data-color="#0D7377">Teal</option>
            <option value="#2E8B57" data-color="#2E8B57">Green</option>
            <option value="#FF6600" data-color="#FF6600">Orange</option>
            <option value="#8B0000" data-color="#8B0000">Maroon</option>
            <option value="#800080" data-color="#800080">Purple</option>
            <option value="#F5F5F5" data-color="#F5F5F5">Light Gray</option> -->
        </select>

        <label>Text (use "|" for new lines):</label>
        <textarea name="text" id="textInput" rows="4"
            placeholder="Example: Narak Chaturdashi|‡§®‡§∞‡§ï‡§æ‡§∏‡•Å‡§∞ ‡§µ‡§ß ‡§ï‡•Ä ‡§ï‡§•‡§æ"></textarea>

        <label>Text Colors (comma-separated or 'auto'):</label>
        <input type="text" name="colors" id="colorInput" value="auto">

        <button type="submit">Generate Thumbnail</button>

        <!-- DND - Working but not good enough yet -->
        <!-- <div id="previewContainer">
            <h3>üñºÔ∏è Live Preview</h3>
            <canvas id="previewCanvas"></canvas>
        </div> -->

        <div id="result" style="text-align:center;margin-top:25px;"></div>
        <!-- after #imageContainer -->
        <input type="hidden" name="image" id="selectedImage">
        <!-- after #videoContainer -->
        <input type="hidden" name="video" id="selectedVideo">
        <div class="infoBox">Created thumbnail will be saved as thumbnail.png in the folder edit_vid_thumbnail.</div>

    </form>
    <br>

    <form id="runOBSRecorder">
        <h2>7.OBS Recorder</h2>
        <div> To be run if recording as part of whole Process above failed.
            The output will be created as test.mp4.
            Move that to under processed_video folder with right name before running the YouTube Upload.
        </div>
        <br>
        <label>Language:</label>
        <select id="language" name="language">
            <option>english</option>
            <option>hindi</option>
        </select>

        <label>Orientation:</label>
        <select name="orientation">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label for="captStyle">Caption Style</label>
        <select id="captStyle" name="captStyle">
            <option value="style1">Style 1</option>
            <option value="style2">Style 2</option>
            <option value="style2-hindi-normal">style2-hindi-normal</option>
            <option value="style-hindi-rozha">style-hindi-rozha</option>
            <option value="style3">Style 3</option>
            <option value="style4">Style 4</option>
            <option value="style5">Style 5</option>
            <option value="style6">Style 6</option>
            <option value="style7">Style 7</option>
            <option value="style8">Style 8</option>
            <option value="style9">Style 9</option>
            <option value="style10">Style 10</option>
            <option value="style11">Style 11</option>
            <option value="none">No Caption</option>
            <option value="block-style">Block Caption</option>
            <option value="song-block">song-block</option>
            <option value="story-block">story-block</option>
        </select>


        <label for="captLength">Words per Caption</label>
        <input type="number" id="captLength" name="captLength" value="5" min="1" max="1000">

        <label>Duration (Seconds):</label>
        <input type="text" name="duration" id="audioDuration" placeholder="auto-filled from audio.wav">
        <button type="button" id="getDurationButton">Get Duration</button>


        <label for="minLineGapSec">Min gap between lines (sec)</label>
        <input type="number" id="minLineGapSec" name="minLineGapSec" value="0.40" step="0.05" min="0" />

        <label for="bgMusicSelect">Background Music:</label>
        <select id="bgMusicSelect" name="bgMusicSelect">
            <option value="none">None</option>
            <option value="children-a-baby-story-530.mp3">Children-story</option>
            <option value="children-close-your-eyes-now-1022.mp3">Children-eyes</option>
            <option value="children-lullaby-night-531.mp3">Children-lullaby</option>
            <option value="children-summers-here-91.mp3">Children-summers</option>
            <option value="horror-fright-night-871.mp3">Horror-fright</option>
            <option value="horror-piano-671.mp3">Horror-piano</option>
            <option value="positive-a-very-happy-christmas-897.mp3">Positive-christmas</option>
            <option value="positive-mixkit-fun-jazz-647.mp3">Positive-fun</option>
            <option value="positive-wedding-01-657.mp3">Positive-wedding</option>
            <option value="story-classical-3-710.mp3">Story-1</option>
            <option value="story-classical-6-713.mp3">Story-6</option>
            <option value="story-classical-10-717.mp3">story-10</option>
        </select>

        <label for="disableSubscribe">Disable Subscribe Gif</label>
        <select id="disableSubscribe" name="disableSubscribe">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Output file(e.g.):"edit_vid_output/output.mp4", "test.mp4"</label>
        <input type="text" name="outputfile" value="edit_vid_output/output.mp4">

        <button type="submit">Play video and run OBS Recorder</button>
        <div class="infoBox">This will also save the output as processed_videos/output.mp4</div>
    </form>

    <br>
    <form id="uploadForm">
        <h2>8.Youtube Single Video Upload</h2>
        <div class="row">

            <label>Video size:</label>
            <select name="size">
                <option value="landscape">landscape</option>
                <option value="portrait">portrait</option>
            </select>

            <div>
                <label>Video File (basename without .mp4)</label>
                <input type="text" name="video_path" value="output" required />
                <div class="hint">Default: "output" ‚Üí processed_videos/output.mp4</div>
            </div>

            <div>
                <label>YouTube Channel Name</label>
                <select name="youtube_channel_name" id="channelSelect" required>
                    <option value="">-- Select Channel --</option>
                    <option value="Trend Testers">Trend Testers</option>
                    <option value="Cash Flow Hacks">Cash Flow Hacks</option>
                    <option value="The Parent Pod">The Parent Pod</option>
                    <option value="Indian Stories in English">Indian Stories in English</option>
                    <option value="BhaktiSagar">BhaktiSagar</option>
                    <option value="English Story World">English Story World</option>
                    <option value="Easy Learning">Easy Learning</option>
                </select>
            </div>
        </div>

        <div>
            <label>Playlist</label>
            <select name="youtube_playlist_name" id="playlistSelect">
                <option value="">-- Select Playlist --</option>
            </select>
            <div class="hint">Options update automatically based on the selected channel.</div>
        </div>

        <div>
            <label>Title</label>
            <input type="text" name="youtube_title" maxlength="100" required />
        </div>

        <div>
            <label>Description</label>
            <textarea name="youtube_description" rows="6" placeholder="Video description..."></textarea>
        </div>

        <div>
            <label>Tags (comma-separated)</label>
            <input type="text" name="youtube_tags" placeholder="tag1, tag2, tag3" />
        </div>

        <div class="row">
            <div>
                <label>Made for Kids?</label>
                <select name="made_for_kids">
                    <option value="false" selected>No</option>
                    <option value="true">Yes</option>
                </select>
            </div>
            <div>
                <label>Schedule Date (optional)</label>
                <input type="date" name="schedule_date" />
            </div>
        </div>

        <div class="actions">
            <button type="submit">Upload</button>
        </div>

        <div id="result"></div>

    </form>
    <br>
    <form id="contentForm">
        <h2 style="background-color: yellow;">Content Processor</h2>

        <label>Website URLs (semicolon-separated):</label>
        <textarea name="urls" rows="4"></textarea>
        If want to use prerecorded audios, place them in ready_audio folder with file name matching the title of the
        story/Short
        <label>Audio->WordTimeStamps-Video
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Designed for NotebookLM type audios. There should be image at the end of the shorts text. Shorts
                    text should match with the
                    WordTimeStamps text.
                </span>
            </span>

        </label>
        <select name="notebooklm">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Pick video background and story from Excel:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    For using this option, provide captions, video background,and YouTube metadata in
                    video_story_input.xlsx.
                </span>
            </span>
        </label>
        <select name="excel">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <label>Select TTS Engine:</label>
        <select name="tts">
            {% for key in tts_options.keys() %}
            <option value="{{ key }}">{{ key }}</option>
            {% endfor %}
        </select>

        <label>Select Voice Gender:</label>
        <select name="gender" id="gender" onchange="updateVoices()">
            {% for g in voice_genders %}
            <option value="{{ g }}">{{ g }}</option>
            {% endfor %}
        </select>

        <label>Select Voice:</label>
        <select name="voice" id="voice">
            <!-- Populated by JS -->
        </select>

        <label>Select Video Type:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Ensure camera frames marked on the web page match with the selection. Also OBS studio should have
                    corresponding scene and profile.
                </span>
            </span>
        </label>
        <select name="size">
            {% for label in sizes.keys() %}
            <option value="{{ label }}">{{ label }}</option>
            {% endfor %}
        </select>

        <label>Select Background Music:</label>
        <select name="music">
            {% for filename in music_options.keys() %}
            <option value="{{ filename }}">{{ filename }}</option>
            {% endfor %}
        </select>

        <label>Max Words per Caption:</label>
        <input type="number" name="max_words" min="1" max="1000" value="4">

        <label>Select Caption Style:</label>
        <select name="style">
            {% for style_key in style_options.keys() %}
            <option value="{{ style_key }}">{{ style_key }}</option>
            {% endfor %}
        </select>

        <label>Skip Puppeteer Call:</label>

        <select name="skip_puppeteer">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Skip Captions:</label>
        <select name="skip_captions">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Add Sound Pitch:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Id it is adult, it does not change anything.
                </span>
            </span>
        </label>
        <select name="pitch">
            <option>adult</option>
            <option>child</option>
            <option>teen</option>
            <option>elderly</option>
        </select>

        <label>Disable Subscribe Gif:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Disable it for advertisement videos.
                </span>
            </span>
        </label>
        <select name="disable_subscribe">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <button type="submit">Process</button>
    </form>
    <br>

    <form id="sunoToVideoGenerator">
        <h2 style="background-color:coral">Suno.com song + Video Clip</h2>
        <div>
            <ol>
                <li>Place song audio.wav inside edit_vid_audio.</li>
                <li>Place video clip (5/8 secs) at edit_vid_input. (Change slow down factor below if needed)</li>
                <li>Click on below button</li>
                <li>This would make longer clip by slowing speed and then create video by repeating to audio length
                    It will then place the video as composed_video.mp4 inside the root folder.
                    And will place the input audio file as audio.wav inside the root folder.
                </li>
                <li>Then for <b>English</b> language audio</li>
                <ul>
                    <li>it will call script to make WordTimeStamps file.</li>
                    <li>After processing is done, review the captions at <a href="prepare_captions" target="_blank">Open
                            Caption Editor</a>
                        (Opens in new tab) and make necessary change. </li>
                    <li>Then Run OBS Recorder to create final video for upload. Parameters: Caption-style1, words per
                        caption-10,outputfile - edit_vid_output/output.mp4 </li>
                </ul>
                <!-- <li>For <b>Hindi</b> language audio, if provided size is Landscape it will also create portait video so
                    that captions can be applied together</li> -->

            </ol>

        </div>

        <label>Audio has music (Vocals would be seperated before creating captions):</label>
        <select name="music">
            <option value="yes">yes</option>
            <option value="no">no</option>
        </select>

        <!-- <label>Slow down video clips by factor:</label>
        <input type="number" name="slowfactor" min="1" max="10" value="4"> -->

        <label>Change speed by factor (e.g. 2.0/3.0 will make video 2/3 times longer, 0.5 for 2 x faster):</label>
        <input type="number" name="slowfactor" step="any" placeholder="4.0">

        <label>Input clip size:</label>
        <select name="size">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <button type="submit">Create Video and Caption Text</button>

        For <b>Hindi</b> language audio
        <ul>
            <li>Create Hindi captions using <a href="hindi_caption_builder" target="_blank">hindi_caption_builder</a>
                Export the captions to word_timestamps.json.</li>
            <li>Then Run OBS Recorder to create final video for upload. Parameters: Language-Hindi, Caption-style4,
                words per
                caption-1,outputfile - edit_vid_output/output.mp4 </li>

            <!-- <li><a href="apply_caption" target="_blank">Create Videos with Caption</a>. If input clip
                size is "landscape", Create video button will additionally create Portrait
                video with captions in the edit_vid_output folder.</li> -->
        </ul>
    </form>
    <br>


    <form id="sunoNImageToVideoGenerator">
        <h2>Suno.com song + Images</h2>
        <div>
            <ol>
                <li>Place song audio.wav inside edit_vid_audio.</li>
                <li>Place images in edit_vid_input. (If needed, change input image size and clip duration for each image
                    )</li>
                <li>Click on below button</li>
                <li>This would make video clips and then create video by repeating to audio length
                    It will then place the video as composed_video.mp4 inside the root folder.
                    And will place the input audio file as audio.wav inside the root folder.
                </li>
                <li>Then for <b>English</b> language audio</li>
                <ul>
                    <li>it will call script to make WordTimeStamps file.</li>
                    <li>After processing is done, review the captions at <a href="prepare_captions" target="_blank">Open
                            Caption Editor</a>
                        (Opens in new tab) and make necessary change. </li>
                    <li>Then Run OBS Recorder to create final video for upload. Parameters: Caption-style1, words per
                        caption-10,outputfile - edit_vid_output/output.mp4 </li>
                </ul>
                <!-- <li>For <b>Hindi</b> language audio, if provided size is Landscape it will also create portait video so
                    that captions can be applied together</li> -->

            </ol>

        </div>

        <label>Audio has music (Vocals would be seperated before creating captions):</label>
        <select name="music">
            <option value="yes">yes</option>
            <option value="no">no</option>
        </select>

        <label>Input image size:</label>
        <select name="size">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Duration of video per image (Seconds):</label>
        <input type="number" name="duration" min="1" max="60" value="20">

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <button type="submit">Create Video and Caption Text</button>

        For <b>Hindi</b> language audio
        <ul>
            <li>Create Hindi captions using <a href="hindi_caption_builder" target="_blank">hindi_caption_builder</a>
                Export the captions to word_timestamps.json.</li>
            <li>Then Run OBS Recorder to create final video for upload. Parameters: Language-Hindi, Caption-style4,
                words per
                caption-1,outputfile - edit_vid_output/output.mp4 </li>

            <!-- <li><a href="apply_caption" target="_blank">Create Videos with Caption</a>. If input clip
                size is "landscape", Create video button will additionally create Portrait
                video with captions in the edit_vid_output folder.</li> -->
        </ul>
    </form>
    <br>

    <form id="uploadToYoutube">
        <h2>Youtube Bulk Upload</h2>
        <div> To be run after video created in Processed_video folder and record is added in video_records.xlsx


        </div>

        <p class="hint">
            <b>Note:</b> Your uploader expects <code>video_path</code> to be the filename (without .mp4),
            and it will look under <code>processed_videos/&lt;video_path&gt;.mp4</code>.
        </p>

        <button type="submit">Upload Videos to Youtube</button>
    </form>


    <br>

    <form id="aiVideoPromptMaker">
        <h2>AI Video Prompt Maker</h2>
        <a href="aivideoprompt" target="_blank">Open AI Video Prompt Maker</a>
        (Opens in new tab)
    </form>

    <br>
    <form id="runVideoEditor">
        <h2>Video Editor</h2>
        <div> To be used to slow (pixverse) video speed to increase length. Cut portion of video to remove watermark.
            Add own watermark. Add background audio.
            <br><br>Place the input mp4 files in edit_vid_input folder. Output files will be created in edit_vid_output.
        </div>
        <br>
        <label>Orientation:</label>
        <select name="orientation">
            <option value="auto">auto</option>
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Background Music:</label>
        <select name="bgmusic">
            <option value="none">none</option>
            <option value="god_bg">Random from folder god_bg</option>
        </select>

        <label>Remove from Top(leave blank/50/60):</label>
        <input type="number" name="topcut">

        <label>Remove from bottom(leave blank/50/60):</label>
        <input type="number" name="bottomcut">

        <label>Change speed by factor (e.g. 2.0/3.0 will make video 2/3 times longer, 0.5 for 2 x faster):</label>
        <input type="number" name="slowfactor" step="any" placeholder="2.0">


        <!-- <label>Watermark:</label>
        <select name="watermark">
            <option value="none">none</option>
            <option value="logo.png">logo.png</option>
        </select> -->

        <label>Watermark position:</label>
        <select name="watermarkposition">
            <option value="none">none</option>
            <option value="bottom-left">bottom-left</option>
            <option value="bottom-right">bottom-right</option>
            <option value="top-left">top-left</option>
            <option value="top-right">top-right</option>
        </select>

        <button type="submit">Process Videos</button>
    </form>
    <br>
    <form id="addOverlay">
        <h2>Add Overlay</h2>
        <div> To be used to add flower petals/sparkle on the video.
            <br><br>Place the input mp4 files in edit_vid_input folder. Output files will be created in edit_vid_output.
        </div>
        <br>
        <label>Add Petals:</label>
        <select name="add_petals">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Add Sparkles:</label>
        <select name="add_sparkles">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <button type="submit">Process Videos</button>
    </form>

    <br>
    <form id="multiplyVideo">
        <h2>Multiply Video/Audio</h2>
        <div> To be used to repeat the video/audio by a factor.
            <br><br>Place the input mp4/mp3 files in edit_vid_input folder. Output files will be created in
            edit_vid_output. E.g. enter 10 if the video is to be made 10 times long
        </div>
        <br>
        <label>Repeat Factor:</label>
        <input type="number" name="repeat_factor" min="1" value="1">

        <button type="submit">Process Videos</button>
    </form>

    <br>
    <form id="makeKBVideoFromImages">
        <h2>Make Ken Burn Videos from Images</h2>
        <div> To be used to make image video clips that will be used to make song videos later.
            <br><br>Place the images in edit_vid_input folder. Output files will be created in edit_vid_output.
        </div>

        <label>Input image size:</label>
        <select name="size">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Duration of video per image (Seconds):</label>
        <input type="number" name="duration" min="1" max="60" value="20">
        <button type="submit">Process Images</button>
    </form>

    <br>
    <form id="thumbnailMaker">
        <h2>Old Thumbnail Maker</h2>
        <a href="thumbnail" target="_blank">Open Thumbnail Maker</a>
        (Opens in new tab)
    </form>

    <br>
    <form id="quizMaker">
        <h2>Quiz Video Maker</h2>
        <a href="quiz" target="_blank">Open Quiz Video Maker</a>
        (Opens in new tab)
    </form>

    <br>
    <form id="splitVideoToParts">
        <h2>Split long video to parts </h2>
        <div> Can be used for creating shorts for upload.
            <br><br>Picks the input from edit_vid_output/output.mp4. Parts are created in edit_vid_output folder.

        </div>
        <label>Max lenth of parts (Seconds):</label>
        <input type="number" name="duration" min="1" max="1000" value="170">
        <button type="submit">Create Video</button>
    </form>
    <br>

    <form id="mixVocalMusicForm">
        <h2 style="background:#d1fae5;">Merge Vocal + Music ‚Üí Pro Mix</h2>

        <label>Vocal file (optional):</label>
        <input type="file" name="vocal_file" accept=".wav,.mp3,.m4a,.flac,.aac,.ogg" />

        <label>Music file (optional):</label>
        <input type="file" name="music_file" accept=".wav,.mp3,.m4a,.flac,.aac,.ogg" />

        <div class="infoBox">
            If you don‚Äôt upload files, the server will try to auto-pick from
            <code>edit_vid_audio/</code> (e.g. names containing <i>vocal/vox</i> and <i>music/bg/instrumental</i>) or
            the first two audio files it finds.
        </div>

        <label>Output format:</label>
        <select name="format">
            <option value="wav" selected>WAV</option>
            <option value="mp3">MP3 (requires ffmpeg)</option>
        </select>

        <label>Target loudness (LUFS):</label>
        <input type="number" step="0.1" name="target_lufs" value="-14">

        <label>Music start gain (dB):</label>
        <input type="number" step="0.5" name="music_gain_db" value="-10">

        <label>Ducking depth under vocal (dB):</label>
        <input type="number" step="0.5" name="duck_db" value="10">

        <label>Music floor even with quiet vocal (dB):</label>
        <input type="number" step="0.5" name="duck_floor_db" value="-1">

        <button type="submit">Create Professional Mix</button>

        <div id="mixResult" style="margin-top:10px;text-align:center;"></div>
    </form>


    <br>
    <form id="polishAudioForm">
        <h2 style="background:#ffeaa7;">Polish Phone Audio ‚Üí Studio (Adaptive)</h2>

        <label>Audio source:</label>
        <div style="font-size:13px;color:#555;margin:-6px 0 8px;">
            Upload a file (optional). Otherwise the server uses the first file in <code>edit_vid_audio/</code> or
            <code>audio.wav</code> in project root.
        </div>
        <input type="file" name="audio_file" accept=".wav,.m4a,.mp3,.aac,.flac,.ogg" />

        <label>Noise handling:</label>
        <select name="denoise">
            <option value="auto" selected>auto (detect per file)</option>
            <option value="none">none</option>
            <option value="light">light</option>
            <option value="medium">medium</option>
            <option value="strong">strong</option>
        </select>

        <label>High-pass (Hz):</label>
        <input type="number" name="hp" value="80" min="0" />

        <label>Low-pass (Hz, 0=off):</label>
        <input type="number" name="lp" value="12000" min="0" />

        <label>De-esser intensity (0‚Äì10):</label>
        <input type="number" name="deess" value="5" min="0" max="10" />

        <label>Target loudness (LUFS):</label>
        <input type="number" name="target_lufs" step="0.1" value="-16" />

        <label>True-peak limit (dBTP):</label>
        <input type="number" name="tp" step="0.1" value="-1.5" />

        <label>LRA target:</label>
        <input type="number" name="lra" step="0.1" value="11" />

        <label>Force mono?</label>
        <select name="mono">
            <option value="true">true</option>
            <option value="false" selected>false</option>
        </select>

        <label>Sample rate (Hz, blank=keep):</label>
        <input type="number" name="ar" placeholder="48000" />

        <label>Use speechnorm (if FFmpeg supports it)?</label>
        <select name="speechnorm">
            <option value="false" selected>false</option>
            <option value="true">true</option>
        </select>

        <button type="submit">Polish Audio</button>
        <div id="polishAudioResult" class="infoBox" style="display:none;"></div>
    </form>

    <br>

    <script>
        (function () {
            const form = document.getElementById('mixVocalMusicForm');
            if (!form) return;
            const result = document.getElementById('mixResult');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                result.innerHTML = '‚è≥ Mixing‚Ä¶';

                const fd = new FormData(form);
                try {
                    const resp = await fetch('/mix_vocal_music', { method: 'POST', body: fd });
                    const data = await resp.json();
                    if (!resp.ok || !data.ok) throw new Error(data.error || 'Mix failed');

                    const url = data.download;
                    const meta = data.meta || {};
                    result.innerHTML = `
        <div class="infoBox">‚úÖ Mix created.</div>
        <audio controls src="${url}" style="width:100%;max-width:520px;"></audio>
        <div style="margin-top:8px;">
          <a href="${url}" download>‚¨áÔ∏è Download</a>
        </div>
        <pre style="text-align:left;white-space:pre-wrap;background:#f8fafc;padding:8px;border-radius:8px;">
${JSON.stringify(meta, null, 2)}
        </pre>
      `;
                } catch (err) {
                    result.innerHTML = `<div class="infoBox" style="background:#ffe0e0;">‚ùå ${err.message}</div>`;
                }
            });
        })();
    </script>

    <script>
        (() => {
            const form = document.getElementById('polishAudioForm');
            const resultBox = document.getElementById('polishAudioResult');
            if (!form) return;

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                resultBox.style.display = 'block';
                resultBox.textContent = 'Processing...';

                const fd = new FormData(form);
                try {
                    const res = await fetch('/polish_audio', { method: 'POST', body: fd });
                    const data = await res.json();
                    if (!res.ok || !data.ok) throw new Error(data.error || 'Server error');

                    // Show a download link + summary
                    const meta = data.meta || {};
                    const dl = data.download || '';
                    resultBox.innerHTML = `
        ‚úÖ Done. <a href="${dl}" target="_blank">Download audio_clean.m4a</a><br>
        <small>
          denoise=${meta.denoise_mode} (nr=${meta.denoise_nr}) |
          HP=${meta.highpass_hz}Hz |
          LP=${meta.lowpass_hz ?? 'off'} |
          deess=${meta.deess_intensity} |
          target=${meta.target_lufs} LUFS / TP=${meta.tp_limit_dbTP} dBTP |
          mono=${meta.force_mono} | ar=${meta.samplerate || 'keep'}
        </small>
      `;
                } catch (err) {
                    resultBox.textContent = '‚ùå ' + err.message;
                }
            });
        })();
    </script>

    <script>
        // üéØ Playlist mappings for each YouTube channel
        const playlistMap = {
            "Trend Testers": [
                "Top 10 Baby Products",
                "Tech Product Reviews",
                "Smart Gadgets 2025"
            ],
            "Cash Flow Hacks": [
                "Side Hustle of the Day",
                "1-Minute Rich Habits",
                "Passive Income Ideas",
                "Make Money Online"
            ],
            "Easy Learning": [
                "General Knowledge",
                "French",
                "History",
                "Analytical Reasoning"
            ],
            "The Parent Pod": [
                "Songs",
                "Parenting Tips",
                "Baby & Toddler Advice",
                "Parent Stories"
            ],
            "Indian Stories in English": [
                "Shiv Stories",
                "Lakshmi Stories",
                "Krishna Stories",
                "Hanumanji Stories",
                "Ganeshji Stories",
                "Durgaji Stories",
                "Bhakti Sthal Stories"
            ],
            "BhaktiSagar": [
                "Krishna Stories",
                "Lakshmi",
                "Durga",
                "Ganesh ji",
                "Shiv Ji Stories",
                "Bhakti Sthal Stories"
            ],
            "English Story World": [
                "Fun Fact Stories",
                "Historical Mini Stories",
                "Mysterious Facts"
            ]
        };

        const channelSelect = document.getElementById("channelSelect");
        const playlistSelect = document.getElementById("playlistSelect");

        // üîÑ Populate playlist dropdown dynamically
        channelSelect.addEventListener("change", () => {
            const selectedChannel = channelSelect.value;
            const playlists = playlistMap[selectedChannel] || [];

            playlistSelect.innerHTML = ""; // clear existing
            const defaultOption = document.createElement("option");
            defaultOption.value = "";
            defaultOption.textContent = playlists.length ? "-- Select Playlist --" : "-- No Playlists Available --";
            playlistSelect.appendChild(defaultOption);

            playlists.forEach(p => {
                const opt = document.createElement("option");
                opt.value = p;
                opt.textContent = p;
                playlistSelect.appendChild(opt);
            });
        });

        // üß† Handle form submission
        const form = document.getElementById("uploadForm");
        const result = document.getElementById("result");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            console.log("Processing request...Upload to YouTube")
            result.textContent = "Uploading‚Ä¶ Chrome will open. Please don‚Äôt touch it.";
            result.className = "";

            const data = new FormData(form);
            try {
                const res = await fetch("/upload", { method: "POST", body: data });
                const json = await res.json();
                console.log("Completed request...Upload to YouTube")
                if (json.ok) {
                    result.innerHTML = `‚úÖ <span class="ok">Success!</span> Video URL: <a href="${json.video_url}" target="_blank">${json.video_url}</a>`;
                } else {
                    result.innerHTML = `‚ùå <span class="err">Error:</span> ${json.error || "Unknown error"}`;
                }
            } catch (err) {
                result.innerHTML = `‚ùå <span class="err">${String(err)}</span>`;
            }
        });
    </script>

    <script>
        // const canvas = document.getElementById('previewCanvas');
        // const ctx = canvas.getContext('2d');
        // canvas.width = 640;
        // canvas.height = 360;
        let selectedImage = null;
        let selectedBgColor = '#101010';
        let currentImageFolder = '';
        let currentVideoFolder = '';

        function breadcrumbsHTML(crumbs, rootLabel = 'root') {
            if (!crumbs || crumbs.length === 0) return `<span>${rootLabel}</span>`;
            const parts = [`<a href="#" data-path="">${rootLabel}</a>`];
            crumbs.forEach(c => {
                parts.push(`&nbsp;/&nbsp;<a href="#" data-path="${c.path}">${c.name}</a>`);
            });
            return parts.join('');
        }

        async function loadImageFolder(folder = '') {
            const res = await fetch('/list_thumbnail_images?folder=' + encodeURIComponent(folder));
            if (!res.ok) { console.error('images list failed'); return; }
            const data = await res.json();
            currentImageFolder = data.cwd || '';

            // folder dropdown (all folders)
            const sel = document.getElementById('imageFolder');
            sel.innerHTML = '';
            (data.all_folders || ['']).forEach(f => {
                const opt = document.createElement('option');
                opt.value = f;
                opt.textContent = f || '(root)';
                if (f === currentImageFolder) opt.selected = true;
                sel.appendChild(opt);
            });

            // breadcrumbs
            const bc = document.getElementById('imageBreadcrumbs');
            bc.innerHTML = breadcrumbsHTML(data.breadcrumbs);
            bc.querySelectorAll('a').forEach(a => {
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadImageFolder(a.dataset.path || '');
                });
            });

            // thumbnails
            const c = document.getElementById('imageContainer');
            c.innerHTML = '';
            (data.files || []).forEach(src => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `<img src="${src}" alt="">`;
                div.onclick = () => {
                    document.querySelectorAll('#imageContainer .item').forEach(d => d.classList.remove('selected'));
                    div.classList.add('selected');
                    selectedImage = src;
                    document.getElementById('selectedImage').value = src;
                    // drawPreview();
                };
                c.appendChild(div);
            });

            // subfolder tiles (click to drill down)
            (data.folders || []).forEach(sub => {
                const tile = document.createElement('div');
                tile.className = 'item';
                tile.style.width = '160px'; tile.style.height = '100px';
                tile.style.display = 'grid'; tile.style.placeItems = 'center';
                tile.style.background = '#f1f5f9'; tile.style.border = '1px dashed #cbd5e1';
                tile.textContent = 'üìÅ ' + sub.split('/').pop();
                tile.onclick = () => loadImageFolder(sub);
                document.getElementById('imageContainer').appendChild(tile);
            });
        }

        // -------- Live Preview Drawing --------
        async function drawPreview() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Left panel
            const bg = selectedBgColor || '#101010';
            const leftWidth = canvas.width / 2;
            ctx.fillStyle = bg;
            ctx.fillRect(0, 0, leftWidth, canvas.height);

            // Right image
            if (selectedImage) {
                const img = new Image();
                img.src = selectedImage;
                await new Promise(res => { img.onload = res; });
                const rightWidth = canvas.width - leftWidth;
                ctx.drawImage(img, leftWidth, 0, rightWidth, canvas.height);
            }

            // Text overlay
            const text = document.getElementById('textInput').value.trim();
            if (text) {
                const lines = text.split('|');
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                let y = canvas.height / 2 - ((lines.length - 1) * 40);
                lines.forEach((line, i) => {
                    ctx.font = 'bold 30px Arial';
                    ctx.fillStyle = '#FFFFFF';
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 3;
                    ctx.strokeText(line, leftWidth / 2, y);
                    ctx.fillText(line, leftWidth / 2, y);
                    y += 60;
                });
            }
        }

        async function loadVideoFolder(folder = '') {
            const res = await fetch('/list_background_videos?folder=' + encodeURIComponent(folder));
            if (!res.ok) { console.error('videos list failed'); return; }
            const data = await res.json();
            currentVideoFolder = data.cwd || '';

            const sel = document.getElementById('videoFolder');
            sel.innerHTML = '';
            (data.all_folders || ['']).forEach(f => {
                const opt = document.createElement('option');
                opt.value = f;
                opt.textContent = f || '(root)';
                if (f === currentVideoFolder) opt.selected = true;
                sel.appendChild(opt);
            });

            const bc = document.getElementById('videoBreadcrumbs');
            bc.innerHTML = breadcrumbsHTML(data.breadcrumbs);
            bc.querySelectorAll('a').forEach(a => {
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadVideoFolder(a.dataset.path || '');
                });
            });

            const c = document.getElementById('videoContainer');
            c.innerHTML = '';
            (data.files || []).forEach(src => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `<video src="${src}" muted></video>`;
                div.onclick = async () => {
                    document.querySelectorAll('#videoContainer .item').forEach(d => d.classList.remove('selected'));
                    div.classList.add('selected');
                    document.getElementById('selectedVideo').value = src;
                    // await fetch('/select_background_video', {
                    //     method: 'POST',
                    //     headers: { 'Content-Type': 'application/json' },
                    //     body: JSON.stringify({ video: src })
                    // }).catch(console.error);
                };
                c.appendChild(div);
            });

            (data.folders || []).forEach(sub => {
                const tile = document.createElement('div');
                tile.className = 'item';
                tile.style.width = '160px'; tile.style.height = '100px';
                tile.style.display = 'grid'; tile.style.placeItems = 'center';
                tile.style.background = '#f1f5f9'; tile.style.border = '1px dashed #cbd5e1';
                tile.textContent = 'üìÅ ' + sub.split('/').pop();
                tile.onclick = () => loadVideoFolder(sub);
                c.appendChild(tile);
            });
        }

        // react to folder dropdown changes
        document.addEventListener('change', (e) => {
            if (e.target.id === 'imageFolder') loadImageFolder(e.target.value);
            if (e.target.id === 'videoFolder') loadVideoFolder(e.target.value);
        });

        // -------- Events --------
        document.getElementById('bgColorSelect').onchange = e => {
            selectedBgColor = e.target.value;
            // drawPreview();
        };
        // document.getElementById('textInput').oninput = drawPreview;
        // document.getElementById('colorInput').oninput = drawPreview;

        document.getElementById('thumbForm').onsubmit = async e => {
            e.preventDefault();
            const fd = new FormData(e.target);
            const res = await fetch('/generate_thumbnail', { method: 'POST', body: fd });
            const result = await res.json();
            const r = document.getElementById('result');
            r.innerHTML = result.thumbnail
                ? `<p>${result.message}</p><img src="${result.thumbnail}?v=${Date.now()}" width="640">`
                : `<p style="color:red;">${result.error}</p>`;
        };
        document.getElementById('bgVideoForm').onsubmit = async e => {
            e.preventDefault();
            src = document.getElementById('selectedVideo').value
            //const res = await fetch('/select_background_video', { method: 'POST', body: JSON.stringify({ video: src }) }).catch(console.error);;
            await fetch('/select_background_video', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ video: src })
            }).catch(console.error);
            console.log("Completed Processing");

        };



        // init
        window.addEventListener('load', () => {
            loadImageFolder('').catch(console.error);
            loadVideoFolder('').catch(console.error);
        });
    </script>



    <script>


        async function fetchAudioDuration() {
            const durationInput = document.getElementById('audioDuration');
            const form = document.getElementById('runOBSRecorder');
            const orientationSelect = form.querySelector('select[name="orientation"]');
            try {
                const res = await fetch('/api/audio-duration?v=' + Date.now()); // cache-bust
                if (!res.ok) {
                    alert('audio.wav not found (server returned ' + res.status + ').');
                    return;
                }
                let { seconds } = await res.json();
                if (orientationSelect.value === 'portrait') {
                    if (seconds > 176) {
                        seconds = 176;
                    }
                }
                durationInput.value = Number(seconds + 2).toFixed(2); // Added 2 seconds
            } catch (e) {
                console.error(e);
                alert('Error fetching audio duration.');
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('getDurationButton')?.addEventListener('click', fetchAudioDuration);
            // Or auto-run: fetchAudioDuration();
        });
        document.getElementById("splitButton").addEventListener("click", () => {
            const input = document.getElementById("splitInput").value.trim();
            if (!input) {
                alert("Please enter some text first!");
                return;
            }

            // Match sentences that end with either | or ?
            // Use a regex that captures the splitter too
            const parts = input.match(/[^‡•§?]+[‡•§?]/g);

            if (!parts) {
                alert("No '|' or '?' found in the text.");
                return;
            }

            // Clean and join with newlines (keeping the splitters)
            const result = parts.map(s => s.trim()).join("\n");

            document.getElementById("splitOutput").value = result;
        });

        // Optional: Copy result to clipboard
        document.getElementById("copyButton").addEventListener("click", () => {
            const output = document.getElementById("splitOutput");
            if (!output.value.trim()) {
                alert("Nothing to copy!");
                return;
            }
            output.select();
            document.execCommand("copy");
            alert("Copied to clipboard!");
        });

        // 1) Build a label for each form based on its H2 (fallback to form id)
        function slugToLabel(slug) {
            return slug
                .replace(/[-_]+/g, ' ')
                .replace(/\b\w/g, c => c.toUpperCase());
        }

        function buildTopNav() {
            const container = document.getElementById('topNavLinks');
            if (!container) return;

            // Select all forms that have an ID
            const forms = Array.from(document.querySelectorAll('form[id]'));

            const frag = document.createDocumentFragment();

            forms.forEach(form => {
                const id = form.id;
                const h2 = form.querySelector('h2');
                const label = (h2 && h2.textContent.trim()) || slugToLabel(id);

                const a = document.createElement('a');
                a.href = `#${id}`;
                a.textContent = label.length > 30 ? label.slice(0, 30) + '‚Ä¶' : label;
                a.dataset.target = id;
                frag.appendChild(a);
            });

            container.innerHTML = '';
            container.appendChild(frag);
        }

        // 2) Highlight the active link while scrolling
        function activateOnScroll() {
            const links = Array.from(document.querySelectorAll('.topnav a'));
            const map = new Map(links.map(a => [a.dataset.target, a]));

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const id = entry.target.id;
                    const link = map.get(id);
                    if (!link) return;

                    if (entry.isIntersecting) {
                        links.forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                        // Ensure the active pill stays in view when scrolled
                        link.scrollIntoView({ block: 'nearest', inline: 'nearest' });
                    }
                });
            }, {
                rootMargin: '-60px 0px -70% 0px', // triggers as the form‚Äôs top passes under the nav
                threshold: 0
            });

            document.querySelectorAll('form[id]').forEach(section => observer.observe(section));
        }

        // 3) Prevent the fixed-nav from covering the target when navigating via hash (extra-safe)
        function offsetHashJump() {
            const headerH = document.querySelector('.topnav')?.offsetHeight || 64;
            if (location.hash) {
                const el = document.querySelector(location.hash);
                if (el) window.scrollTo({ top: el.getBoundingClientRect().top + window.pageYOffset - (headerH + 8) });
            }
            window.addEventListener('hashchange', () => {
                const el = document.querySelector(location.hash);
                if (el) {
                    const headerH2 = document.querySelector('.topnav')?.offsetHeight || 64;
                    window.scrollTo({ top: el.getBoundingClientRect().top + window.pageYOffset - (headerH2 + 8), behavior: 'smooth' });
                }
            });
        }

        // 4) Init
        document.addEventListener('DOMContentLoaded', () => {
            buildTopNav();
            activateOnScroll();
            offsetHashJump();
        });
        // Build both the top pills and the expanded grid
        function collectForms() {
            return Array.from(document.querySelectorAll('form[id]')).map(f => {
                const id = f.id;
                const h2 = f.querySelector('h2');
                const label = (h2 && h2.textContent.trim()) ||
                    id.replace(/[-_]+/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
                return { id, label };
            });
        }

        function buildTopNav() {
            const container = document.getElementById('topNavLinks');
            if (!container) return;
            const frag = document.createDocumentFragment();
            collectForms().forEach(({ id, label }) => {
                const a = document.createElement('a');
                a.href = `#${id}`;
                a.textContent = label.length > 30 ? label.slice(0, 30) + '‚Ä¶' : label;
                a.dataset.target = id;
                frag.appendChild(a);
            });
            container.innerHTML = '';
            container.appendChild(frag);
        }

        function buildExpandedNav() {
            const grid = document.getElementById('navGrid');
            if (!grid) return;
            const frag = document.createDocumentFragment();

            collectForms()
                .sort((a, b) => a.label.localeCompare(b.label)) // alphabetical
                .forEach(({ id, label }) => {
                    const a = document.createElement('a');
                    a.href = `#${id}`;
                    a.textContent = label;
                    a.dataset.target = id;
                    frag.appendChild(a);
                });

            grid.innerHTML = '';
            grid.appendChild(frag);
        }

        // Open/close helpers
        function openNavPanel() {
            document.getElementById('navBackdrop').hidden = false;
            document.getElementById('navExpand').hidden = false;
            document.getElementById('navToggle').setAttribute('aria-expanded', 'true');
            document.getElementById('navSearch').focus();
        }
        function closeNavPanel() {
            document.getElementById('navBackdrop').hidden = true;
            document.getElementById('navExpand').hidden = true;
            document.getElementById('navToggle').setAttribute('aria-expanded', 'false');
            // clear filter
            const s = document.getElementById('navSearch');
            if (s && s.value) { s.value = ''; filterNav(''); }
        }

        // Filter items while typing
        function filterNav(q) {
            const items = document.querySelectorAll('#navGrid a');
            const term = q.trim().toLowerCase();
            items.forEach(a => {
                const show = a.textContent.toLowerCase().includes(term);
                a.style.display = show ? '' : 'none';
            });
        }

        // Wire up events
        document.addEventListener('DOMContentLoaded', () => {
            buildTopNav();
            buildExpandedNav();

            // Keep existing active-on-scroll behavior you already added
            // (no changes needed)

            const toggle = document.getElementById('navToggle');
            const closeBtn = document.getElementById('navClose');
            const backdrop = document.getElementById('navBackdrop');
            const grid = document.getElementById('navGrid');
            const search = document.getElementById('navSearch');

            toggle?.addEventListener('click', () => {
                const expanded = toggle.getAttribute('aria-expanded') === 'true';
                expanded ? closeNavPanel() : openNavPanel();
            });
            closeBtn?.addEventListener('click', closeNavPanel);
            backdrop?.addEventListener('click', closeNavPanel);

            // Close on ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !document.getElementById('navExpand').hidden) closeNavPanel();
            });

            // Navigate & close when clicking an item
            grid?.addEventListener('click', (e) => {
                if (e.target.tagName === 'A') closeNavPanel();
            });

            // Live filter
            search?.addEventListener('input', (e) => filterNav(e.target.value));
        });
    </script>

    <script>
        const voices = {{ voice_map | tojson }};
        function updateVoices() {
            const gender = document.getElementById("gender").value;
            const voiceDropdown = document.getElementById("voice");
            const voiceList = voices[gender];

            voiceDropdown.innerHTML = '';
            voiceList.forEach(function (v) {
                const opt = document.createElement("option");
                opt.value = v;
                opt.text = v;
                voiceDropdown.appendChild(opt);
            });
        }

        // On page load, initialize voices for default gender
        window.addEventListener('load', updateVoices);


        document.getElementById('contentForm').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...");
            const formData = new FormData(this);
            const response = await fetch('/process', {
                method: 'POST',
                body: formData
            });
            const result = await response.text();
            console.log("Completed Processing");
            // alert(result);
        };

        document.getElementById('runCaptionGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...caption");
            const formData = new FormData(this);
            const response = await fetch('/caption', {
                method: 'POST',
                body: formData
            });
            const result = await response.text();
            console.log("Completed creating caption");
            // alert(result);
        };
        document.getElementById('uploadToYoutube').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...upload_videos");
            const response = await fetch('/bulkupload', {
                method: 'POST'
            });
            const result = await response.text();
            console.log("Completed upload");
            // alert(result);
        };


        document.getElementById('runOBSRecorder').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...run OBS recorder");
            const formData = new FormData(this);
            const response = await fetch('/runobsrecorder', {
                method: 'POST',
                body: formData
            });
            console.log("Completed OBS recorder run");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('runVideoEditor').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...edit Videos");
            const formData = new FormData(this);
            const response = await fetch('/editvideos', {
                method: 'POST',
                body: formData
            });
            console.log("Completed ..edit Videos");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('addOverlay').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...add overlay");
            const formData = new FormData(this);
            const response = await fetch('/addoverlays', {
                method: 'POST',
                body: formData
            });
            console.log("Completed add overlay");
            const result = await response.text();
            // alert(result);
        };
        document.getElementById('multiplyVideo').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...multiply video");
            const formData = new FormData(this);
            const response = await fetch('/multiplyvideo', {
                method: 'POST',
                body: formData
            });
            console.log("Completed multiply video");
            const result = await response.text();
            // alert(result);
        };
        document.getElementById('makeKBVideoFromImages').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...make Ken Burn Videos from Images");
            const formData = new FormData(this);
            const response = await fetch('/makekbvideofromimages', {
                method: 'POST',
                body: formData
            });
            console.log("Completed make Ken Burn Videos from Images");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('asseleClipsToMakeVideoSong').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...Assemble small video clips to make video song");
            const formData = new FormData(this);
            const response = await fetch('/assembleclipstomakevideosong', {
                method: 'POST',
                body: formData
            });
            console.log("Completed Assemble small video clips to make video song");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('splitVideoToParts').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...splitVideoToParts");
            const formData = new FormData(this);
            const response = await fetch('/splitvideotoparts', {
                method: 'POST',
                body: formData
            });
            console.log("Completed splitVideoToParts");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('sunoToVideoGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...sunoToVideoGenerator");
            const formData = new FormData(this);
            const response = await fetch('/sunotovideogenerator', {
                method: 'POST',
                body: formData
            });
            console.log("Completed sunoToVideoGenerator");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('generateTTSAudio').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...generateTTSAudio");
            const formData = new FormData(this);
            const response = await fetch('/generatettsaudio', {
                method: 'POST',
                body: formData
            });
            console.log("Completed generateTTSAudio");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('sunoNImageToVideoGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...sunoNImageToVideoGenerator");
            const formData = new FormData(this);
            const response = await fetch('/sunonimagetovideogenerator', {
                method: 'POST',
                body: formData
            });
            console.log("Completed sunoNImageToVideoGenerator");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('sunoNImageToVideoGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...sunoNImageToVideoGenerator");
            const formData = new FormData(this);
            const response = await fetch('/sunonimagetovideogenerator', {
                method: 'POST',
                body: formData
            });
            console.log("Completed sunoNImageToVideoGenerator");
            const result = await response.text();
            // alert(result);
        };


        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('runOBSRecorder');
            if (!form) return; // safety

            const orientationSelect = form.querySelector('select[name="orientation"]');
            const captionStyleSelect = form.querySelector('select[name="captStyle"]');
            const captionLengthInput = form.querySelector('input[name="captLength"]');
            const languageSelect = form.querySelector('select[name="language"]');
            const bgMusicSelect = form.querySelector('select[name="bgMusicSelect"]');
            const minLineGapSecInput = form.querySelector('input[name="minLineGapSec"]');

            // ‚úÖ pass the function reference (no parentheses)
            if (orientationSelect && captionStyleSelect && captionLengthInput) {
                orientationSelect.addEventListener('change', updateCaptionDefaults);
            }
            captionStyleSelect.addEventListener('change', updateCaptionDefaults);
            languageSelect.addEventListener('change', updateCaptionDefaults);

            // ‚úÖ set initial values once on load
            updateCaptionDefaults();
        });

        function updateCaptionDefaults() {
            const form = document.getElementById('runOBSRecorder');
            const orientationSelect = form.querySelector('select[name="orientation"]');
            const captionStyleSelect = form.querySelector('select[name="captStyle"]');
            const captionLengthInput = form.querySelector('input[name="captLength"]');
            const languageSelect = form.querySelector('select[name="language"]');
            const bgMusicSelect = form.querySelector('select[name="bgMusicSelect"]');
            const minLineGapSecInput = form.querySelector('input[name="minLineGapSec"]');
            const vidDuration = form.querySelector('input[name="duration"]');
            if (languageSelect.value === 'hindi') {
                if (orientationSelect.value === 'landscape') {
                    if (captionStyleSelect.value == 'style2-hindi-normal') {
                        captionLengthInput.value = 1;
                        minLineGapSecInput.value = 0.40;
                        bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                    } else if (captionStyleSelect.value == 'song-block') {
                        captionLengthInput.value = 4;
                        minLineGapSecInput.value = 60;
                        bgMusicSelect.value = 'none';
                    } else if (captionStyleSelect.value == 'story-block') {
                        captionLengthInput.value = 5;
                        minLineGapSecInput.value = 60;
                        bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                    }
                    fetchAudioDuration();
                } else if (orientationSelect.value === 'portrait') {
                    if (captionStyleSelect.value == 'style2-hindi-normal') {
                        captionLengthInput.value = 1;
                        minLineGapSecInput.value = 0.40;
                        bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                    } else if (captionStyleSelect.value == 'song-block') {
                        captionLengthInput.value = 5;
                        minLineGapSecInput.value = 60;
                        bgMusicSelect.value = 'none';
                    } else if (captionStyleSelect.value == 'story-block') {
                        captionLengthInput.value = 5;
                        minLineGapSecInput.value = 60;
                        bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                    }
                    fetchAudioDuration();
                }
            } else if (orientationSelect.value === 'portrait') {
                if (captionStyleSelect.value == 'song-block') {
                    captionLengthInput.value = 50;
                    minLineGapSecInput.value = 60;
                    bgMusicSelect.value = 'none';
                } else if (captionStyleSelect.value == 'story-block') {
                    captionLengthInput.value = 50;
                    minLineGapSecInput.value = 60;
                    bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                } else {
                    captionStyleSelect.value = 'style4';
                    captionLengthInput.value = 3;
                }
                fetchAudioDuration();
            } else if (orientationSelect.value === 'landscape') {
                if (captionStyleSelect.value == 'song-block') {
                    captionLengthInput.value = 30;
                    minLineGapSecInput.value = 60;
                    bgMusicSelect.value = 'none';
                } else if (captionStyleSelect.value == 'story-block') {
                    captionLengthInput.value = 30;
                    minLineGapSecInput.value = 60;
                    bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                } else {
                    captionStyleSelect.value = 'style4';
                    captionLengthInput.value = 6;
                }
                fetchAudioDuration()
            }
        }    
    </script>
</body>

</html>