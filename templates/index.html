<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Content Processor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            padding: 30px;
        }

        form {
            background: #fff;
            padding: 25px 40px;
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
            margin: auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        form h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
        }

        textarea,
        select,
        input[type="number"],
        input[type="text"] {
            width: 100%;
            max-width: 400px;
            padding: 10px;
            font-size: 14px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            display: block;
        }

        button {
            padding: 12px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            max-width: 200px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        button:hover {
            background: #0056b3;
        }

        .tooltip-container {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #555;
            font-weight: bold;
            margin-left: 5px;
        }

        .tooltip-text {
            visibility: hidden;
            width: 260px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            /* Position above the icon */
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 13px;
            line-height: 1.3;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* --- Top nav bar --- */
        .topnav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
            background: #ffffffcc;
            /* a bit translucent */
            backdrop-filter: blur(6px);
            border-bottom: 1px solid #e9e9e9;
            box-shadow: 0 2px 10px rgba(0, 0, 0, .06);
            padding: 8px 12px;
        }

        .topnav .scroller {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: thin;
        }

        .topnav a {
            display: inline-block;
            font: 600 13px/1.4 Arial, sans-serif;
            color: #333;
            text-decoration: none;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 999px;
            padding: 8px 12px;
        }

        .topnav a:hover {
            background: #e8eefc;
            border-color: #cfe0ff;
        }

        .topnav a.active {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }

        /* Give the page top padding so content isn’t hidden under the fixed nav */
        body {
            padding-top: 64px;
        }

        /* Smooth scroll + make headings stop below the fixed nav */
        html {
            scroll-behavior: smooth;
        }

        form {
            scroll-margin-top: 72px;
        }

        /* keeps form title visible under nav */
        /* Toggle button */
        .nav-toggle {
            margin-left: 8px;
            padding: 8px 10px;
            font: 600 13px/1 Arial, sans-serif;
            background: #eef2ff;
            border: 1px solid #c7d2fe;
            border-radius: 999px;
            cursor: pointer;
        }

        .nav-toggle:hover {
            background: #e0e7ff
        }

        /* Backdrop + panel */
        .nav-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .25);
            z-index: 9998;
        }

        .nav-expand {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            top: 56px;
            width: min(1100px, 96vw);
            max-height: 70vh;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, .15);
            z-index: 9999;
            overflow: auto;
        }

        .nav-expand-inner {
            padding: 14px;
        }

        .nav-expand-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        #navSearch {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }

        .nav-close {
            border: 1px solid #e5e7eb;
            background: #f9fafb;
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
        }

        .nav-close:hover {
            background: #f3f4f6
        }

        /* Grid of section links */
        .nav-grid {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        }

        .nav-grid a {
            display: block;
            padding: 10px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            background: #f8fafc;
            text-decoration: none;
            color: #111827;
            font: 600 14px/1.2 Arial, sans-serif;
        }

        .nav-grid a:hover {
            background: #eef2ff;
            border-color: #c7d2fe;
        }
    </style>

</head>

<body>
    <nav class="topnav">
        <div class="scroller" id="topNavLinks"></div>

        <!-- Toggle button (right side) -->
        <button class="nav-toggle" id="navToggle" aria-expanded="false" aria-controls="navExpand"
            title="Show all sections">
            ▤ All
        </button>
    </nav>

    <!-- Expandable panel + backdrop -->
    <div class="nav-backdrop" id="navBackdrop" hidden></div>
    <div class="nav-expand" id="navExpand" hidden>
        <div class="nav-expand-inner">
            <div class="nav-expand-header">
                <strong>All Sections</strong>
                <input id="navSearch" type="text" placeholder="Filter…" aria-label="Filter sections">
                <button id="navClose" class="nav-close" title="Close">✕</button>
            </div>
            <div class="nav-grid" id="navGrid"></div>
        </div>
    </div>


    <form id="contentForm">
        <h2 style="background-color: yellow;">Content Processor</h2>

        <label>Website URLs (semicolon-separated):</label>
        <textarea name="urls" rows="4"></textarea>
        If want to use prerecorded audios, place them in ready_audio folder with file name matching the title of the
        story/Short
        <label>Audio->WordTimeStamps-Video
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Designed for NotebookLM type audios. There should be image at the end of the shorts text. Shorts
                    text should match with the
                    WordTimeStamps text.
                </span>
            </span>

        </label>
        <select name="notebooklm">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Pick video background and story from Excel:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    For using this option, provide captions, video background,and YouTube metadata in
                    video_story_input.xlsx.
                </span>
            </span>
        </label>
        <select name="excel">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <label>Select TTS Engine:</label>
        <select name="tts">
            {% for key in tts_options.keys() %}
            <option value="{{ key }}">{{ key }}</option>
            {% endfor %}
        </select>

        <label>Select Voice Gender:</label>
        <select name="gender" id="gender" onchange="updateVoices()">
            {% for g in voice_genders %}
            <option value="{{ g }}">{{ g }}</option>
            {% endfor %}
        </select>

        <label>Select Voice:</label>
        <select name="voice" id="voice">
            <!-- Populated by JS -->
        </select>

        <label>Select Video Type:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Ensure camera frames marked on the web page match with the selection. Also OBS studio should have
                    corresponding scene and profile.
                </span>
            </span>
        </label>
        <select name="size">
            {% for label in sizes.keys() %}
            <option value="{{ label }}">{{ label }}</option>
            {% endfor %}
        </select>

        <label>Select Background Music:</label>
        <select name="music">
            {% for filename in music_options.keys() %}
            <option value="{{ filename }}">{{ filename }}</option>
            {% endfor %}
        </select>

        <label>Max Words per Caption:</label>
        <input type="number" name="max_words" min="1" max="20" value="4">

        <label>Select Caption Style:</label>
        <select name="style">
            {% for style_key in style_options.keys() %}
            <option value="{{ style_key }}">{{ style_key }}</option>
            {% endfor %}
        </select>

        <label>Skip Puppeteer Call:</label>

        <select name="skip_puppeteer">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Skip Captions:</label>
        <select name="skip_captions">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Add Sound Pitch:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Id it is adult, it does not change anything.
                </span>
            </span>
        </label>
        <select name="pitch">
            <option>adult</option>
            <option>child</option>
            <option>teen</option>
            <option>elderly</option>
        </select>

        <label>Disable Subscribe Gif:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Disable it for advertisement videos.
                </span>
            </span>
        </label>
        <select name="disable_subscribe">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <button type="submit">Process</button>
    </form>
    <br>
    <form id="generateTTSAudio">
        <h2 style="background-color:aqua;">Generate TTS</h2>

        <label>Enter Text:</label>
        <textarea name="ttstext" rows="20"></textarea>

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <label>Select TTS Engine:</label>
        <select name="tts">
            {% for key in tts_options.keys() %}
            <option value="{{ key }}">{{ key }}</option>
            {% endfor %}
        </select>

        <label>Select Voice Gender:</label>
        <select name="gender" id="gender" onchange="updateVoices()">
            {% for g in voice_genders %}
            <option value="{{ g }}">{{ g }}</option>
            {% endfor %}
        </select>

        <button type="submit">Gerenate Audio File</button>
        <br>
        <div>Created file will be saved as audio.wav in the root folder and edit_vid_audio.
        </div>
    </form>
    <br>
    <form id="runCaptionGenerator">
        <h2 style="background-color:khaki;">Generate Captions</h2>
        <h3>Prestep for Audio->WordTimeStamps-Video</h3>
        <div>Run caption_generator.py: Prestep for Audio->WordTimeStamps-Video above
            <ol>
                <li>Place audio.wav (from notebooklm) and then press below button.</li>
                <li>This would create WordTimeStamps file and captions (access from index.html).</li>
                <li>Use captions text on readernook.com and add images.
                    There must be an image at the end of the text</li>
                <li>Then execute above program with Audio->WordTimeStamps-Video</li>
            </ol>

        </div>
        <label>Audio has music (Vocals would be seperated before creating captions):</label>
        <select name="music">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>
        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <button type="submit">Create WordTimeStamps and Caption Text</button>
    </form>

    <br>
    <form id="sunoToVideoGenerator">
        <h2 style="background-color:coral">Suno.com song + Video Clip</h2>
        <div>
            <ol>
                <li>Place song audio.wav inside edit_vid_audio.</li>
                <li>Place video clip (5/8 secs) at edit_vid_input. (Change slow down factor below if needed)</li>
                <li>Click on below button</li>
                <li>This would make longer clip by slowing speed and then create video by repeating to audio length
                    It will then place the video as composed_video.mp4 inside the root folder.
                    And will place the input audio file as audio.wav inside the root folder.
                </li>
                <li>Then for <b>English</b> language audio</li>
                <ul>
                    <li>it will call script to make WordTimeStamps file.</li>
                    <li>After processing is done, review the captions at <a href="prepare_captions" target="_blank">Open
                            Caption Editor</a>
                        (Opens in new tab) and make necessary change. </li>
                    <li>Then Run OBS Recorder to create final video for upload. Parameters: Caption-style1, words per
                        caption-10,outputfile - edit_vid_output/output.mp4 </li>
                </ul>
                <!-- <li>For <b>Hindi</b> language audio, if provided size is Landscape it will also create portait video so
                    that captions can be applied together</li> -->

            </ol>

        </div>

        <label>Audio has music (Vocals would be seperated before creating captions):</label>
        <select name="music">
            <option value="yes">yes</option>
            <option value="no">no</option>
        </select>

        <!-- <label>Slow down video clips by factor:</label>
        <input type="number" name="slowfactor" min="1" max="10" value="4"> -->

        <label>Change speed by factor (e.g. 2.0/3.0 will make video 2/3 times longer, 0.5 for 2 x faster):</label>
        <input type="number" name="slowfactor" step="any" placeholder="4.0">

        <label>Input clip size:</label>
        <select name="size">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <button type="submit">Create Video and Caption Text</button>

        For <b>Hindi</b> language audio
        <ul>
            <li>Create Hindi captions using <a href="hindi_caption_builder" target="_blank">hindi_caption_builder</a>
                Export the captions to word_timestamps.json.</li>
            <li>Then Run OBS Recorder to create final video for upload. Parameters: Language-Hindi, Caption-style4,
                words per
                caption-1,outputfile - edit_vid_output/output.mp4 </li>

            <!-- <li><a href="apply_caption" target="_blank">Create Videos with Caption</a>. If input clip
                size is "landscape", Create video button will additionally create Portrait
                video with captions in the edit_vid_output folder.</li> -->
        </ul>
    </form>
    <br>


    <form id="sunoNImageToVideoGenerator">
        <h2>Suno.com song + Images</h2>
        <div>
            <ol>
                <li>Place song audio.wav inside edit_vid_audio.</li>
                <li>Place images in edit_vid_input. (If needed, change input image size and clip duration for each image
                    )</li>
                <li>Click on below button</li>
                <li>This would make video clips and then create video by repeating to audio length
                    It will then place the video as composed_video.mp4 inside the root folder.
                    And will place the input audio file as audio.wav inside the root folder.
                </li>
                <li>Then for <b>English</b> language audio</li>
                <ul>
                    <li>it will call script to make WordTimeStamps file.</li>
                    <li>After processing is done, review the captions at <a href="prepare_captions" target="_blank">Open
                            Caption Editor</a>
                        (Opens in new tab) and make necessary change. </li>
                    <li>Then Run OBS Recorder to create final video for upload. Parameters: Caption-style1, words per
                        caption-10,outputfile - edit_vid_output/output.mp4 </li>
                </ul>
                <!-- <li>For <b>Hindi</b> language audio, if provided size is Landscape it will also create portait video so
                    that captions can be applied together</li> -->

            </ol>

        </div>

        <label>Audio has music (Vocals would be seperated before creating captions):</label>
        <select name="music">
            <option value="yes">yes</option>
            <option value="no">no</option>
        </select>

        <label>Input image size:</label>
        <select name="size">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Duration of video per image (Seconds):</label>
        <input type="number" name="duration" min="1" max="60" value="20">

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <button type="submit">Create Video and Caption Text</button>

        For <b>Hindi</b> language audio
        <ul>
            <li>Create Hindi captions using <a href="hindi_caption_builder" target="_blank">hindi_caption_builder</a>
                Export the captions to word_timestamps.json.</li>
            <li>Then Run OBS Recorder to create final video for upload. Parameters: Language-Hindi, Caption-style4,
                words per
                caption-1,outputfile - edit_vid_output/output.mp4 </li>

            <!-- <li><a href="apply_caption" target="_blank">Create Videos with Caption</a>. If input clip
                size is "landscape", Create video button will additionally create Portrait
                video with captions in the edit_vid_output folder.</li> -->
        </ul>
    </form>
    <br>

    <form id="uploadToYoutube">
        <h2>Youtube Upload</h2>
        <div> To be run after video created in Processed_video folder and record is added in video_records.xlsx


        </div>


        <button type="submit">Upload Videos to Youtube</button>
    </form>

    <br>
    <form id="runOBSRecorder">
        <h2>OBS Recorder</h2>
        <div> To be run if recording as part of whole Process above failed.
            The output will be created as test.mp4.
            Move that to under processed_video folder with right name before running the YouTube Upload.
        </div>
        <br>
        <label>Language:</label>
        <select id="language" name="language">
            <option>english</option>
            <option>hindi</option>
        </select>

        <label>Orientation:</label>
        <select name="orientation">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label for="captStyle">Caption Style</label>
        <select id="captStyle" name="captStyle">
            <option value="style1">Style 1</option>
            <option value="style2">Style 2</option>
            <option value="style2-hindi-normal">style2-hindi-normal</option>
            <option value="style-hindi-rozha">style-hindi-rozha</option>
            <option value="style3">Style 3</option>
            <option value="style4">Style 4</option>
            <option value="style5">Style 5</option>
            <option value="style6">Style 6</option>
            <option value="style7">Style 7</option>
            <option value="style8">Style 8</option>
            <option value="style9">Style 9</option>
            <option value="style10">Style 10</option>
            <option value="style11">Style 11</option>
            <option value="none">No Caption</option>
            <option value="block-style">Block Caption</option>
            <option value="block-style-hindi">block-style-hindi</option>
        </select>


        <label for="captLength">Words per Caption</label>
        <input type="number" id="captLength" name="captLength" value="5" min="1" max="20">

        <label>Duration (Seconds):</label>
        <input type="text" name="duration">

        <label for="minLineGapSec">Min gap between lines (sec)</label>
        <input type="number" id="minLineGapSec" name="minLineGapSec" value="0.40" step="0.05" min="0" />

        <label for="bgMusicSelect">Background Music:</label>
        <select id="bgMusicSelect" name="bgMusicSelect">
            <option value="none">None</option>
            <option value="children-a-baby-story-530.mp3">Children-story</option>
            <option value="children-close-your-eyes-now-1022.mp3">Children-eyes</option>
            <option value="children-lullaby-night-531.mp3">Children-lullaby</option>
            <option value="children-summers-here-91.mp3">Children-summers</option>
            <option value="horror-fright-night-871.mp3">Horror-fright</option>
            <option value="horror-piano-671.mp3">Horror-piano</option>
            <option value="positive-a-very-happy-christmas-897.mp3">Positive-christmas</option>
            <option value="positive-mixkit-fun-jazz-647.mp3">Positive-fun</option>
            <option value="positive-wedding-01-657.mp3">Positive-wedding</option>
            <option value="story-classical-3-710.mp3">Story-1</option>
            <option value="story-classical-6-713.mp3">Story-6</option>
            <option value="story-classical-10-717.mp3">story-10</option>
        </select>

        <label for="disableSubscribe">Disable Subscribe Gif</label>
        <select id="disableSubscribe" name="disableSubscribe">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Output file(e.g.):"edit_vid_output/output.mp4", "test.mp4"</label>
        <input type="text" name="outputfile" value="edit_vid_output/output.mp4">

        <button type="submit">Play video and run OBS Recorder</button>
    </form>

    <br>
    <form id="thumbnailMaker">
        <h2>Thumbnail Maker</h2>
        <a href="thumbnail" target="_blank">Open Thumbnail Maker</a>
        (Opens in new tab)
    </form>

    <br>
    <form id="aiVideoPromptMaker">
        <h2>AI Video Prompt Maker</h2>
        <a href="aivideoprompt" target="_blank">Open AI Video Prompt Maker</a>
        (Opens in new tab)
    </form>

    <br>
    <form id="runVideoEditor">
        <h2>Video Editor</h2>
        <div> To be used to slow (pixverse) video speed to increase length. Cut portion of video to remove watermark.
            Add own watermark. Add background audio.
            <br><br>Place the input mp4 files in edit_vid_input folder. Output files will be created in edit_vid_output.
        </div>
        <br>
        <label>Orientation:</label>
        <select name="orientation">
            <option value="auto">auto</option>
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Background Music:</label>
        <select name="bgmusic">
            <option value="none">none</option>
            <option value="god_bg">Random from folder god_bg</option>
        </select>

        <label>Remove from Top(leave blank/50/60):</label>
        <input type="number" name="topcut">

        <label>Remove from bottom(leave blank/50/60):</label>
        <input type="number" name="bottomcut">

        <label>Change speed by factor (e.g. 2.0/3.0 will make video 2/3 times longer, 0.5 for 2 x faster):</label>
        <input type="number" name="slowfactor" step="any" placeholder="2.0">


        <!-- <label>Watermark:</label>
        <select name="watermark">
            <option value="none">none</option>
            <option value="logo.png">logo.png</option>
        </select> -->

        <label>Watermark position:</label>
        <select name="watermarkposition">
            <option value="none">none</option>
            <option value="bottom-left">bottom-left</option>
            <option value="bottom-right">bottom-right</option>
            <option value="top-left">top-left</option>
            <option value="top-right">top-right</option>
        </select>

        <button type="submit">Process Videos</button>
    </form>
    <br>
    <form id="addOverlay">
        <h2>Add Overlay</h2>
        <div> To be used to add flower petals/sparkle on the video.
            <br><br>Place the input mp4 files in edit_vid_input folder. Output files will be created in edit_vid_output.
        </div>
        <br>
        <label>Add Petals:</label>
        <select name="add_petals">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Add Sparkles:</label>
        <select name="add_sparkles">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <button type="submit">Process Videos</button>
    </form>

    <br>
    <form id="multiplyVideo">
        <h2>Multiply Video/Audio</h2>
        <div> To be used to repeat the video/audio by a factor.
            <br><br>Place the input mp4/mp3 files in edit_vid_input folder. Output files will be created in
            edit_vid_output. E.g. enter 10 if the video is to be made 10 times long
        </div>
        <br>
        <label>Repeat Factor:</label>
        <input type="number" name="repeat_factor" min="1" value="1">

        <button type="submit">Process Videos</button>
    </form>

    <br>
    <form id="makeKBVideoFromImages">
        <h2>Make Ken Burn Videos from Images</h2>
        <div> To be used to make image video clips that will be used to make song videos later.
            <br><br>Place the images in edit_vid_input folder. Output files will be created in edit_vid_output.
        </div>

        <label>Input image size:</label>
        <select name="size">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Duration of video per image (Seconds):</label>
        <input type="number" name="duration" min="1" max="60" value="20">
        <button type="submit">Process Images</button>
    </form>

    <br>
    <form id="asseleClipsToMakeVideoSong">
        <h2>Assemble small video clips to make large video with audio</h2>
        <div> To be used to make make song videos/large video using video clips.
            <br><br>Place the video clips in edit_vid_input folder. Place the audio file in edit_vid_audio. Output
            will be created in edit_vid_output and will also be copied on root as composed_video.mp4.
        </div>

        <button type="submit">Make Large Video</button>
    </form>

    <br>
    <form id="splitVideoToParts">
        <h2>Split long video to parts </h2>
        <div> Can be used for creating shorts for upload.
            <br><br>Picks the input from edit_vid_output/output.mp4. Parts are created in edit_vid_output folder.

        </div>
        <label>Max lenth of parts (Seconds):</label>
        <input type="number" name="duration" min="1" max="1000" value="170">
        <button type="submit">Create Video</button>
    </form>

    <script>
        // 1) Build a label for each form based on its H2 (fallback to form id)
        function slugToLabel(slug) {
            return slug
                .replace(/[-_]+/g, ' ')
                .replace(/\b\w/g, c => c.toUpperCase());
        }

        function buildTopNav() {
            const container = document.getElementById('topNavLinks');
            if (!container) return;

            // Select all forms that have an ID
            const forms = Array.from(document.querySelectorAll('form[id]'));

            const frag = document.createDocumentFragment();

            forms.forEach(form => {
                const id = form.id;
                const h2 = form.querySelector('h2');
                const label = (h2 && h2.textContent.trim()) || slugToLabel(id);

                const a = document.createElement('a');
                a.href = `#${id}`;
                a.textContent = label.length > 30 ? label.slice(0, 30) + '…' : label;
                a.dataset.target = id;
                frag.appendChild(a);
            });

            container.innerHTML = '';
            container.appendChild(frag);
        }

        // 2) Highlight the active link while scrolling
        function activateOnScroll() {
            const links = Array.from(document.querySelectorAll('.topnav a'));
            const map = new Map(links.map(a => [a.dataset.target, a]));

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const id = entry.target.id;
                    const link = map.get(id);
                    if (!link) return;

                    if (entry.isIntersecting) {
                        links.forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                        // Ensure the active pill stays in view when scrolled
                        link.scrollIntoView({ block: 'nearest', inline: 'nearest' });
                    }
                });
            }, {
                rootMargin: '-60px 0px -70% 0px', // triggers as the form’s top passes under the nav
                threshold: 0
            });

            document.querySelectorAll('form[id]').forEach(section => observer.observe(section));
        }

        // 3) Prevent the fixed-nav from covering the target when navigating via hash (extra-safe)
        function offsetHashJump() {
            const headerH = document.querySelector('.topnav')?.offsetHeight || 64;
            if (location.hash) {
                const el = document.querySelector(location.hash);
                if (el) window.scrollTo({ top: el.getBoundingClientRect().top + window.pageYOffset - (headerH + 8) });
            }
            window.addEventListener('hashchange', () => {
                const el = document.querySelector(location.hash);
                if (el) {
                    const headerH2 = document.querySelector('.topnav')?.offsetHeight || 64;
                    window.scrollTo({ top: el.getBoundingClientRect().top + window.pageYOffset - (headerH2 + 8), behavior: 'smooth' });
                }
            });
        }

        // 4) Init
        document.addEventListener('DOMContentLoaded', () => {
            buildTopNav();
            activateOnScroll();
            offsetHashJump();
        });
        // Build both the top pills and the expanded grid
        function collectForms() {
            return Array.from(document.querySelectorAll('form[id]')).map(f => {
                const id = f.id;
                const h2 = f.querySelector('h2');
                const label = (h2 && h2.textContent.trim()) ||
                    id.replace(/[-_]+/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
                return { id, label };
            });
        }

        function buildTopNav() {
            const container = document.getElementById('topNavLinks');
            if (!container) return;
            const frag = document.createDocumentFragment();
            collectForms().forEach(({ id, label }) => {
                const a = document.createElement('a');
                a.href = `#${id}`;
                a.textContent = label.length > 30 ? label.slice(0, 30) + '…' : label;
                a.dataset.target = id;
                frag.appendChild(a);
            });
            container.innerHTML = '';
            container.appendChild(frag);
        }

        function buildExpandedNav() {
            const grid = document.getElementById('navGrid');
            if (!grid) return;
            const frag = document.createDocumentFragment();

            collectForms()
                .sort((a, b) => a.label.localeCompare(b.label)) // alphabetical
                .forEach(({ id, label }) => {
                    const a = document.createElement('a');
                    a.href = `#${id}`;
                    a.textContent = label;
                    a.dataset.target = id;
                    frag.appendChild(a);
                });

            grid.innerHTML = '';
            grid.appendChild(frag);
        }

        // Open/close helpers
        function openNavPanel() {
            document.getElementById('navBackdrop').hidden = false;
            document.getElementById('navExpand').hidden = false;
            document.getElementById('navToggle').setAttribute('aria-expanded', 'true');
            document.getElementById('navSearch').focus();
        }
        function closeNavPanel() {
            document.getElementById('navBackdrop').hidden = true;
            document.getElementById('navExpand').hidden = true;
            document.getElementById('navToggle').setAttribute('aria-expanded', 'false');
            // clear filter
            const s = document.getElementById('navSearch');
            if (s && s.value) { s.value = ''; filterNav(''); }
        }

        // Filter items while typing
        function filterNav(q) {
            const items = document.querySelectorAll('#navGrid a');
            const term = q.trim().toLowerCase();
            items.forEach(a => {
                const show = a.textContent.toLowerCase().includes(term);
                a.style.display = show ? '' : 'none';
            });
        }

        // Wire up events
        document.addEventListener('DOMContentLoaded', () => {
            buildTopNav();
            buildExpandedNav();

            // Keep existing active-on-scroll behavior you already added
            // (no changes needed)

            const toggle = document.getElementById('navToggle');
            const closeBtn = document.getElementById('navClose');
            const backdrop = document.getElementById('navBackdrop');
            const grid = document.getElementById('navGrid');
            const search = document.getElementById('navSearch');

            toggle?.addEventListener('click', () => {
                const expanded = toggle.getAttribute('aria-expanded') === 'true';
                expanded ? closeNavPanel() : openNavPanel();
            });
            closeBtn?.addEventListener('click', closeNavPanel);
            backdrop?.addEventListener('click', closeNavPanel);

            // Close on ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !document.getElementById('navExpand').hidden) closeNavPanel();
            });

            // Navigate & close when clicking an item
            grid?.addEventListener('click', (e) => {
                if (e.target.tagName === 'A') closeNavPanel();
            });

            // Live filter
            search?.addEventListener('input', (e) => filterNav(e.target.value));
        });
    </script>

    <script>
        const voices = {{ voice_map | tojson }};
        function updateVoices() {
            const gender = document.getElementById("gender").value;
            const voiceDropdown = document.getElementById("voice");
            const voiceList = voices[gender];

            voiceDropdown.innerHTML = '';
            voiceList.forEach(function (v) {
                const opt = document.createElement("option");
                opt.value = v;
                opt.text = v;
                voiceDropdown.appendChild(opt);
            });
        }

        // On page load, initialize voices for default gender
        window.onload = updateVoices;

        document.getElementById('contentForm').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...");
            const formData = new FormData(this);
            const response = await fetch('/process', {
                method: 'POST',
                body: formData
            });
            const result = await response.text();
            console.log("Completed Processing");
            // alert(result);
        };

        document.getElementById('runCaptionGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...caption");
            const formData = new FormData(this);
            const response = await fetch('/caption', {
                method: 'POST',
                body: formData
            });
            const result = await response.text();
            console.log("Completed creating caption");
            // alert(result);
        };
        document.getElementById('uploadToYoutube').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...upload_videos");
            const response = await fetch('/upload', {
                method: 'POST'
            });
            const result = await response.text();
            console.log("Completed upload");
            // alert(result);
        };
        document.getElementById('runOBSRecorder').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...run OBS recorder");
            const formData = new FormData(this);
            const response = await fetch('/runobsrecorder', {
                method: 'POST',
                body: formData
            });
            console.log("Completed OBS recorder run");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('runVideoEditor').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...edit Videos");
            const formData = new FormData(this);
            const response = await fetch('/editvideos', {
                method: 'POST',
                body: formData
            });
            console.log("Completed ..edit Videos");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('addOverlay').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...add overlay");
            const formData = new FormData(this);
            const response = await fetch('/addoverlays', {
                method: 'POST',
                body: formData
            });
            console.log("Completed add overlay");
            const result = await response.text();
            // alert(result);
        };
        document.getElementById('multiplyVideo').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...multiply video");
            const formData = new FormData(this);
            const response = await fetch('/multiplyvideo', {
                method: 'POST',
                body: formData
            });
            console.log("Completed multiply video");
            const result = await response.text();
            // alert(result);
        };
        document.getElementById('makeKBVideoFromImages').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...make Ken Burn Videos from Images");
            const formData = new FormData(this);
            const response = await fetch('/makekbvideofromimages', {
                method: 'POST',
                body: formData
            });
            console.log("Completed make Ken Burn Videos from Images");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('asseleClipsToMakeVideoSong').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...Assemble small video clips to make video song");
            const formData = new FormData(this);
            const response = await fetch('/assembleclipstomakevideosong', {
                method: 'POST',
                body: formData
            });
            console.log("Completed Assemble small video clips to make video song");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('splitVideoToParts').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...splitVideoToParts");
            const formData = new FormData(this);
            const response = await fetch('/splitvideotoparts', {
                method: 'POST',
                body: formData
            });
            console.log("Completed splitVideoToParts");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('sunoToVideoGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...sunoToVideoGenerator");
            const formData = new FormData(this);
            const response = await fetch('/sunotovideogenerator', {
                method: 'POST',
                body: formData
            });
            console.log("Completed sunoToVideoGenerator");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('generateTTSAudio').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...generateTTSAudio");
            const formData = new FormData(this);
            const response = await fetch('/generatettsaudio', {
                method: 'POST',
                body: formData
            });
            console.log("Completed generateTTSAudio");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('sunoNImageToVideoGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...sunoNImageToVideoGenerator");
            const formData = new FormData(this);
            const response = await fetch('/sunonimagetovideogenerator', {
                method: 'POST',
                body: formData
            });
            console.log("Completed sunoNImageToVideoGenerator");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('sunoNImageToVideoGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...sunoNImageToVideoGenerator");
            const formData = new FormData(this);
            const response = await fetch('/sunonimagetovideogenerator', {
                method: 'POST',
                body: formData
            });
            console.log("Completed sunoNImageToVideoGenerator");
            const result = await response.text();
            // alert(result);
        };


        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('runOBSRecorder');
            if (!form) return; // safety check

            const orientationSelect = form.querySelector('select[name="orientation"]');
            const captionStyleSelect = form.querySelector('select[name="captStyle"]');
            const captionLengthInput = form.querySelector('input[name="captLength"]');
            const languageSelect = form.querySelector('select[name="language"]');
            const bgMusicSelect = form.querySelector('select[name="bgMusicSelect"]');
            const minLineGapSecInput = form.querySelector('input[name="minLineGapSec"]');

            if (orientationSelect && captionStyleSelect && captionLengthInput) {
                orientationSelect.addEventListener('change', function () {
                    if (languageSelect.value === 'hindi') {
                        captionStyleSelect.value = 'style2-hindi-normal';
                        captionLengthInput.value = 1;
                        bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                    } else if (orientationSelect.value === 'portrait') {
                        captionStyleSelect.value = 'style4';
                        captionLengthInput.value = 3;
                    } else if (orientationSelect.value === 'landscape') {
                        captionStyleSelect.value = 'style4';
                        captionLengthInput.value = 6;
                    }
                });
            }
            captionStyleSelect.addEventListener('change', function () {
                if (captionStyleSelect.value == 'style2-hindi-normal') {
                    captionLengthInput.value = 1;
                    minLineGapSecInput.value = 0.40;
                }
                if (captionStyleSelect.value == 'block-style-hindi') {
                    captionLengthInput.value = 5;
                    minLineGapSecInput.value = 60;
                }
            });
            languageSelect.addEventListener('change', function () {
                if (languageSelect.value === 'hindi') {
                    captionStyleSelect.value = 'style2-hindi-normal';
                    captionLengthInput.value = 1;
                    bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                } else if (languageSelect.value === 'english') {
                    // Reset to defaults for English
                    if (orientationSelect.value === 'portrait') {
                        captionStyleSelect.value = 'style4';
                        captionLengthInput.value = 3;
                    } else if (orientationSelect.value === 'landscape') {
                        captionStyleSelect.value = 'style4';
                        captionLengthInput.value = 6;
                    }
                }
            });
        });        
    </script>
</body>

</html>