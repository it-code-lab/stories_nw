<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Content Processor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            padding: 30px;
        }

        form {
            background: #fff;
            padding: 25px 40px;
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
            margin: auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        form h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
        }

        textarea,
        select,
        input[type="number"],
        input[type="text"] {
            width: 100%;
            max-width: 400px;
            padding: 10px;
            font-size: 14px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            display: block;
        }

        button {
            padding: 12px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            max-width: 200px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        button:hover {
            background: #0056b3;
        }

        .tooltip-container {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #555;
            font-weight: bold;
            margin-left: 5px;
        }

        .tooltip-text {
            visibility: hidden;
            width: 260px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            /* Position above the icon */
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 13px;
            line-height: 1.3;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* --- Top nav bar --- */
        .topnav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
            background: #ffffffcc;
            /* a bit translucent */
            backdrop-filter: blur(6px);
            border-bottom: 1px solid #e9e9e9;
            box-shadow: 0 2px 10px rgba(0, 0, 0, .06);
            padding: 8px 12px;
        }

        .topnav .scroller {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: thin;
        }

        .topnav a {
            display: inline-block;
            font: 600 13px/1.4 Arial, sans-serif;
            color: #333;
            text-decoration: none;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 999px;
            padding: 8px 12px;
        }

        .topnav a:hover {
            background: #e8eefc;
            border-color: #cfe0ff;
        }

        .topnav a.active {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }

        /* Give the page top padding so content isn‚Äôt hidden under the fixed nav */
        body {
            padding-top: 64px;
        }

        /* Smooth scroll + make headings stop below the fixed nav */
        html {
            scroll-behavior: smooth;
        }

        form {
            scroll-margin-top: 72px;
        }

        /* keeps form title visible under nav */
        /* Toggle button */
        .nav-toggle {
            margin-left: 8px;
            padding: 8px 10px;
            font: 600 13px/1 Arial, sans-serif;
            background: #eef2ff;
            border: 1px solid #c7d2fe;
            border-radius: 999px;
            cursor: pointer;
            color: black;
        }

        .nav-toggle:hover {
            background: #e0e7ff
        }

        /* Backdrop + panel */
        .nav-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .25);
            z-index: 9998;
        }

        .nav-expand {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            top: 56px;
            width: min(1100px, 96vw);
            max-height: 70vh;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, .15);
            z-index: 9999;
            overflow: auto;
        }

        .nav-expand-inner {
            padding: 14px;
        }

        .nav-expand-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        #navSearch {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }

        .nav-close {
            border: 1px solid #e5e7eb;
            background: #f9fafb;
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
        }

        .nav-close:hover {
            background: #f3f4f6
        }

        /* Grid of section links */
        .nav-grid {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        }

        .nav-grid a {
            display: block;
            padding: 10px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            background: #f8fafc;
            text-decoration: none;
            color: #111827;
            font: 600 14px/1.2 Arial, sans-serif;
        }

        .nav-grid a:hover {
            background: #eef2ff;
            border-color: #c7d2fe;
        }

        #previewContainer {
            margin-top: 30px;
            text-align: center;
        }

        #previewCanvas {
            width: 640px;
            height: 360px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #eee;
        }

        .color-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #aaa;
            display: inline-block;
        }

        .grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }

        .item {
            border: 2px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: .2s;
        }

        .item.selected {
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0, 123, 255, .5);
        }

        .item img,
        .item video {
            width: 160px;
            height: 100px;
            object-fit: cover;
            display: block;
        }

        .infoBox {
            background-color: #cfe0ff;
            padding: 5px;
            margin: 10px;
            border-radius: 5px;
        }
    </style>

</head>

<body>
    <nav class="topnav">
        <div class="scroller" id="topNavLinks"></div>

        <!-- Toggle button (right side) -->
        <button class="nav-toggle" id="navToggle" aria-expanded="false" aria-controls="navExpand"
            title="Show all sections">
            ‚ñ§ All
        </button>
    </nav>

    <!-- Expandable panel + backdrop -->
    <div class="nav-backdrop" id="navBackdrop" hidden></div>
    <div class="nav-expand" id="navExpand" hidden>
        <div class="nav-expand-inner">
            <div class="nav-expand-header">
                <strong>All Sections</strong>
                <input id="navSearch" type="text" placeholder="Filter‚Ä¶" aria-label="Filter sections">
                <button id="navClose" class="nav-close" title="Close">‚úï</button>
            </div>
            <div class="nav-grid" id="navGrid"></div>
        </div>
    </div>

    <form id="bgVideoForm">
        <h2>1.Select Background Video</h2>

        <label>Video Folder:</label>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <select id="videoFolder"></select>
            <div id="videoBreadcrumbs" style="font-size:13px; color:#666;"></div>
        </div>
        <div id="videoContainer" class="grid" style="min-height:110px;"></div>
        <button type="submit">Set Background Video</button>
        <div class="infoBox">Places video as bg_video.mp4 in edit_vid_input.</div>
    </form>

    <br>
    <form id="generateTTSAudio">
        <h2 style="background-color:aqua;">2.Generate TTS</h2>

        <label>Enter Text:</label>
        <textarea name="ttstext" rows="20"></textarea>

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <label>Select TTS Engine:</label>
        <select name="tts">
            {% for key in tts_options.keys() %}
            <option value="{{ key }}">{{ key }}</option>
            {% endfor %}
        </select>

        <label>Select Voice Gender:</label>
        <select name="gender" id="gender" onchange="updateVoices()">
            {% for g in voice_genders %}
            <option value="{{ g }}">{{ g }}</option>
            {% endfor %}
        </select>

        <button type="submit">Generate Audio File</button>
        <br>
        <div class="infoBox">Created file will be saved as audio.wav in the root folder and edit_vid_audio.
        </div>
    </form>
    <br>
    <form id="asseleClipsToMakeVideoSong">
        <h2>3.Assemble/merge small video clips to make large video with audio</h2>
        <div> To be used to make make song videos/large video using video clips.
            <br><br>Place the video clips in edit_vid_input folder. Place the audio file in edit_vid_audio. Output
            will be created in edit_vid_output and will also be copied on root as composed_video.mp4.
        </div>
        <div class="infoBox">If audio length is smaller than video then video will be trimmed</div>

        <label>Copy video and audio files for captions generations</label>
        <select name="copyforcaption" id="copyforcaption">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <div style="background-color: #cfe0ff; padding: 10px; border-radius: 10px;">
            <label>Keep audio from original video </label>
            <select name="keep_video_audio" id="keep_video_audio">
                <option value="no">no</option>
                <option value="yes">yes</option>
            </select>
            <div id="audioVideoOptions" style="display: none;">
                <label>Original video volume:</label>
                <input type="number" name="video_volume" id="video_volume" value="0.30" step="0.1" min="0" max="1">

                <label>Audio volume:</label>
                <input type="number" name="bg_volume" id="bg_volume" value="1" step="0.1" min="0" max="1">
            </div>
        </div>

        <button type="submit">Make Large Video</button>
    </form>
    <br>
    <form id="splitTextForm">
        <h2 style="background-color:lightgreen;">4.Split Content into Sentences</h2>
        <div class="infoBox">Used for splitting Hindi paragraph into sentenses to be used in Hindi Caption Builder</div>
        <label>Enter Text (sentences separated by "|" or "?"):</label>
        <textarea id="splitInput" rows="8" placeholder="Enter your text here..."></textarea>

        <label>Result:</label>
        <textarea id="splitOutput" rows="8" readonly placeholder="Result will appear here..."></textarea>

        <button type="button" id="splitButton">Split Text</button>
        <button type="button" id="copyButton" style="margin-top:10px;">Copy Result</button>
    </form>
    <br>

    <form id="runCaptionGenerator">
        <h2 style="background-color:khaki;">5. Generate Captions</h2>
        <h3>Prestep for Audio->WordTimeStamps-Video</h3>
        <div>Run caption_generator.py: Prestep for Audio->WordTimeStamps-Video above
            <ol>
                <li>Place audio.wav (from notebooklm) and then press below button.</li>
                <li>This would create WordTimeStamps file and captions (access from index.html).</li>
                <li>Use captions text on readernook.com and add images.
                    There must be an image at the end of the text</li>
                <li>Then execute above program with Audio->WordTimeStamps-Video</li>
            </ol>

        </div>
        <label>Audio has music (Vocals would be seperated before creating captions):</label>
        <select name="music">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>
        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <div style="background-color: #cfe0ff; padding: 5px;">Create Hindi captions using <a
                href="hindi_caption_builder" target="_blank">hindi_caption_builder</a>
            Export the captions to word_timestamps.json.</div>

        <button type="submit">Create WordTimeStamps and Caption Text</button>
    </form>

    <br>
    <form id="thumbForm">
        <h2>6.Create Thumbnail</h2>
        <h3>Select Thumbnail Image</h3>

        <label>Image Folder:</label>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <select id="imageFolder"></select>
            <div id="imageBreadcrumbs" style="font-size:13px; color:#666;"></div>
        </div>
        <div id="imageContainer" class="grid" style="min-height:110px;"></div>




        <h3>Thumbnail Text and Styles</h3>

        <label>Background Color (Left Side):</label>
        <select id="bgColorSelect" name="bg_color">
            <option value="#000" data-color="#000">Story</option>
            <option value="#9f0b1f" data-color="#9f0b1f">Song</option>
            <option value="#008080" data-color="#008080">Quiz</option>

            <!-- <option value="#101010" data-color="#101010">Dark Gray</option>
            <option value="#1E1E2F" data-color="#1E1E2F">Midnight Blue</option>
            <option value="#0D7377" data-color="#0D7377">Teal</option>
            <option value="#2E8B57" data-color="#2E8B57">Green</option>
            <option value="#FF6600" data-color="#FF6600">Orange</option>
            <option value="#8B0000" data-color="#8B0000">Maroon</option>
            <option value="#800080" data-color="#800080">Purple</option>
            <option value="#F5F5F5" data-color="#F5F5F5">Light Gray</option> -->
        </select>

        <label>Text (use "|" for new lines):</label>
        <textarea name="text" id="textInput" rows="4"
            placeholder="Example: Narak Chaturdashi|‡§®‡§∞‡§ï‡§æ‡§∏‡•Å‡§∞ ‡§µ‡§ß ‡§ï‡•Ä ‡§ï‡§•‡§æ"></textarea>

        <label>Text Colors (comma-separated or 'auto'):</label>
        <input type="text" name="colors" id="colorInput" value="auto">

        <button type="submit">Generate Thumbnail</button>

        <!-- DND - Working but not good enough yet -->
        <!-- <div id="previewContainer">
            <h3>üñºÔ∏è Live Preview</h3>
            <canvas id="previewCanvas"></canvas>
        </div> -->

        <div id="result" style="text-align:center;margin-top:25px;"></div>
        <!-- after #imageContainer -->
        <input type="hidden" name="image" id="selectedImage">
        <!-- after #videoContainer -->
        <input type="hidden" name="video" id="selectedVideo">
        <div class="infoBox">Created thumbnail will be saved as thumbnail.png in the folder edit_vid_thumbnail.</div>

    </form>
    <br>

    <form id="runOBSRecorder">
        <h2>7.OBS Recorder</h2>
        <div> To be run if recording as part of whole Process above failed.
            The output will be created as test.mp4.
            Move that to under processed_video folder with right name before running the YouTube Upload.
        </div>
        <br>
        <label>Language:</label>
        <select id="language" name="language">
            <option>english</option>
            <option>hindi</option>
        </select>

        <label>Orientation:</label>
        <select name="orientation">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label for="captStyle">Caption Style</label>
        <select id="captStyle" name="captStyle">
            <option value="style1">Style 1</option>
            <option value="style2">Style 2</option>
            <option value="style2-hindi-normal">style2-hindi-normal</option>
            <option value="style-hindi-rozha">style-hindi-rozha</option>
            <option value="style3">Style 3</option>
            <option value="style4">Style 4</option>
            <option value="style5">Style 5</option>
            <option value="style6">Style 6</option>
            <option value="style7">Style 7</option>
            <option value="style8">Style 8</option>
            <option value="style9">Style 9</option>
            <option value="style10">Style 10</option>
            <option value="style11">Style 11</option>
            <option value="none">No Caption</option>
            <option value="block-style">Block Caption</option>
            <option value="song-block">song-block</option>
            <option value="story-block">story-block</option>
        </select>


        <label for="captLength">Words per Caption</label>
        <input type="number" id="captLength" name="captLength" value="5" min="1" max="1000">

        <label>Duration (Seconds):</label>
        <input type="text" name="duration" id="audioDuration" placeholder="auto-filled from audio.wav">
        <button type="button" id="getDurationButton">Get Duration</button>


        <label for="minLineGapSec">Min gap between lines (sec)</label>
        <input type="number" id="minLineGapSec" name="minLineGapSec" value="0.40" step="0.05" min="0" />

        <label for="bgMusicSelect">Background Music:</label>
        <select id="bgMusicSelect" name="bgMusicSelect">
            <option value="none">None</option>
            <option value="children-a-baby-story-530.mp3">Children-story</option>
            <option value="children-close-your-eyes-now-1022.mp3">Children-eyes</option>
            <option value="children-lullaby-night-531.mp3">Children-lullaby</option>
            <option value="children-summers-here-91.mp3">Children-summers</option>
            <option value="horror-fright-night-871.mp3">Horror-fright</option>
            <option value="horror-piano-671.mp3">Horror-piano</option>
            <option value="positive-a-very-happy-christmas-897.mp3">Positive-christmas</option>
            <option value="positive-mixkit-fun-jazz-647.mp3">Positive-fun</option>
            <option value="positive-wedding-01-657.mp3">Positive-wedding</option>
            <option value="story-classical-3-710.mp3">Story-1</option>
            <option value="story-classical-6-713.mp3">Story-6</option>
            <option value="story-classical-10-717.mp3">story-10</option>
        </select>

        <label for="disableSubscribe">Disable Subscribe Gif</label>
        <select id="disableSubscribe" name="disableSubscribe">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Output file(e.g.):"edit_vid_output/output.mp4", "test.mp4"</label>
        <input type="text" name="outputfile" value="edit_vid_output/output.mp4">

        <button type="submit">Play video and run OBS Recorder</button>
        <div class="infoBox">This will also save the output as processed_videos/output.mp4</div>
    </form>

    <br>
    <form id="uploadForm">
        <h2>8.Youtube Single Video Upload</h2>
        <div class="row">

            <label>Video size:</label>
            <select name="size">
                <option value="landscape">landscape</option>
                <option value="portrait">portrait</option>
            </select>

            <div>
                <label>Video File (basename without .mp4)</label>
                <input type="text" name="video_path" value="output" required />
                <div class="hint">Default: "output" ‚Üí processed_videos/output.mp4</div>
            </div>

            <div>
                <label>YouTube Channel Name</label>
                <select name="youtube_channel_name" id="channelSelect" required>
                    <option value="">-- Select Channel --</option>
                    <option value="Trend Testers">Trend Testers</option>
                    <option value="Cash Flow Hacks">Cash Flow Hacks</option>
                    <option value="The Parent Pod">The Parent Pod</option>
                    <option value="Indian Stories in English">Indian Stories in English</option>
                    <option value="BhaktiSagar">BhaktiSagar</option>
                    <option value="English Story World">English Story World</option>
                    <option value="Easy Learning">Easy Learning</option>
                </select>
            </div>
        </div>

        <div>
            <label>Playlist</label>
            <select name="youtube_playlist_name" id="playlistSelect">
                <option value="">-- Select Playlist --</option>
            </select>
            <div class="hint">Options update automatically based on the selected channel.</div>
        </div>

        <div>
            <label>Title</label>
            <input type="text" name="youtube_title" maxlength="100" required />
        </div>

        <div>
            <label>Description</label>
            <textarea name="youtube_description" rows="6" placeholder="Video description..."></textarea>
        </div>

        <div>
            <label>Tags (comma-separated)</label>
            <input type="text" name="youtube_tags" placeholder="tag1, tag2, tag3" />
        </div>

        <div class="row">
            <div>
                <label>Made for Kids?</label>
                <select name="made_for_kids">
                    <option value="false" selected>No</option>
                    <option value="true">Yes</option>
                </select>
            </div>
            <div>
                <label>Schedule Date (optional)</label>
                <input type="date" name="schedule_date" />
            </div>
        </div>

        <div class="actions">
            <button type="submit">Upload</button>
        </div>

        <div id="result"></div>

    </form>
    <br>
    <form id="contentForm">
        <h2 style="background-color: yellow;">Content Processor</h2>

        <label>Website URLs (semicolon-separated):</label>
        <textarea name="urls" rows="4"></textarea>
        If want to use prerecorded audios, place them in ready_audio folder with file name matching the title of the
        story/Short
        <label>Audio->WordTimeStamps-Video
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Designed for NotebookLM type audios. There should be image at the end of the shorts text. Shorts
                    text should match with the
                    WordTimeStamps text.
                </span>
            </span>

        </label>
        <select name="notebooklm">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Pick video background and story from Excel:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    For using this option, provide captions, video background,and YouTube metadata in
                    video_story_input.xlsx.
                </span>
            </span>
        </label>
        <select name="excel">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <label>Select TTS Engine:</label>
        <select name="tts">
            {% for key in tts_options.keys() %}
            <option value="{{ key }}">{{ key }}</option>
            {% endfor %}
        </select>

        <label>Select Voice Gender:</label>
        <select name="gender" id="gender" onchange="updateVoices()">
            {% for g in voice_genders %}
            <option value="{{ g }}">{{ g }}</option>
            {% endfor %}
        </select>

        <label>Select Voice:</label>
        <select name="voice" id="voice">
            <!-- Populated by JS -->
        </select>

        <label>Select Video Type:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Ensure camera frames marked on the web page match with the selection. Also OBS studio should have
                    corresponding scene and profile.
                </span>
            </span>
        </label>
        <select name="size">
            {% for label in sizes.keys() %}
            <option value="{{ label }}">{{ label }}</option>
            {% endfor %}
        </select>

        <label>Select Background Music:</label>
        <select name="music">
            {% for filename in music_options.keys() %}
            <option value="{{ filename }}">{{ filename }}</option>
            {% endfor %}
        </select>

        <label>Max Words per Caption:</label>
        <input type="number" name="max_words" min="1" max="1000" value="4">

        <label>Select Caption Style:</label>
        <select name="style">
            {% for style_key in style_options.keys() %}
            <option value="{{ style_key }}">{{ style_key }}</option>
            {% endfor %}
        </select>

        <label>Skip Puppeteer Call:</label>

        <select name="skip_puppeteer">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Skip Captions:</label>
        <select name="skip_captions">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Add Sound Pitch:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Id it is adult, it does not change anything.
                </span>
            </span>
        </label>
        <select name="pitch">
            <option>adult</option>
            <option>child</option>
            <option>teen</option>
            <option>elderly</option>
        </select>

        <label>Disable Subscribe Gif:
            <span class="tooltip-container">
                &#9432;
                <span class="tooltip-text">
                    Disable it for advertisement videos.
                </span>
            </span>
        </label>
        <select name="disable_subscribe">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <button type="submit">Process</button>
    </form>
    <br>

    <form id="sunoToVideoGenerator">
        <h2 style="background-color:coral">Suno.com song + Video Clip</h2>
        <div>
            <ol>
                <li>Place song audio.wav inside edit_vid_audio.</li>
                <li>Place video clip (5/8 secs) at edit_vid_input. (Change slow down factor below if needed)</li>
                <li>Click on below button</li>
                <li>This would make longer clip by slowing speed and then create video by repeating to audio length
                    It will then place the video as composed_video.mp4 inside the root folder.
                    And will place the input audio file as audio.wav inside the root folder.
                </li>
                <li>Then for <b>English</b> language audio</li>
                <ul>
                    <li>it will call script to make WordTimeStamps file.</li>
                    <li>After processing is done, review the captions at <a href="prepare_captions" target="_blank">Open
                            Caption Editor</a>
                        (Opens in new tab) and make necessary change. </li>
                    <li>Then Run OBS Recorder to create final video for upload. Parameters: Caption-style1, words per
                        caption-10,outputfile - edit_vid_output/output.mp4 </li>
                </ul>
                <!-- <li>For <b>Hindi</b> language audio, if provided size is Landscape it will also create portait video so
                    that captions can be applied together</li> -->

            </ol>

        </div>

        <label>Audio has music (Vocals would be seperated before creating captions):</label>
        <select name="music">
            <option value="yes">yes</option>
            <option value="no">no</option>
        </select>

        <!-- <label>Slow down video clips by factor:</label>
        <input type="number" name="slowfactor" min="1" max="10" value="4"> -->

        <label>Change speed by factor (e.g. 2.0/3.0 will make video 2/3 times longer, 0.5 for 2 x faster):</label>
        <input type="number" name="slowfactor" step="any" placeholder="4.0">

        <label>Input clip size:</label>
        <select name="size">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <button type="submit">Create Video and Caption Text</button>

        For <b>Hindi</b> language audio
        <ul>
            <li>Create Hindi captions using <a href="hindi_caption_builder" target="_blank">hindi_caption_builder</a>
                Export the captions to word_timestamps.json.</li>
            <li>Then Run OBS Recorder to create final video for upload. Parameters: Language-Hindi, Caption-style4,
                words per
                caption-1,outputfile - edit_vid_output/output.mp4 </li>

            <!-- <li><a href="apply_caption" target="_blank">Create Videos with Caption</a>. If input clip
                size is "landscape", Create video button will additionally create Portrait
                video with captions in the edit_vid_output folder.</li> -->
        </ul>
    </form>
    <br>


    <form id="sunoNImageToVideoGenerator">
        <h2>Suno.com song + Images</h2>
        <div>
            <ol>
                <li>Place song audio.wav inside edit_vid_audio.</li>
                <li>Place images in edit_vid_input. (If needed, change input image size and clip duration for each image
                    )</li>
                <li>Click on below button</li>
                <li>This would make video clips and then create video by repeating to audio length
                    It will then place the video as composed_video.mp4 inside the root folder.
                    And will place the input audio file as audio.wav inside the root folder.
                </li>
                <li>Then for <b>English</b> language audio</li>
                <ul>
                    <li>it will call script to make WordTimeStamps file.</li>
                    <li>After processing is done, review the captions at <a href="prepare_captions" target="_blank">Open
                            Caption Editor</a>
                        (Opens in new tab) and make necessary change. </li>
                    <li>Then Run OBS Recorder to create final video for upload. Parameters: Caption-style1, words per
                        caption-10,outputfile - edit_vid_output/output.mp4 </li>
                </ul>
                <!-- <li>For <b>Hindi</b> language audio, if provided size is Landscape it will also create portait video so
                    that captions can be applied together</li> -->

            </ol>

        </div>

        <label>Audio has music (Vocals would be seperated before creating captions):</label>
        <select name="music">
            <option value="yes">yes</option>
            <option value="no">no</option>
        </select>

        <label>Input image size:</label>
        <select name="size">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Duration of video per image (Seconds):</label>
        <input type="number" name="duration" min="1" max="60" value="20">

        <label>Language:</label>
        <select name="language">
            <option>english</option>
            <option>english-india</option>
            <option>hindi</option>
            <option>french</option>
        </select>

        <button type="submit">Create Video and Caption Text</button>

        For <b>Hindi</b> language audio
        <ul>
            <li>Create Hindi captions using <a href="hindi_caption_builder" target="_blank">hindi_caption_builder</a>
                Export the captions to word_timestamps.json.</li>
            <li>Then Run OBS Recorder to create final video for upload. Parameters: Language-Hindi, Caption-style4,
                words per
                caption-1,outputfile - edit_vid_output/output.mp4 </li>

            <!-- <li><a href="apply_caption" target="_blank">Create Videos with Caption</a>. If input clip
                size is "landscape", Create video button will additionally create Portrait
                video with captions in the edit_vid_output folder.</li> -->
        </ul>
    </form>
    <br>

    <form id="uploadToYoutube">
        <h2>Youtube Bulk Upload</h2>
        <div> To be run after video created in Processed_video folder and record is added in video_records.xlsx


        </div>

        <p class="hint">
            <b>Note:</b> Your uploader expects <code>video_path</code> to be the filename (without .mp4),
            and it will look under <code>processed_videos/&lt;video_path&gt;.mp4</code>.
        </p>

        <button type="submit">Upload Videos to Youtube</button>
    </form>
    <br>

    <form id="extractAudioForm">
        <h2 style="background-color:#ffe4b5;">Extract Audio from Videos</h2>

        <label>Output format:</label>
        <select name="format">
            <option value="wav" selected>wav (44100 Hz, stereo)</option>
            <option value="mp3">mp3 (192 kbps)</option>
            <option value="m4a">m4a (AAC 192 kbps)</option>
        </select>

        <label>Audio track index (0-based):</label>
        <input type="number" name="track" value="0" min="0">

        <button type="submit">Extract Audio for All in edit_vid_input</button>

        <div class="infoBox" style="margin-top:8px;">
            Scans <code>edit_vid_input/</code> for video files and writes each extracted audio to
            <code>edit_vid_output/</code>. No upload or path needed.
        </div>

        <div id="extractAudioResult" style="margin-top:10px;"></div>
    </form>

    <br>

    <form id="aiVideoPromptMaker">
        <h2>AI Video Prompt Maker</h2>
        <a href="aivideoprompt" target="_blank">Open AI Video Prompt Maker</a>
        (Opens in new tab)
    </form>

    <br>
    <form id="runVideoEditor">
        <h2>Video Editor</h2>
        <div> To be used to slow (pixverse) video speed to increase length. Cut portion of video to remove watermark.
            Add own watermark. Add background audio.
            <br><br>Place the input mp4 files in edit_vid_input folder. Output files will be created in edit_vid_output.
        </div>
        <br>
        <label>Orientation:</label>
        <select name="orientation">
            <option value="auto">auto</option>
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Background Music:</label>
        <select name="bgmusic">
            <option value="none">none</option>
            <option value="god_bg">Random from folder god_bg</option>
        </select>

        <label>Remove from Top(leave blank/50/60):</label>
        <input type="number" name="topcut">

        <label>Remove from bottom(leave blank/50/60):</label>
        <input type="number" name="bottomcut">

        <label>Change speed by factor (e.g. 2.0/3.0 will make video 2/3 times longer, 0.5 for 2 x faster):</label>
        <input type="number" name="slowfactor" step="any" placeholder="2.0">


        <!-- <label>Watermark:</label>
        <select name="watermark">
            <option value="none">none</option>
            <option value="logo.png">logo.png</option>
        </select> -->

        <label>Watermark position:</label>
        <select name="watermarkposition">
            <option value="none">none</option>
            <option value="bottom-left">bottom-left</option>
            <option value="bottom-right">bottom-right</option>
            <option value="top-left">top-left</option>
            <option value="top-right">top-right</option>
        </select>

        <button type="submit">Process Videos</button>
    </form>
    <br>
    <form id="addOverlay">
        <h2>Add Overlay</h2>
        <div> To be used to add flower petals/sparkle on the video.
            <br><br>Place the input mp4 files in edit_vid_input folder. Output files will be created in edit_vid_output.
        </div>
        <br>
        <label>Add Petals:</label>
        <select name="add_petals">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <label>Add Sparkles:</label>
        <select name="add_sparkles">
            <option value="no">no</option>
            <option value="yes">yes</option>
        </select>

        <button type="submit">Process Videos</button>
    </form>

    <br>
    <form id="multiplyVideo">
        <h2>Multiply Video/Audio</h2>
        <div> To be used to repeat the video/audio by a factor.
            <br><br>Place the input video/audio files in edit_vid_input folder. Output files will be created in
            edit_vid_output. E.g. enter 10 if the video is to be made 10 times long
        </div>
        <br>
        <label>Repeat Factor:</label>
        <input type="number" name="repeat_factor" min="1" value="1">

        <button type="submit">Process Videos/Audio</button>
    </form>
    <br>

    <!-- 10. Upscale SD ‚Üí HD -->
    <form id="upscaleVideoForm">
        <h2 style="background-color:#e8f5e9;">Upscale SD ‚Üí HD</h2>

        <div class="infoBox">Picks the files from edit_vid_input folder</div>
        <!-- <label>Upload a video (optional):</label>
        <input type="file" name="file" accept="video/*">

        <label>‚Ä¶or use existing project path:</label>
        <input type="text" name="video" placeholder="/edit_vid_input/bg_video.mp4 or /edit_vid_output/output.mp4"
            value="/edit_vid_input/bg_video.mp4"> -->
        <label>Keep audio?</label>
        <select name="keep_audio">
            <option value="yes" selected>yes</option>
            <option value="no">no (mute)</option>
        </select>

        <label>Target Width:</label>
        <select name="width">
            <option value="1280">1280 (720p)</option>
            <option value="1920" selected>1920 (1080p)</option>
        </select>

        <label>Deinterlace?</label>
        <select name="deinterlace">
            <option value="true" selected>true</option>
            <option value="false">false</option>
        </select>

        <label>Denoise?</label>
        <select name="denoise">
            <option value="true" selected>true</option>
            <option value="false">false</option>
        </select>

        <label>Encoding CRF (lower=better):</label>
        <input type="number" name="crf" min="14" max="28" value="18">

        <label>Preset:</label>
        <select name="preset">
            <option>ultrafast</option>
            <option>superfast</option>
            <option>veryfast</option>
            <option>faster</option>
            <option>fast</option>
            <option selected>slow</option>
            <option>slower</option>
            <option>veryslow</option>
        </select>

        <button type="submit">Upscale Video</button>

        <div class="infoBox">
            Saves <code>/upscaled_&lt;width&gt;w.mp4</code> at project root (downloadable via
            <code>/video/‚Ä¶</code>) and copies to <code>edit_vid_output/</code>.
        </div>

        <div id="upscaleResult" style="margin-top:10px;"></div>
    </form>

    <br>
    <form id="makeKBVideoFromImages">
        <h2>Make Ken Burn Videos from Images</h2>
        <div> To be used to make image video clips that will be used to make song videos later.
            <br><br>Place the images in edit_vid_input folder. Output files will be created in edit_vid_output.
        </div>

        <label>Input image size:</label>
        <select name="size">
            <option value="landscape">landscape</option>
            <option value="portrait">portrait</option>
        </select>

        <label>Duration of video per image (Seconds):</label>
        <input type="number" name="duration" min="1" max="60" value="20">
        <button type="submit">Process Images</button>
    </form>

    <br>
    <form id="thumbnailMaker">
        <h2>Old Thumbnail Maker</h2>
        <a href="thumbnail" target="_blank">Open Thumbnail Maker</a>
        (Opens in new tab)
    </form>

    <br>
    <form id="quizMaker">
        <h2>Quiz Video Maker</h2>
        <a href="quiz" target="_blank">Open Quiz Video Maker</a>
        (Opens in new tab)
    </form>

    <br>
    <form id="splitVideoToParts">
        <h2>Split long video to parts </h2>
        <div> Can be used for creating shorts for upload.
            <br><br>Picks the input from edit_vid_output/output.mp4. Parts are created in edit_vid_output folder.

        </div>

        <div style="background-color:#cfe0ff; padding:10px; margin-bottom:10px;">
            <label>Convert landscape ‚Üí portrait 9:16?</label>
            <select name="convert_portrait">
                <option value="no" selected>no</option>
                <option value="yes">yes</option>
            </select>

            <label>Portrait resolution:</label>
            <select name="portrait_size">
                <option value="1080x1920" selected>1080 x 1920</option>
                <option value="720x1280">720 x 1280</option>
            </select>

            <label>Horizontal focus (crop anchor):</label>
            <select name="focus">
                <option value="center" selected>center</option>
                <option value="left">left</option>
                <option value="right">right</option>
            </select>

            <label>Keep audio in portrait file?</label>
            <select name="keep_audio">
                <option value="yes" selected>yes</option>
                <option value="no">no (mute)</option>
            </select>
        </div>
        <label>Max lenth of parts (Seconds):</label>
        <input type="number" name="duration" min="1" max="1000" value="170">
        <button type="submit">Create Video</button>
    </form>
    <br>

    <form id="mixVocalMusicForm">
        <h2 style="background:#d1fae5;">Merge Vocal + Music ‚Üí Pro Mix</h2>

        <label>Vocal file (optional):</label>
        <input type="file" name="vocal_file" accept=".wav,.mp3,.m4a,.flac,.aac,.ogg" />

        <label>Music file (optional):</label>
        <input type="file" name="music_file" accept=".wav,.mp3,.m4a,.flac,.aac,.ogg" />

        <div class="infoBox">
            If you don‚Äôt upload files, the server will try to auto-pick from
            <code>edit_vid_audio/</code> (e.g. names containing <i>vocal/vox</i> and <i>music/bg/instrumental</i>) or
            the first two audio files it finds.
        </div>

        <label>Output format:</label>
        <select name="format">
            <option value="wav" selected>WAV</option>
            <option value="mp3">MP3 (requires ffmpeg)</option>
        </select>

        <label>Target loudness (LUFS):</label>
        <input type="number" step="0.1" name="target_lufs" value="-14">

        <label>Music start gain (dB):</label>
        <input type="number" step="0.5" name="music_gain_db" value="-10">

        <label>Ducking depth under vocal (dB):</label>
        <input type="number" step="0.5" name="duck_db" value="10">

        <label>Music floor even with quiet vocal (dB):</label>
        <input type="number" step="0.5" name="duck_floor_db" value="-1">

        <button type="submit">Create Professional Mix</button>

        <div id="mixResult" style="margin-top:10px;text-align:center;"></div>
    </form>


    <br>
    <form id="mergeBgMusicForm">
        <h2 style="background-color:#dbeafe;">3b. Add Background Music to Video</h2>

        <div>
            Takes the first <code>video</code> in <code>edit_vid_input/</code> and the first
            <code>audio</code> in <code>edit_vid_audio/</code>, then mixes them into a new video.
        </div>

        <div class="infoBox">
            üéß <b>How it works:</b><br>
            ‚Ä¢ Background music is looped and trimmed to match video length.<br>
            ‚Ä¢ If the video already has audio, both are mixed using the volume levels below.<br>
            ‚Ä¢ Output is saved in <code>edit_vid_output/</code>.
        </div>

        <label for="merge_out_name">Output filename (in <code>edit_vid_output</code>):</label>
        <input type="text" id="merge_out_name" name="out_name" value="video_with_music.mp4"
            placeholder="video_with_music.mp4">

        <label for="merge_video_volume">Original video audio volume (0.0 ‚Äì 2.0):</label>
        <input type="number" id="merge_video_volume" name="video_volume" value="1.0" step="0.1" min="0" max="2">

        <label for="merge_bg_volume">Background music volume (0.0 ‚Äì 2.0):</label>
        <input type="number" id="merge_bg_volume" name="bg_volume" value="0.3" step="0.1" min="0" max="2">

        <button type="submit">Merge Background Music</button>

        <div id="mergeBgMusicResult" style="margin-top:10px;text-align:center;"></div>
    </form>
    <br>

    <form id="polishAudioForm">
        <h2 style="background:#ffeaa7;">Polish Phone Audio ‚Üí Studio (Adaptive)</h2>

        <label>Audio source:</label>
        <div style="font-size:13px;color:#555;margin:-6px 0 8px;">
            Upload a file (optional). Otherwise the server uses the first file in <code>edit_vid_audio/</code> or
            <code>audio.wav</code> in project root.
        </div>
        <input type="file" name="audio_file" accept=".wav,.m4a,.mp3,.aac,.flac,.ogg" />

        <label>Noise handling:</label>
        <select name="denoise">
            <option value="auto" selected>auto (detect per file)</option>
            <option value="none">none</option>
            <option value="light">light</option>
            <option value="medium">medium</option>
            <option value="strong">strong</option>
        </select>

        <label>High-pass (Hz):</label>
        <input type="number" name="hp" value="80" min="0" />

        <label>Low-pass (Hz, 0=off):</label>
        <input type="number" name="lp" value="12000" min="0" />

        <label>De-esser intensity (0‚Äì10):</label>
        <input type="number" name="deess" value="5" min="0" max="10" />

        <label>Target loudness (LUFS):</label>
        <input type="number" name="target_lufs" step="0.1" value="-16" />

        <label>True-peak limit (dBTP):</label>
        <input type="number" name="tp" step="0.1" value="-1.5" />

        <label>LRA target:</label>
        <input type="number" name="lra" step="0.1" value="11" />

        <label>Force mono?</label>
        <select name="mono">
            <option value="true">true</option>
            <option value="false" selected>false</option>
        </select>

        <label>Sample rate (Hz, blank=keep):</label>
        <input type="number" name="ar" placeholder="48000" />

        <label>Use speechnorm (if FFmpeg supports it)?</label>
        <select name="speechnorm">
            <option value="false" selected>false</option>
            <option value="true">true</option>
        </select>

        <button type="submit">Polish Audio</button>
        <div id="polishAudioResult" class="infoBox" style="display:none;"></div>
    </form>

    <br>
    <form id="createImagesForm">
        <h2 style="background:#ffe4b5;">Create Images from Excel</h2>
        <button type="submit">Run Image Jobs</button>
        <pre id="createImagesResult"></pre>
    </form>
    <br>
    <form id="createVideosForm">
        <h2 style="background:#ffe4b5;">Create Videos from Excel</h2>
        <button type="submit">Run Video Jobs</button>
        <pre id="createVideosResult"></pre>
    </form>
    <br>
    <form id="removeBordersForm">
        <h2 style="background:#e0f2fe;">Blank Out Border (Keep Original Size)</h2>

        <label>Source folder under <code>application/downloads/</code>:</label>
        <input type="text" name="source_folder" placeholder="e.g. 7b. Dinosaurs"
            style="width:100%;max-width:420px;margin-bottom:6px;">

        <label>Border size (px to blank out):</label>
        <input type="number" name="border_px" min="0" value="5" style="width:120px;margin-bottom:6px;">

        <div class="infoBox">
            This will NOT crop or resize the image.<br>
            It will only blank out border pixels while keeping canvas size unchanged.
        </div>

        <button type="submit">Run Border Cleaner</button>
        <pre id="removeBordersResult"></pre>
    </form>

    <br>
    <form id="createVectorImagesForm">
        <h2 style="background:#ffe4b5;">Create svg Vector Images from Images in downloads folder</h2>

        <label for="vectorSourceFolder">Source folder under <code>downloads/</code>:</label>
        <input type="text" id="vectorSourceFolder" name="source_folder" placeholder="e.g. 1.Cute Farm Animals/pages"
            style="width:100%;max-width:420px;margin-bottom:6px;">

        <div class="infoBox" style="margin-bottom:8px;">
            All images from <code>downloads/&lt;source_folder&gt;</code> will be converted.
            Output will be created in <code>vector_images/&lt;source_folder&gt;</code> with the same folder name.
        </div>

        <button type="submit">Run Vector Image Jobs</button>
        <pre id="createVectorImagesResult"></pre>
    </form>

    <br>
    <form id="coloringBookBuilder">
        <h2 style="background:#ffe4b5;">Coloring Book Builder</h2>
        <a href="coloring_book_builder" target="_blank">Open Coloring Book Builder</a>

    </form>

    <br>
    <form id="prepareCaptions">
        <h2 style="background:#ffe4b5;">Caption Editor</h2>
        <a href="prepare_captions" target="_blank">Open Caption Editor</a>

    </form>
    <br>
    <form id="pdfToFlippingBookForm">
        <h2 style="background:#ffe4b5;">Flipping Book Effect</h2>
        <a href="pdf_to_flipping_book" target="_blank">Open Page to convert PDF to flipping book</a>
    </form>

    <br>
    <form id="loadPortait">
        <h2 style="background:#ffe4b5;">Portrait Website Loader</h2>
        <a href="portrait_website_loader" target="_blank">Open Portrait Website Loader</a>

    </form>
    <br>
    <br>
    <form id="seoMetaForm">
        <h2 style="background-color: #ffe4b5;">SEO Metadata Generator</h2>
        <p>
            **Prerequisite** Before running python server.py run set GEMINI_API_KEYS=
            <br><br>
            Uses <code>pages_input.xlsx</code> in the application folder and creates/updates
            <code>pages_with_meta.xlsx</code> with meta_title, meta_description, keywords,
            og_title, og_description, and intro_paragraph for each URL.
        </p>
        <button type="submit">Run SEO Metadata Generator</button>
        <div class="infoBox">
            Make sure <strong>pages_input.xlsx</strong> is present beside <strong>server.py</strong>
            before running. The updated file will be <strong>pages_with_meta.xlsx</strong>.
        </div>
    </form>

    <div id="seoMetaResult" style="margin-top: 10px; font-size: 14px;"></div>

    <br>
    <br>
    <form id="buildManifestForm">
        <h2 style="background:#e0f2fe;">Build Coloring Manifest & Thumbnails</h2>

        <label>Root folder under <code>application/</code>:</label>
        <input type="text" name="source_folder" placeholder="e.g. vector_images or downloads "
            style="width:100%;max-width:420px;margin-bottom:6px;">

        <div class="infoBox" style="margin-bottom:8px;">
            ‚Ä¢ Each immediate subfolder of <code>application/&lt;source_folder&gt;</code> is treated as a category.<br>
            ‚Ä¢ If a category has a <code>pages/</code> folder, PNG/SVG files from there are used;
            otherwise images directly under the category folder are used.<br>
            ‚Ä¢ If PNG and SVG both exist:
            <ul>
                <li>Thumbnail: generated from PNG ‚Üí WEBP in thumbs</li>
                <li>src in manifest: points to SVG URL</li>
            </ul>
            ‚Ä¢ If only PNG exists: both src + thumb use PNG-based resources.<br>
            ‚Ä¢ If only SVG exists: src uses SVG, thumb falls back to SVG URL.<br><br>
            ‚Ä¢ Thumbnails are written to <code>thumbs/</code> inside each category.<br>
            ‚Ä¢ A <code>manifest.json</code> file is written to the root folder you specified.<br><br>
            ‚Ä¢ After successful execution, delete png files from pages folder and place the above mentioned root folder
            under /coloring/static/v2/.<br><br>
            ‚Ä¢ Place the manifest.json under /coloring/static/manifests/ as v2xx.json.<br>
            ‚Ä¢ Update v2xx.json version in coloring\scripts.js and increment script?v= in index.html.
        </div>

        <label>Overwrite existing thumbnails?</label>
        <select name="force" style="margin-bottom:6px;">
            <option value="0">No (skip existing)</option>
            <option value="1">Yes (rebuild all)</option>
        </select>

        <button type="submit">Build Manifest</button>
        <pre id="buildManifestResult"></pre>
    </form>
    <br>
    <form id="convertLandscapeImagesForm">
        <h2>Convert Landscape Images ‚Üí Portrait / 1000√ó1500</h2>

        <div class="infoBox" style="margin-top:8px;">
            ‚Ä¢ Reads images from <code>edit_vid_input/</code> and writes converted JPGs under <code>edit_vid_output/</code> (same folder structure).<br>
            ‚Ä¢ <b>cover</b> fills the frame and <b>crops the sides</b> to match the target ratio.<br>
            ‚Ä¢ <b>contain</b> keeps the full image and pads with a <i>blur</i> or <i>white</i> background.
        </div>

        <label>Target format:</label>
        <select name="mode" style="margin-bottom:10px;">
            <option value="portrait" selected>Portrait 1080√ó1920 (9:16)</option>
            <option value="1000x1500">1000√ó1500 (2:3)</option>
        </select>

        <label>Fit method:</label>
        <select name="fit" style="margin-bottom:10px;">
            <option value="contain" selected>contain (no crop, add padding)</option>
            <option value="cover">cover (crop to fill frame)</option>
        </select>

        <label>Background (used only with contain):</label>
        <select name="bg" style="margin-bottom:10px;">
            <option value="blur" selected>blur</option>
            <option value="white">white</option>
        </select>

        <label>JPEG quality (1-95):</label>
        <input type="number" name="quality" value="92" min="1" max="95" style="width:120px;margin-bottom:10px;">

        <button type="submit">Convert Images</button>
        <div id="convertLandscapeImagesResult" style="margin-top:10px;"></div>
    </form>  

<br>
<form id="renderPinsFromPinDataForm">
  <h2 style="background:#e0f2fe;">Render Pinterest Pins from PIN_DATA.xlsx (JSON Overlay)</h2>

  <div class="infoBox" style="margin-bottom:8px;">
    <b>Folder must contain:</b> <code>PIN_DATA.xlsx</code> + backgrounds(png/mp4) + overlay.json +  logo.png files.<br>
    The script will render <b>image</b> pins (.jpg) or <b>video</b> pins (.mp4) and log them to
    <code>master_shorts_uploader_data.xlsx</code>.
  </div>

  <label>Select folder (upload directory from your computer):</label><br>
  <input type="file" id="pin_data_dir" name="source_dir" webkitdirectory directory multiple style="margin-bottom:10px;">
  <div style="font-size:12px;color:#6b7280;margin-bottom:10px;">
    Leave empty if you want to use an existing server-side folder path below.
  </div>

  <label>Or use existing folder (server path relative to application folder):</label><br>
  <input type="text" name="source_folder" placeholder="e.g. pinterest_uploads/uploads or downloads/my_batch"
         style="width:100%;max-width:520px;margin-bottom:10px;">

  <label>Pin type:</label><br>
  <select name="pin_type" style="margin-bottom:10px;">
    <option value="image" selected>Image pins (.jpg)</option>
    <option value="video">Video pins (.mp4)</option>
  </select>

  <label>How many pins to render (0 = all rows):</label><br>
  <input type="number" name="max_pins" value="0" style="width:120px;margin-bottom:10px;">

  <button type="submit">Render Pins</button>
  <pre id="renderPinsFromPinDataResult" style="margin-top:8px;font-size:13px;white-space:pre-wrap;"></pre>
</form>    
    
    <br>
    <form id="pinterestExcelFormForColoringPins">
        <h2 style="background:#fef3c7;">Generate Short Video and Upload to Multiple Platforms (YouTube, facebook, Insta,
            Tiktok, Pinterest)</h2>

        <div class="infoBox" style="margin-bottom:8px;">
            <strong>Option 1 ‚Äì Upload a folder from your computer:</strong><br>
            ‚Ä¢ Uses a **PNG** directory picker so you don't have to type paths.<br>
            ‚Ä¢ You can choose any folder (not just under <code>downloads</code>).<br>
            ‚Ä¢ The folder is uploaded to the server under <code>pinterest_uploads/</code> for processing.<br><br>
            <strong>Option 2 ‚Äì Use existing folder on server:</strong><br>
            ‚Ä¢ If images already exist under <code>downloads/</code> beside <code>server.py</code>,<br>
            &nbsp; you can just type its relative path (e.g. <code>1.Cute Farm Animals/pages</code>).
        </div>

        <label>Select **PNG** source folder (upload directory from your computer)<br>
        Or Existing Video source folder if using that uption from the dropdown of Media type:
        </label><br>
        <input type="file" id="source_dir" name="source_dir" webkitdirectory directory multiple
            style="margin-bottom:10px;">

        <div style="font-size:12px;color:#6b7280;margin-bottom:10px;">
            You can leave this empty if you want to use an existing server-side folder instead.
        </div>

        <label>Or use existing folder under <code>downloads/</code> (server):</label>
        <input type="text" name="source_folder" placeholder="e.g. 1.Cute Farm Animals/pages"
            style="width:100%;max-width:420px;margin-bottom:10px;">

        <!-- <label>Main PIN URL:</label>
        <select id="pin_url" name="pin_url" style="margin-bottom:10px;">
            <option value="gng" selected>Goodsandgift path from pinterest_config.json</option>
            <option value="amazon">Amazon coloring book series Link</option>
            <option value="gumroad" selected>kishna01.gumroad.com</option>
            <option value="readernook" selected>coloring.readernook.com</option>
        </select> -->


        <label>Media type:</label>
        <select id="pin_media_type" name="media_type" style="margin-bottom:10px;">
            <option value="image" selected>Image Pins</option>
            <option value="video">Video Pins</option>
            <option value="coloring" selected>Coloring Video</option>
            <option value="existing_video" selected>Existing Video</option>
        </select>
        <div class="infoBox" id="coloringVidId" style="margin-bottom:8px;">
            For "Coloring Video" option, select the input folder that contains colored images</div>


        <label>Max pins to generate (0 = all):</label>
        <input type="number" name="max_pins" value="1" style="width:120px;margin-bottom:10px;">

        <div class="infoBox" id="videoPinProps">
            <label>Video duration per Pin (seconds):</label>
            <input type="number" name="video_duration" value="10" min="2" max="60"
                style="width:120px;margin-bottom:8px;">
            <div style="font-size:12px;color:#6b7280;margin-top:-6px;margin-bottom:8px;">
                Used only for Video Pins.
            </div>

            <label>Video style:</label>
            <select name="video_style" style="margin-bottom:8px;">
                <!-- <option value="single">Single page video</option> -->
                <option value="slideshow">Slideshow (multiple pages)</option>
                <option value="flipbook">Flipbook (multiple pages)</option>
            </select>

            <label>Pages per video (for Flipbook/Slideshow):</label>
            <input type="number" name="pages_per_video" value="10" min="2" max="40"
                style="width:120px;margin-bottom:10px;">

            <label>Video FPS:</label>
            <input type="number" name="video_fps" value="30" min="10" max="60" style="width:120px;margin-bottom:10px;">
        </div>
        <label style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
            <input type="checkbox" name="use_gemini" value="yes">
            Use Gemini API for titles, descriptions & tags
        </label>

        <label style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
            <input type="checkbox" name="add_bg_music" value="yes">
            Add background music to videos
        </label>

        <label style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
            <input type="checkbox" name="auto_crop_subject" value="yes" checked>
            Zoom in on drawing (auto-crop subject)
        </label>

        <label>Output Excel filename:</label>
        <input type="text" name="output_excel" value="master_shorts_uploader_data.xlsx"
            style="width:100%;max-width:420px;margin-bottom:10px;">

        <label>Image fit mode:</label>
        <select name="fit_mode" style="margin-bottom:8px;">
            <option value="contain" selected>Fit inside (no crop)</option>
            <option value="cover">Crop to fill (tall pin)</option>
        </select>
        <br>

        <label>Background style:</label>
        <select name="bg_style" style="margin-bottom:8px;">
            <option value="white" selected>Plain white</option>
            <option value="blur">Blurred page background</option>
        </select>
        <br>

        <label style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
            <input type="checkbox" name="text_shadow" value="yes" checked>
            Add subtle shadow behind banner & watermark text
        </label>



        <input type="hidden" name="text_shadow" value="no" onclick="return false;" style="display:none;">

        <div class="infoBox" style="margin-bottom:8px;">
            <strong>Book info from config file:</strong><br>
            If the selected folder (or its parent) contains
            <code>pinterest_config.json</code>, the script will read:<br>
            ‚Ä¢ <code>book_title</code>, <code>book_url</code>, <code>board_name</code>, <code>banner_text</code>,
            <code>watermark_text</code><br>
            You usually only need to upload/select the folder and click the button.
        </div>

        <!-- Optional overrides. Leave blank to use pinterest_config.json -->
        <details style="margin-bottom:10px;">
            <summary style="cursor:pointer;">Optional overrides (book title, URL, etc.)</summary>
            <div style="margin-top:8px;">
                <label>Book title (override):</label>
                <input type="text" name="book_title" placeholder="Leave blank to use pinterest_config.json"
                    style="width:100%;max-width:420px;margin-bottom:6px;">

                <label>Book / product URL (override):</label>
                <input type="text" name="book_url" placeholder="Leave blank to use pinterest_config.json"
                    style="width:100%;max-width:420px;margin-bottom:6px;">

                <label>Pinterest board name (override):</label>
                <input type="text" name="board_name" placeholder="Leave blank to use pinterest_config.json"
                    style="width:100%;max-width:420px;margin-bottom:6px;">

                <label>Banner text (override):</label>
                <input type="text" name="banner_text" placeholder="Leave blank to use pinterest_config.json"
                    style="width:100%;max-width:420px;margin-bottom:6px;">

                <label>Watermark text (override):</label>
                <input type="text" name="watermark_text" placeholder="Leave blank to use pinterest_config.json"
                    style="width:100%;max-width:420px;margin-bottom:6px;">
            </div>
        </details>

        <label style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
            <input type="checkbox" name="upload_pinterest" value="yes" checked>
            Upload to Platforms (YouTube, facebook, Insta, Tiktok, Pinterest)
        </label>

        <button type="submit">Generate Pinterest Pin Data and Upload Upload to Platforms (YouTube, facebook, Insta,
            Tiktok, Pinterest)</button>
        <button type="button" id="runUploadsFromMasterBtn" style="background-color: blanchedalmond; color: black;">Only
            Run Uploads from Master</button>
        <pre id="pinterestExcelResult" style="margin-top:8px;font-size:13px;white-space:pre-wrap;"></pre>
    </form>
    <br>
    <br>
<form id="batchMakeVideoImagesFromDir">
    <h2>Batch Convert Images to different sizes (Folder Structure)</h2>
    <div>
        Walks the given folder (and all subfolders), uses
        <code>batch_make_video_images_from_dir</code> to create images by cropping /resizing them
        with <code>make_video_image</code>, and writes them into
        <code>edit_vid_output/</code> keeping the same directory structure.
    </div>

    <label>Select Source Folder (Directy inside Application folder):</label><br>

    <input type="text" id="source_dir" name="source_dir" value="del" placeholder="e.g. vector_images or downloads "
    style="width:100%;max-width:420px;margin-bottom:6px;">

    <!-- <input type="file"
           id="source_folder_picker"
           webkitdirectory
           directory
           multiple
           style="margin-bottom:10px;">


    <input type="hidden" name="source_dir" id="source_dir_hidden"> -->
    <label>Taget Image Size:</label>
    <select name="size_option" style="margin-bottom:10px;">
        <option value="portrait">1080x1920 (YouTube Shorts / Reels)</option>
        <option value="landscape">1920x1080 (Landscape)</option>
        <option value="pinterest">1000x1500 (Pinterest)</option>
        <option value="square">1000x1000 (Square)</option>
    </select>
    <button type="submit">Run Batch</button>


    <div class="infoBox" style="margin-top:8px;">
        ‚Ä¢ Output files are created under <code>edit_vid_output/</code> keeping the same folder structure.<br>
        </div>

    <div id="batchMakeVideoImagesFromDirResult" style="margin-top:10px;"></div>
</form>



    <br>
    <form id="coloringAnimationForm">
        <h2>Coloring Page Before/After Animation</h2>

        <label>Upload colored coloring page (PNG/JPG):</label>
        <input type="file" id="coloringImage" name="image" accept="image/*" required />

        <label>Animation Mode:</label>
        <select id="coloringMode" name="mode">
            <option value="by_color">Artist style (one color group at a time)</option>
            <option value="sweep">Smooth sweep (global fill)</option>
        </select>

        <label>Frames per second (FPS):</label>
        <input type="number" id="coloringFps" name="fps" value="24" min="1" max="60" />

        <label>Animation Duration (seconds):</label>
        <input type="number" id="coloringDuration" name="duration" value="6" min="1" max="60" />

        <label>Canvas Preset:</label>
        <select id="canvasPreset" name="canvas_preset">
            <option value="none">Use original image size</option>
            <option value="shorts">1080√ó1920 (YouTube Shorts / Reels)</option>
            <option value="pinterest">1000√ó1500 (Pinterest)</option>
            <option value="custom">Custom size</option>
        </select>

        <div id="customCanvasFields" style="display:none; margin-top:10px;">
            <label>Custom Width:</label>
            <input type="number" id="canvasWidth" name="canvas_width" value="1080" min="100" max="4000" />

            <label>Custom Height:</label>
            <input type="number" id="canvasHeight" name="canvas_height" value="1920" min="100" max="4000" />
        </div>

        <button type="submit">Create Before/After Coloring Animation</button>
        <div class="infoBox">
            This will generate a video in <code>processed_videos/</code> and show a preview + download link below.
        </div>
    </form>

    <div id="coloringAnimationResult" style="margin-top:20px;"></div>
    <video id="coloringAnimationPreview" controls style="display:none; max-width:100%; margin-top:10px;">
        Your browser does not support the video tag.
    </video>
    <br>

    <br>

<script>
  (function(){
    const form = document.getElementById("renderPinsFromPinDataForm");
    const out = document.getElementById("renderPinsFromPinDataResult");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      out.textContent = "Processing...";

      const fd = new FormData(form);
      // IMPORTANT: If the user selected a folder, browsers put files in input.files
      // FormData(form) should already include them; this is just a safety pattern:
      const dirInput = document.getElementById("pin_data_dir");
      if (dirInput && dirInput.files && dirInput.files.length > 0) {
        // fd already has them by name="source_dir", so do nothing
      }

      try {
        const resp = await fetch("/render_pinterest_pins_from_pin_data", {
          method: "POST",
          body: fd
        });
        const data = await resp.json();
        out.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        out.textContent = "Error: " + err;
      }
    });
  })();
</script>    
    <script>
        document.getElementById('batchMakeVideoImagesFromDir').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request.batchMakeVideoImagesFromDir");

            const formData = new FormData(this);
            const response = await fetch('/batchmakevideoimagesfromdir', {
                method: 'POST',
                body: formData
            });

            console.log("Completed batchMakeVideoImagesFromDir");
            const resultText = await response.text();

            const resultDiv = document.getElementById('batchMakeVideoImagesFromDirResult');
            if (resultDiv) {
                resultDiv.textContent = resultText;
            }
        };
    </script>
   <script>
        document.getElementById('convertLandscapeImagesForm').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request.convertLandscapeImages");

            const resultDiv = document.getElementById('convertLandscapeImagesResult');
            if (resultDiv) {
                resultDiv.style.whiteSpace = "pre-wrap";
                resultDiv.textContent = "Running conversion...\n";
            }

            try {
                const formData = new FormData(this);
                const resp = await fetch('/convert_landscape_images', {
                    method: 'POST',
                    body: formData
                });

                const data = await resp.json();
                if (!resp.ok || !data.ok) {
                    const msg = (data && (data.error || data.message)) ? (data.error || data.message) : ("HTTP " + resp.status);
                    if (resultDiv) resultDiv.textContent = "‚ùå " + msg;
                    return;
                }

                const msg = `‚úÖ Done. Read ${data.read_count} image(s), wrote ${data.wrote_count} image(s).\nOutput: ${data.output_dir}`;
                if (resultDiv) resultDiv.textContent = msg;
                console.log(msg);
            } catch (err) {
                console.error(err);
                if (resultDiv) resultDiv.textContent = "‚ùå " + (err?.message || String(err));
            }
        };
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const mediaTypeSelect = document.getElementById("pin_media_type");
            const videoPropsBox = document.getElementById("videoPinProps");
            const coloringVidId = document.getElementById("coloringVidId");

            function toggleVideoProps() {
                if (mediaTypeSelect.value === "video") {
                    videoPropsBox.style.display = "block";
                    coloringVidId.style.display = "none";
                } else if (mediaTypeSelect.value === "coloring") {
                    coloringVidId.style.display = "block";
                    videoPropsBox.style.display = "none";
                } else {
                    videoPropsBox.style.display = "none";
                    coloringVidId.style.display = "none";
                }
            }

            // run once on load
            toggleVideoProps();

            // run whenever selection changes
            mediaTypeSelect.addEventListener("change", toggleVideoProps);
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // --- existing SEO Metadata wiring here ---

            const seoForm = document.getElementById("seoMetaForm");
            const seoResult = document.getElementById("seoMetaResult");

            if (seoForm) {
                seoForm.addEventListener("submit", async function (e) {
                    e.preventDefault();
                    seoResult.style.whiteSpace = "pre-wrap";
                    seoResult.textContent = "Running SEO metadata generator. This may take a while for 400+ pages.\n";

                    try {
                        const resp = await fetch("/generate_meta", {
                            method: "POST"
                        });

                        const data = await resp.json();

                        if (!data.ok) {
                            seoResult.textContent += "\n‚ùå Failed to generate SEO metadata.\n";
                            if (data.error) {
                                seoResult.textContent += "Error: " + data.error + "\n";
                            }
                            if (data.stderr) {
                                seoResult.textContent += "\nStderr:\n" + data.stderr;
                            }
                        } else {
                            seoResult.textContent += "‚úÖ SEO metadata generation completed.\n";
                            seoResult.textContent += "Return code: " + data.returncode + "\n\n";
                            if (data.stdout) {
                                seoResult.textContent += "Log:\n" + data.stdout;
                            }
                        }
                    } catch (err) {
                        seoResult.textContent += "\n‚ùå Request failed: " + err + "\n";
                    }
                });
            }

            // --- NEW: Coloring Manifest Builder wiring ---
            const buildForm = document.getElementById("buildManifestForm");
            const buildResult = document.getElementById("buildManifestResult");

            if (buildForm && buildResult) {
                buildForm.addEventListener("submit", async function (e) {
                    e.preventDefault();
                    buildResult.style.whiteSpace = "pre-wrap";
                    buildResult.textContent = "Running coloring manifest builder...\n";

                    const formData = new FormData(buildForm);

                    try {
                        const resp = await fetch("/build_coloring_manifest", {
                            method: "POST",
                            body: formData
                        });

                        const data = await resp.json();

                        if (!data.ok) {
                            buildResult.textContent += "\n‚ùå Failed to build manifest.\n";
                            if (data.error) {
                                buildResult.textContent += "Error: " + data.error + "\n";
                            }
                        } else {
                            buildResult.textContent += "‚úÖ Manifest built successfully.\n";
                            buildResult.textContent += "Source folder: " + (data.source_folder || "(downloads root)") + "\n";
                            buildResult.textContent += "Version: " + (data.version || "") + "\n";
                            buildResult.textContent += "Categories: " + (data.categories || 0) + "\n";
                            buildResult.textContent += "Pages: " + (data.total_pages || 0) + "\n";
                            buildResult.textContent += "Thumbs processed: " + (data.total_thumbs || 0) + "\n";
                            buildResult.textContent += "Manifest file: " + (data.manifest_path || "") + "\n";
                        }
                    } catch (err) {
                        buildResult.textContent += "\n‚ùå Request failed: " + err + "\n";
                    }
                });
            }


        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('coloringAnimationForm');
            const resultDiv = document.getElementById('coloringAnimationResult');
            const videoEl = document.getElementById('coloringAnimationPreview');

            if (!form || !resultDiv || !videoEl) {
                console.warn('Coloring animation elements not found; skipping wiring.');
                return;
            }

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                resultDiv.textContent = 'Processing coloring animation‚Ä¶';
                videoEl.style.display = 'none';
                videoEl.removeAttribute('src');

                const fd = new FormData(form);

                try {
                    const res = await fetch('/api/coloring_animation', {
                        method: 'POST',
                        body: fd,
                    });
                    const data = await res.json();

                    if (!res.ok || (!data.ok && !data.success)) {
                        const msg = (data && data.error) ? data.error : res.statusText;
                        resultDiv.textContent = 'Error: ' + msg;
                        console.error('Coloring animation error:', data);
                        return;
                    }

                    // Accept any of the possible fields
                    const videoUrl =
                        data.video_url ||
                        data.url ||
                        (data.video_path ? '/downloads/' + data.video_path : '');

                    if (!videoUrl) {
                        resultDiv.textContent = 'Error: Server did not return a video URL.';
                        console.error('Coloring animation response missing video URL:', data);
                        return;
                    }

                    const downloadName = data.filename || 'coloring_animation.mp4';

                    resultDiv.innerHTML =
                        'Done! ' +
                        `<a href="${videoUrl}" download="${downloadName}">Download video</a>`;

                    videoEl.src = videoUrl;
                    videoEl.style.display = 'block';
                    videoEl.load();
                } catch (err) {
                    console.error(err);
                    resultDiv.textContent = 'Error calling server: ' + err;
                }
            });
        });
    </script>

    <script>
        // --- NEW: Pinterest Pin Excel wiring ---
        const pinForm = document.getElementById("pinterestExcelFormForColoringPins");
        const pinResult = document.getElementById("pinterestExcelResult");

        if (pinForm && pinResult) {
            pinForm.addEventListener("submit", async function (e) {
                e.preventDefault();
                pinResult.textContent = "Running Pinterest Pin Excel generator...\n";

                const formData = new FormData(pinForm);
                if (!pinForm.use_gemini.checked) {
                    formData.set("use_gemini", "no");
                }

                if (!pinForm.add_bg_music.checked) {
                    formData.set("add_bg_music", "no");
                }

                if (!pinForm.upload_pinterest.checked) {
                    formData.set("upload_pinterest", "no");
                }

                try {
                    const resp = await fetch("/generate_pinterest_excel_for_coloring_pins", {
                        method: "POST",
                        body: formData
                    });

                    const data = await resp.json();

                    if (!data.ok) {
                        pinResult.textContent += "\n‚ùå Failed to generate Pinterest Excel.\n";
                        if (data.error) {
                            pinResult.textContent += "Error: " + data.error + "\n";
                        }
                        if (data.stderr) {
                            pinResult.textContent += "\nStderr:\n" + data.stderr;
                        }
                    } else {
                        pinResult.textContent += "‚úÖ Pinterest Excel generation completed.\n";
                        pinResult.textContent += "Return code: " + data.returncode + "\n\n";
                        if (data.stdout) {
                            pinResult.textContent += "Log:\n" + data.stdout;
                        }
                    }
                } catch (err) {
                    pinResult.textContent += "\n‚ùå Request failed: " + err + "\n";
                }
            });
        }


    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const seoForm = document.getElementById("seoMetaForm");
            const seoResult = document.getElementById("seoMetaResult");

            if (seoForm) {
                seoForm.addEventListener("submit", async function (e) {
                    e.preventDefault();
                    seoResult.style.whiteSpace = "pre-wrap";
                    seoResult.textContent = "Running SEO metadata generator... This may take a while for 400+ pages.\n";

                    try {
                        const resp = await fetch("/generate_meta", {
                            method: "POST"
                        });

                        const data = await resp.json();

                        if (!data.ok) {
                            seoResult.textContent += "\n‚ùå Failed to generate SEO metadata.\n";
                            if (data.error) {
                                seoResult.textContent += "Error: " + data.error + "\n";
                            }
                            if (data.stderr) {
                                seoResult.textContent += "\nStderr:\n" + data.stderr;
                            }
                        } else {
                            seoResult.textContent += "‚úÖ SEO metadata generation completed.\n";
                            seoResult.textContent += "Return code: " + data.returncode + "\n\n";

                            if (data.stdout) {
                                seoResult.textContent += "Logs (stdout tail):\n" + data.stdout + "\n";
                            }
                            if (data.stderr) {
                                seoResult.textContent += "\nWarnings / errors (stderr tail):\n" + data.stderr + "\n";
                            }

                            seoResult.textContent += "\nYou can now open pages_with_meta.xlsx to review meta data and intro paragraphs.";
                        }
                    } catch (err) {
                        seoResult.textContent += "\n‚ùå Unexpected error: " + err;
                    }
                });
            }
        });
    </script>

    <script>
        (function () {
            const form = document.getElementById('mergeBgMusicForm');
            if (!form) return;

            const resultBox = document.getElementById('mergeBgMusicResult');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                resultBox.innerHTML = '‚è≥ Merging background music with video‚Ä¶';

                const fd = new FormData(form);

                try {
                    const resp = await fetch('/merge_bg_music', {
                        method: 'POST',
                        body: fd
                    });

                    const data = await resp.json();

                    if (!resp.ok || !data.ok) {
                        throw new Error(data.error || 'Merge failed');
                    }

                    // Expecting JSON from Flask like:
                    // { ok: true, web_path: "/video/edit_vid_output/video_with_music.mp4", ... }
                    const webPath = data.web_path || '';
                    const fileName = data.output_file || fd.get('out_name') || 'video_with_music.mp4';

                    let html = `
                        <div class="infoBox">
                            ‚úÖ Background music merged successfully.<br>
                            <code>${fileName}</code> created in <code>edit_vid_output/</code>.
                        </div>
                    `;

                    if (webPath) {
                        html += `
                            <div style="margin-top:8px;">
                                <video controls style="width:100%;max-width:520px;">
                                    <source src="${webPath}?v=${Date.now()}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            </div>
                            <div style="margin-top:8px;">
                                <a href="${webPath}?v=${Date.now()}" download>‚¨áÔ∏è Download merged video</a>
                            </div>
                        `;
                    }

                    resultBox.innerHTML = html;
                } catch (err) {
                    console.error(err);
                    resultBox.innerHTML = `
                        <div class="infoBox" style="background:#fee2e2;">
                            ‚ùå ${err.message}
                        </div>
                    `;
                }
            });
        })();
    </script>

    <script>
        (function () {
            const form = document.getElementById('mixVocalMusicForm');
            if (!form) return;
            const result = document.getElementById('mixResult');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                result.innerHTML = '‚è≥ Mixing‚Ä¶';

                const fd = new FormData(form);
                try {
                    const resp = await fetch('/mix_vocal_music', { method: 'POST', body: fd });
                    const data = await resp.json();
                    if (!resp.ok || !data.ok) throw new Error(data.error || 'Mix failed');

                    const url = data.download;
                    const meta = data.meta || {};
                    result.innerHTML = `
        <div class="infoBox">‚úÖ Mix created.</div>
        <audio controls src="${url}" style="width:100%;max-width:520px;"></audio>
        <div style="margin-top:8px;">
          <a href="${url}" download>‚¨áÔ∏è Download</a>
        </div>
        <pre style="text-align:left;white-space:pre-wrap;background:#f8fafc;padding:8px;border-radius:8px;">
${JSON.stringify(meta, null, 2)}
        </pre>
      `;
                } catch (err) {
                    result.innerHTML = `<div class="infoBox" style="background:#ffe0e0;">‚ùå ${err.message}</div>`;
                }
            });
        })();
    </script>

    <script>
        (() => {
            const form = document.getElementById('polishAudioForm');
            const resultBox = document.getElementById('polishAudioResult');
            if (!form) return;

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                resultBox.style.display = 'block';
                resultBox.textContent = 'Processing...';

                const fd = new FormData(form);
                try {
                    const res = await fetch('/polish_audio', { method: 'POST', body: fd });
                    const data = await res.json();
                    if (!res.ok || !data.ok) throw new Error(data.error || 'Server error');

                    // Show a download link + summary
                    const meta = data.meta || {};
                    const dl = data.download || '';
                    resultBox.innerHTML = `
        ‚úÖ Done. <a href="${dl}" target="_blank">Download audio_clean.m4a</a><br>
        <small>
          denoise=${meta.denoise_mode} (nr=${meta.denoise_nr}) |
          HP=${meta.highpass_hz}Hz |
          LP=${meta.lowpass_hz ?? 'off'} |
          deess=${meta.deess_intensity} |
          target=${meta.target_lufs} LUFS / TP=${meta.tp_limit_dbTP} dBTP |
          mono=${meta.force_mono} | ar=${meta.samplerate || 'keep'}
        </small>
      `;
                } catch (err) {
                    resultBox.textContent = '‚ùå ' + err.message;
                }
            });
        })();
    </script>

    <script>
        // üéØ Playlist mappings for each YouTube channel
        const playlistMap = {
            "Trend Testers": [
                "Top 10 Baby Products",
                "Tech Product Reviews",
                "Smart Gadgets 2025"
            ],
            "Cash Flow Hacks": [
                "Side Hustle of the Day",
                "1-Minute Rich Habits",
                "Passive Income Ideas",
                "Make Money Online"
            ],
            "Easy Learning": [
                "General Knowledge",
                "French",
                "History",
                "Analytical Reasoning"
            ],
            "The Parent Pod": [
                "Songs",
                "Parenting Tips",
                "Baby & Toddler Advice",
                "Parent Stories"
            ],
            "Indian Stories in English": [
                "Shiv Stories",
                "Lakshmi Stories",
                "Krishna Stories",
                "Hanumanji Stories",
                "Ganeshji Stories",
                "Durgaji Stories",
                "Bhakti Sthal Stories"
            ],
            "BhaktiSagar": [
                "Krishna Stories",
                "Lakshmi",
                "Durga",
                "Ganesh ji",
                "Shiv Ji Stories",
                "Bhakti Sthal Stories"
            ],
            "English Story World": [
                "Fun Fact Stories",
                "Historical Mini Stories",
                "Mysterious Facts"
            ]
        };

        const channelSelect = document.getElementById("channelSelect");
        const playlistSelect = document.getElementById("playlistSelect");

        // üîÑ Populate playlist dropdown dynamically
        channelSelect.addEventListener("change", () => {
            const selectedChannel = channelSelect.value;
            const playlists = playlistMap[selectedChannel] || [];

            playlistSelect.innerHTML = ""; // clear existing
            const defaultOption = document.createElement("option");
            defaultOption.value = "";
            defaultOption.textContent = playlists.length ? "-- Select Playlist --" : "-- No Playlists Available --";
            playlistSelect.appendChild(defaultOption);

            playlists.forEach(p => {
                const opt = document.createElement("option");
                opt.value = p;
                opt.textContent = p;
                playlistSelect.appendChild(opt);
            });
        });

        // üß† Handle form submission
        const form = document.getElementById("uploadForm");
        const result = document.getElementById("result");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            console.log("Processing request...Upload to YouTube")
            result.textContent = "Uploading‚Ä¶ Chrome will open. Please don‚Äôt touch it.";
            result.className = "";

            const data = new FormData(form);
            try {
                const res = await fetch("/upload", { method: "POST", body: data });
                const json = await res.json();
                console.log("Completed request...Upload to YouTube")
                if (json.ok) {
                    result.innerHTML = `‚úÖ <span class="ok">Success!</span> Video URL: <a href="${json.video_url}" target="_blank">${json.video_url}</a>`;
                } else {
                    result.innerHTML = `‚ùå <span class="err">Error:</span> ${json.error || "Unknown error"}`;
                }
            } catch (err) {
                result.innerHTML = `‚ùå <span class="err">${String(err)}</span>`;
            }
        });
    </script>

    <script>
        // const canvas = document.getElementById('previewCanvas');
        // const ctx = canvas.getContext('2d');
        // canvas.width = 640;
        // canvas.height = 360;
        let selectedImage = null;
        let selectedBgColor = '#101010';
        let currentImageFolder = '';
        let currentVideoFolder = '';

        function breadcrumbsHTML(crumbs, rootLabel = 'root') {
            if (!crumbs || crumbs.length === 0) return `<span>${rootLabel}</span>`;
            const parts = [`<a href="#" data-path="">${rootLabel}</a>`];
            crumbs.forEach(c => {
                parts.push(`&nbsp;/&nbsp;<a href="#" data-path="${c.path}">${c.name}</a>`);
            });
            return parts.join('');
        }

        async function loadImageFolder(folder = '') {
            const res = await fetch('/list_thumbnail_images?folder=' + encodeURIComponent(folder));
            if (!res.ok) { console.error('images list failed'); return; }
            const data = await res.json();
            currentImageFolder = data.cwd || '';

            // folder dropdown (all folders)
            const sel = document.getElementById('imageFolder');
            sel.innerHTML = '';
            (data.all_folders || ['']).forEach(f => {
                const opt = document.createElement('option');
                opt.value = f;
                opt.textContent = f || '(root)';
                if (f === currentImageFolder) opt.selected = true;
                sel.appendChild(opt);
            });

            // breadcrumbs
            const bc = document.getElementById('imageBreadcrumbs');
            bc.innerHTML = breadcrumbsHTML(data.breadcrumbs);
            bc.querySelectorAll('a').forEach(a => {
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadImageFolder(a.dataset.path || '');
                });
            });

            // thumbnails
            const c = document.getElementById('imageContainer');
            c.innerHTML = '';
            (data.files || []).forEach(src => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `<img src="${src}" alt="">`;
                div.onclick = () => {
                    document.querySelectorAll('#imageContainer .item').forEach(d => d.classList.remove('selected'));
                    div.classList.add('selected');
                    selectedImage = src;
                    document.getElementById('selectedImage').value = src;
                    // drawPreview();
                };
                c.appendChild(div);
            });

            // subfolder tiles (click to drill down)
            (data.folders || []).forEach(sub => {
                const tile = document.createElement('div');
                tile.className = 'item';
                tile.style.width = '160px'; tile.style.height = '100px';
                tile.style.display = 'grid'; tile.style.placeItems = 'center';
                tile.style.background = '#f1f5f9'; tile.style.border = '1px dashed #cbd5e1';
                tile.textContent = 'üìÅ ' + sub.split('/').pop();
                tile.onclick = () => loadImageFolder(sub);
                document.getElementById('imageContainer').appendChild(tile);
            });
        }

        // -------- Live Preview Drawing --------
        async function drawPreview() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Left panel
            const bg = selectedBgColor || '#101010';
            const leftWidth = canvas.width / 2;
            ctx.fillStyle = bg;
            ctx.fillRect(0, 0, leftWidth, canvas.height);

            // Right image
            if (selectedImage) {
                const img = new Image();
                img.src = selectedImage;
                await new Promise(res => { img.onload = res; });
                const rightWidth = canvas.width - leftWidth;
                ctx.drawImage(img, leftWidth, 0, rightWidth, canvas.height);
            }

            // Text overlay
            const text = document.getElementById('textInput').value.trim();
            if (text) {
                const lines = text.split('|');
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                let y = canvas.height / 2 - ((lines.length - 1) * 40);
                lines.forEach((line, i) => {
                    ctx.font = 'bold 30px Arial';
                    ctx.fillStyle = '#FFFFFF';
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 3;
                    ctx.strokeText(line, leftWidth / 2, y);
                    ctx.fillText(line, leftWidth / 2, y);
                    y += 60;
                });
            }
        }

        async function loadVideoFolder(folder = '') {
            const res = await fetch('/list_background_videos?folder=' + encodeURIComponent(folder));
            if (!res.ok) { console.error('videos list failed'); return; }
            const data = await res.json();
            currentVideoFolder = data.cwd || '';

            const sel = document.getElementById('videoFolder');
            sel.innerHTML = '';
            (data.all_folders || ['']).forEach(f => {
                const opt = document.createElement('option');
                opt.value = f;
                opt.textContent = f || '(root)';
                if (f === currentVideoFolder) opt.selected = true;
                sel.appendChild(opt);
            });

            const bc = document.getElementById('videoBreadcrumbs');
            bc.innerHTML = breadcrumbsHTML(data.breadcrumbs);
            bc.querySelectorAll('a').forEach(a => {
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadVideoFolder(a.dataset.path || '');
                });
            });

            const c = document.getElementById('videoContainer');
            c.innerHTML = '';
            (data.files || []).forEach(src => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `<video src="${src}" muted></video>`;
                div.onclick = async () => {
                    document.querySelectorAll('#videoContainer .item').forEach(d => d.classList.remove('selected'));
                    div.classList.add('selected');
                    document.getElementById('selectedVideo').value = src;
                    // await fetch('/select_background_video', {
                    //     method: 'POST',
                    //     headers: { 'Content-Type': 'application/json' },
                    //     body: JSON.stringify({ video: src })
                    // }).catch(console.error);
                };
                c.appendChild(div);
            });

            (data.folders || []).forEach(sub => {
                const tile = document.createElement('div');
                tile.className = 'item';
                tile.style.width = '160px'; tile.style.height = '100px';
                tile.style.display = 'grid'; tile.style.placeItems = 'center';
                tile.style.background = '#f1f5f9'; tile.style.border = '1px dashed #cbd5e1';
                tile.textContent = 'üìÅ ' + sub.split('/').pop();
                tile.onclick = () => loadVideoFolder(sub);
                c.appendChild(tile);
            });
        }

        // react to folder dropdown changes
        document.addEventListener('change', (e) => {
            if (e.target.id === 'imageFolder') loadImageFolder(e.target.value);
            if (e.target.id === 'videoFolder') loadVideoFolder(e.target.value);
        });

        // -------- Events --------
        document.getElementById('bgColorSelect').onchange = e => {
            selectedBgColor = e.target.value;
            // drawPreview();
        };
        // document.getElementById('textInput').oninput = drawPreview;
        // document.getElementById('colorInput').oninput = drawPreview;

        document.getElementById('thumbForm').onsubmit = async e => {
            e.preventDefault();
            const fd = new FormData(e.target);
            const res = await fetch('/generate_thumbnail', { method: 'POST', body: fd });
            const result = await res.json();
            const r = document.getElementById('result');
            r.innerHTML = result.thumbnail
                ? `<p>${result.message}</p><img src="${result.thumbnail}?v=${Date.now()}" width="640">`
                : `<p style="color:red;">${result.error}</p>`;
        };
        document.getElementById('bgVideoForm').onsubmit = async e => {
            e.preventDefault();
            src = document.getElementById('selectedVideo').value
            //const res = await fetch('/select_background_video', { method: 'POST', body: JSON.stringify({ video: src }) }).catch(console.error);;
            await fetch('/select_background_video', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ video: src })
            }).catch(console.error);
            console.log("Completed Processing");

        };



        // init
        window.addEventListener('load', () => {
            loadImageFolder('').catch(console.error);
            loadVideoFolder('').catch(console.error);
        });
    </script>
    <script>
        async function processMasterShortsFile() {
            try {
                console.log("Processing Master Shorts File Data...");
                const response = await fetch('/process_master_shorts_file_data', {
                    method: 'POST',
                    body: JSON.stringify({}),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const result = await response.text();
                console.log("Completed Processing");
                if (!response.ok) {
                    throw new Error(`Request failed with status ${response.status}`);
                }
                // optionally: console.log(result);
            } catch (e) {
                console.error(e);
                // alert('Error processing master shorts file.');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('runUploadsFromMasterBtn')?.addEventListener('click', processMasterShortsFile);
        });
    </script>


    <script>
        async function fetchAudioDuration() {
            const durationInput = document.getElementById('audioDuration');
            const form = document.getElementById('runOBSRecorder');
            const orientationSelect = form.querySelector('select[name="orientation"]');
            try {
                const res = await fetch('/api/audio-duration?v=' + Date.now()); // cache-bust
                if (!res.ok) {
                    // alert('audio.wav not found (server returned ' + res.status + ').');
                    return;
                }
                let { seconds } = await res.json();
                if (orientationSelect.value === 'portrait') {
                    if (seconds > 176) {
                        seconds = 176;
                    }
                }
                durationInput.value = Number(seconds + 2).toFixed(2); // Added 2 seconds
            } catch (e) {
                console.error(e);
                // alert('Error fetching audio duration.');
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('getDurationButton')?.addEventListener('click', fetchAudioDuration);
            // Or auto-run: fetchAudioDuration();
        });
        document.getElementById("splitButton").addEventListener("click", () => {
            const input = document.getElementById("splitInput").value.trim();
            if (!input) {
                alert("Please enter some text first!");
                return;
            }

            // Match sentences that end with either | or ?
            // Use a regex that captures the splitter too
            const parts = input.match(/[^‡•§?]+[‡•§?]/g);

            if (!parts) {
                alert("No '|' or '?' found in the text.");
                return;
            }

            // Clean and join with newlines (keeping the splitters)
            const result = parts.map(s => s.trim()).join("\n");

            document.getElementById("splitOutput").value = result;
        });

        // Optional: Copy result to clipboard
        document.getElementById("copyButton").addEventListener("click", () => {
            const output = document.getElementById("splitOutput");
            if (!output.value.trim()) {
                alert("Nothing to copy!");
                return;
            }
            output.select();
            document.execCommand("copy");
            alert("Copied to clipboard!");
        });

        // 1) Build a label for each form based on its H2 (fallback to form id)
        function slugToLabel(slug) {
            return slug
                .replace(/[-_]+/g, ' ')
                .replace(/\b\w/g, c => c.toUpperCase());
        }

        function buildTopNav() {
            const container = document.getElementById('topNavLinks');
            if (!container) return;

            // Select all forms that have an ID
            const forms = Array.from(document.querySelectorAll('form[id]'));

            const frag = document.createDocumentFragment();

            forms.forEach(form => {
                const id = form.id;
                const h2 = form.querySelector('h2');
                const label = (h2 && h2.textContent.trim()) || slugToLabel(id);

                const a = document.createElement('a');
                a.href = `#${id}`;
                a.textContent = label.length > 30 ? label.slice(0, 30) + '‚Ä¶' : label;
                a.dataset.target = id;
                frag.appendChild(a);
            });

            container.innerHTML = '';
            container.appendChild(frag);
        }

        // 2) Highlight the active link while scrolling
        function activateOnScroll() {
            const links = Array.from(document.querySelectorAll('.topnav a'));
            const map = new Map(links.map(a => [a.dataset.target, a]));

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const id = entry.target.id;
                    const link = map.get(id);
                    if (!link) return;

                    if (entry.isIntersecting) {
                        links.forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                        // Ensure the active pill stays in view when scrolled
                        link.scrollIntoView({ block: 'nearest', inline: 'nearest' });
                    }
                });
            }, {
                rootMargin: '-60px 0px -70% 0px', // triggers as the form‚Äôs top passes under the nav
                threshold: 0
            });

            document.querySelectorAll('form[id]').forEach(section => observer.observe(section));
        }

        // 3) Prevent the fixed-nav from covering the target when navigating via hash (extra-safe)
        function offsetHashJump() {
            const headerH = document.querySelector('.topnav')?.offsetHeight || 64;
            if (location.hash) {
                const el = document.querySelector(location.hash);
                if (el) window.scrollTo({ top: el.getBoundingClientRect().top + window.pageYOffset - (headerH + 8) });
            }
            window.addEventListener('hashchange', () => {
                const el = document.querySelector(location.hash);
                if (el) {
                    const headerH2 = document.querySelector('.topnav')?.offsetHeight || 64;
                    window.scrollTo({ top: el.getBoundingClientRect().top + window.pageYOffset - (headerH2 + 8), behavior: 'smooth' });
                }
            });
        }

        // 4) Init
        document.addEventListener('DOMContentLoaded', () => {
            buildTopNav();
            activateOnScroll();
            offsetHashJump();
        });
        // Build both the top pills and the expanded grid
        function collectForms() {
            return Array.from(document.querySelectorAll('form[id]')).map(f => {
                const id = f.id;
                const h2 = f.querySelector('h2');
                const label = (h2 && h2.textContent.trim()) ||
                    id.replace(/[-_]+/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
                return { id, label };
            });
        }

        function buildTopNav() {
            const container = document.getElementById('topNavLinks');
            if (!container) return;
            const frag = document.createDocumentFragment();
            collectForms().forEach(({ id, label }) => {
                const a = document.createElement('a');
                a.href = `#${id}`;
                a.textContent = label.length > 30 ? label.slice(0, 30) + '‚Ä¶' : label;
                a.dataset.target = id;
                frag.appendChild(a);
            });
            container.innerHTML = '';
            container.appendChild(frag);
        }

        function buildExpandedNav() {
            const grid = document.getElementById('navGrid');
            if (!grid) return;
            const frag = document.createDocumentFragment();

            collectForms()
                .sort((a, b) => a.label.localeCompare(b.label)) // alphabetical
                .forEach(({ id, label }) => {
                    const a = document.createElement('a');
                    a.href = `#${id}`;
                    a.textContent = label;
                    a.dataset.target = id;
                    frag.appendChild(a);
                });

            grid.innerHTML = '';
            grid.appendChild(frag);
        }

        // Open/close helpers
        function openNavPanel() {
            document.getElementById('navBackdrop').hidden = false;
            document.getElementById('navExpand').hidden = false;
            document.getElementById('navToggle').setAttribute('aria-expanded', 'true');
            document.getElementById('navSearch').focus();
        }
        function closeNavPanel() {
            document.getElementById('navBackdrop').hidden = true;
            document.getElementById('navExpand').hidden = true;
            document.getElementById('navToggle').setAttribute('aria-expanded', 'false');
            // clear filter
            const s = document.getElementById('navSearch');
            if (s && s.value) { s.value = ''; filterNav(''); }
        }

        // Filter items while typing
        function filterNav(q) {
            const items = document.querySelectorAll('#navGrid a');
            const term = q.trim().toLowerCase();
            items.forEach(a => {
                const show = a.textContent.toLowerCase().includes(term);
                a.style.display = show ? '' : 'none';
            });
        }

        // Wire up events
        document.addEventListener('DOMContentLoaded', () => {
            buildTopNav();
            buildExpandedNav();

            // Keep existing active-on-scroll behavior you already added
            // (no changes needed)

            const toggle = document.getElementById('navToggle');
            const closeBtn = document.getElementById('navClose');
            const backdrop = document.getElementById('navBackdrop');
            const grid = document.getElementById('navGrid');
            const search = document.getElementById('navSearch');

            toggle?.addEventListener('click', () => {
                const expanded = toggle.getAttribute('aria-expanded') === 'true';
                expanded ? closeNavPanel() : openNavPanel();
            });
            closeBtn?.addEventListener('click', closeNavPanel);
            backdrop?.addEventListener('click', closeNavPanel);

            // Close on ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !document.getElementById('navExpand').hidden) closeNavPanel();
            });

            // Navigate & close when clicking an item
            grid?.addEventListener('click', (e) => {
                if (e.target.tagName === 'A') closeNavPanel();
            });

            // Live filter
            search?.addEventListener('input', (e) => filterNav(e.target.value));
        });
    </script>

    <script>
        const voices = {{ voice_map | tojson }};
        const keep_video_audio = document.getElementById("keep_video_audio");
        keep_video_audio.addEventListener('change', toggleAudioVideoOptions);

        function toggleAudioVideoOptions() {
            const audioVideoOptions = document.getElementById("audioVideoOptions");
            //Toggle audioVideoOptions display between block and none
            if (audioVideoOptions.style.display == "block") {
                audioVideoOptions.style.display = "none";
            } else {
                audioVideoOptions.style.display = "block";
            }
        }

        function updateVoices() {
            const gender = document.getElementById("gender").value;
            const voiceDropdown = document.getElementById("voice");
            const voiceList = voices[gender];

            voiceDropdown.innerHTML = '';
            voiceList.forEach(function (v) {
                const opt = document.createElement("option");
                opt.value = v;
                opt.text = v;
                voiceDropdown.appendChild(opt);
            });
        }

        // On page load, initialize voices for default gender
        window.addEventListener('load', updateVoices);


        document.getElementById('contentForm').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...");
            const formData = new FormData(this);
            const response = await fetch('/process', {
                method: 'POST',
                body: formData
            });
            const result = await response.text();
            console.log("Completed Processing");
            // alert(result);
        };

        document.getElementById('runCaptionGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...caption");
            const formData = new FormData(this);
            const response = await fetch('/caption', {
                method: 'POST',
                body: formData
            });
            const result = await response.text();
            console.log("Completed creating caption");
            // alert(result);
        };
        document.getElementById('uploadToYoutube').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...upload_videos");
            const response = await fetch('/bulkupload', {
                method: 'POST'
            });
            const result = await response.text();
            console.log("Completed upload");
            // alert(result);
        };


        document.getElementById('runOBSRecorder').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...run OBS recorder");
            const formData = new FormData(this);
            const response = await fetch('/runobsrecorder', {
                method: 'POST',
                body: formData
            });
            console.log("Completed OBS recorder run");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('runVideoEditor').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...edit Videos");
            const formData = new FormData(this);
            const response = await fetch('/editvideos', {
                method: 'POST',
                body: formData
            });
            console.log("Completed ..edit Videos");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('addOverlay').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...add overlay");
            const formData = new FormData(this);
            const response = await fetch('/addoverlays', {
                method: 'POST',
                body: formData
            });
            console.log("Completed add overlay");
            const result = await response.text();
            // alert(result);
        };
        document.getElementById('multiplyVideo').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...multiply video");
            const formData = new FormData(this);
            const response = await fetch('/multiplyvideo', {
                method: 'POST',
                body: formData
            });
            console.log("Completed multiply video");
            const result = await response.text();
            // alert(result);
        };
        document.getElementById('makeKBVideoFromImages').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...make Ken Burn Videos from Images");
            const formData = new FormData(this);
            const response = await fetch('/makekbvideofromimages', {
                method: 'POST',
                body: formData
            });
            console.log("Completed make Ken Burn Videos from Images");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('asseleClipsToMakeVideoSong').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...Assemble small video clips to make video song");
            const formData = new FormData(this);
            const response = await fetch('/assembleclipstomakevideosong', {
                method: 'POST',
                body: formData
            });
            console.log("Completed Assemble small video clips to make video song");
            const result = await response.text();
            // alert(result);
        };



        document.getElementById('splitVideoToParts').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...splitVideoToParts");
            const formData = new FormData(this);
            const response = await fetch('/splitvideotoparts', {
                method: 'POST',
                body: formData
            });
            console.log("Completed splitVideoToParts");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('sunoToVideoGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...sunoToVideoGenerator");
            const formData = new FormData(this);
            const response = await fetch('/sunotovideogenerator', {
                method: 'POST',
                body: formData
            });
            console.log("Completed sunoToVideoGenerator");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('generateTTSAudio').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...generateTTSAudio");
            const formData = new FormData(this);
            const response = await fetch('/generatettsaudio', {
                method: 'POST',
                body: formData
            });
            console.log("Completed generateTTSAudio");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('sunoNImageToVideoGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...sunoNImageToVideoGenerator");
            const formData = new FormData(this);
            const response = await fetch('/sunonimagetovideogenerator', {
                method: 'POST',
                body: formData
            });
            console.log("Completed sunoNImageToVideoGenerator");
            const result = await response.text();
            // alert(result);
        };

        document.getElementById('sunoNImageToVideoGenerator').onsubmit = async function (e) {
            e.preventDefault();
            console.log("Processing request...sunoNImageToVideoGenerator");
            const formData = new FormData(this);
            const response = await fetch('/sunonimagetovideogenerator', {
                method: 'POST',
                body: formData
            });
            console.log("Completed sunoNImageToVideoGenerator");
            const result = await response.text();
            // alert(result);
        };


        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('runOBSRecorder');
            if (!form) return; // safety

            const orientationSelect = form.querySelector('select[name="orientation"]');
            const captionStyleSelect = form.querySelector('select[name="captStyle"]');
            const captionLengthInput = form.querySelector('input[name="captLength"]');
            const languageSelect = form.querySelector('select[name="language"]');
            const bgMusicSelect = form.querySelector('select[name="bgMusicSelect"]');
            const minLineGapSecInput = form.querySelector('input[name="minLineGapSec"]');

            // ‚úÖ pass the function reference (no parentheses)
            if (orientationSelect && captionStyleSelect && captionLengthInput) {
                orientationSelect.addEventListener('change', updateCaptionDefaults);
            }
            captionStyleSelect.addEventListener('change', updateCaptionDefaults);
            languageSelect.addEventListener('change', updateCaptionDefaults);

            // ‚úÖ set initial values once on load
            updateCaptionDefaults();
        });

        function updateCaptionDefaults() {
            const form = document.getElementById('runOBSRecorder');
            const orientationSelect = form.querySelector('select[name="orientation"]');
            const captionStyleSelect = form.querySelector('select[name="captStyle"]');
            const captionLengthInput = form.querySelector('input[name="captLength"]');
            const languageSelect = form.querySelector('select[name="language"]');
            const bgMusicSelect = form.querySelector('select[name="bgMusicSelect"]');
            const minLineGapSecInput = form.querySelector('input[name="minLineGapSec"]');
            const vidDuration = form.querySelector('input[name="duration"]');
            if (languageSelect.value === 'hindi') {
                if (orientationSelect.value === 'landscape') {
                    if (captionStyleSelect.value == 'style2-hindi-normal') {
                        captionLengthInput.value = 1;
                        minLineGapSecInput.value = 0.40;
                        bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                    } else if (captionStyleSelect.value == 'song-block') {
                        captionLengthInput.value = 4;
                        minLineGapSecInput.value = 60;
                        bgMusicSelect.value = 'none';
                    } else if (captionStyleSelect.value == 'story-block') {
                        captionLengthInput.value = 5;
                        minLineGapSecInput.value = 60;
                        bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                    }
                    fetchAudioDuration();
                } else if (orientationSelect.value === 'portrait') {
                    if (captionStyleSelect.value == 'style2-hindi-normal') {
                        captionLengthInput.value = 1;
                        minLineGapSecInput.value = 0.40;
                        bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                    } else if (captionStyleSelect.value == 'song-block') {
                        captionLengthInput.value = 5;
                        minLineGapSecInput.value = 60;
                        bgMusicSelect.value = 'none';
                    } else if (captionStyleSelect.value == 'story-block') {
                        captionLengthInput.value = 5;
                        minLineGapSecInput.value = 60;
                        bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                    }
                    fetchAudioDuration();
                }
            } else if (orientationSelect.value === 'portrait') {
                if (captionStyleSelect.value == 'song-block') {
                    captionLengthInput.value = 50;
                    minLineGapSecInput.value = 60;
                    bgMusicSelect.value = 'none';
                } else if (captionStyleSelect.value == 'story-block') {
                    captionLengthInput.value = 50;
                    minLineGapSecInput.value = 60;
                    bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                } else {
                    captionStyleSelect.value = 'style4';
                    captionLengthInput.value = 3;
                }
                fetchAudioDuration();
            } else if (orientationSelect.value === 'landscape') {
                if (captionStyleSelect.value == 'song-block') {
                    captionLengthInput.value = 30;
                    minLineGapSecInput.value = 60;
                    bgMusicSelect.value = 'none';
                } else if (captionStyleSelect.value == 'story-block') {
                    captionLengthInput.value = 30;
                    minLineGapSecInput.value = 60;
                    bgMusicSelect.value = 'positive-wedding-01-657.mp3';
                } else {
                    captionStyleSelect.value = 'style4';
                    captionLengthInput.value = 6;
                }
                fetchAudioDuration()
            }
        }    
    </script>

    <script>
        document.getElementById('extractAudioForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.currentTarget;
            const fd = new FormData(form);

            // IMPORTANT: we do NOT send "file" or "video" fields at all
            const res = await fetch('/extract_audio', { method: 'POST', body: fd });
            const data = await res.json();

            const box = document.getElementById('extractAudioResult');
            box.innerHTML = '';

            if (!data.ok) {
                box.innerHTML = `<div class="infoBox" style="background:#ffe5e5;border:1px solid #f5bcbc;color:#900;">
        ‚ùå ${data.error || 'Failed'}<br>${(data.detail || '')}</div>`;
                return;
            }

            if (!Array.isArray(data.items) || data.items.length === 0) {
                box.innerHTML = `<div class="infoBox">No videos found in <code>edit_vid_input/</code>.</div>`;
                return;
            }

            const list = document.createElement('div');
            data.items.forEach((it) => {
                const card = document.createElement('div');
                card.style.padding = '10px';
                card.style.marginBottom = '10px';
                card.style.border = '1px solid #eee';
                card.style.borderRadius = '8px';
                card.style.background = it.ok ? '#f8fff6' : '#fff6f6';

                const title = document.createElement('div');
                title.style.fontWeight = '600';
                title.textContent = it.ok
                    ? `‚úÖ ${it.input} ‚Üí ${it.output_name} (${(it.duration_sec ?? '‚Äî')}s)`
                    : `‚ùå ${it.input}`;
                card.appendChild(title);

                if (it.ok && it.download) {
                    const link = document.createElement('a');
                    link.href = it.download;
                    link.textContent = `Download ${data.format?.toUpperCase?.() || it.fmt?.toUpperCase?.() || 'AUDIO'}`;
                    link.target = '_blank';
                    link.style.display = 'inline-block';
                    link.style.marginTop = '6px';
                    card.appendChild(link);

                    const audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = it.download;
                    audio.style.display = 'block';
                    audio.style.marginTop = '8px';
                    card.appendChild(audio);
                } else if (!it.ok) {
                    const err = document.createElement('div');
                    err.style.marginTop = '6px';
                    err.style.color = '#900';
                    err.textContent = it.error || 'Failed';
                    card.appendChild(err);
                    if (it.detail) {
                        const det = document.createElement('div');
                        det.style.fontSize = '12px';
                        det.style.color = '#a33';
                        det.style.marginTop = '4px';
                        det.textContent = it.detail;
                        card.appendChild(det);
                    }
                }

                list.appendChild(card);
            });

            box.appendChild(list);
        });
    </script>

    <script>
        document.getElementById('upscaleVideoForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const fd = new FormData(form);
            const box = document.getElementById('upscaleResult');
            box.innerHTML = '‚è≥ Upscaling‚Ä¶';

            try {
                const res = await fetch('/upscale', { method: 'POST', body: fd });
                const data = await res.json();

                if (!res.ok || !data.ok) {
                    box.innerHTML = `‚ùå ${data.error || 'Failed'}<pre style="text-align:left;white-space:pre-wrap;">${(data.detail || '')}</pre>`;
                    return;
                }

                // Batch summary
                const rows = (data.outputs || []).map(o =>
                    `<li>‚úÖ <code>${o.input}</code> ‚Üí <a href="${o.output}" target="_blank">${o.output}</a></li>`
                ).join('') || '<li>(no outputs)</li>';

                box.innerHTML = `
      <div class="infoBox">Done: ${data.count_processed} ‚Ä¢ Errors: ${data.count_errors}</div>
      <ul style="text-align:left">${rows}</ul>
      <details style="margin-top:6px;">
        <summary>Settings</summary>
        <pre style="text-align:left;white-space:pre-wrap;">${JSON.stringify(data.settings, null, 2)}</pre>
      </details>
      ${data.errors?.length ? `<details style="margin-top:6px;"><summary>Errors</summary><pre style="text-align:left;white-space:pre-wrap;">${JSON.stringify(data.errors, null, 2)}</pre></details>` : ''}
    `;
            } catch (err) {
                box.innerHTML = `‚ùå ${String(err)}`;
            }
        });
    </script>

    <script>
        async function runTask(formId, endpoint, resultId) {
            const form = document.getElementById(formId);
            if (!form) return;

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const resultBox = document.getElementById(resultId);
                if (resultBox) {
                    resultBox.textContent = "‚è≥ Running‚Ä¶";
                }

                const fd = new FormData(form);

                try {
                    const res = await fetch(endpoint, {
                        method: "POST",
                        body: fd
                    });
                    const data = await res.json();

                    if (resultBox) {
                        resultBox.textContent = data.ok
                            ? "‚úÖ " + (data.message || "Done")
                            : "‚ùå " + (data.error || "Failed");
                    }
                } catch (err) {
                    if (resultBox) {
                        resultBox.textContent = "‚ùå " + String(err);
                    }
                }
            });
        }

        runTask("createImagesForm", "/create_images", "createImagesResult");
        runTask("createVideosForm", "/create_videos", "createVideosResult");
        runTask("createVectorImagesForm", "/create_vector_images", "createVectorImagesResult");
        runTask("removeBordersForm", "/remove_borders", "removeBordersResult");

    </script>

</body>

</html>